<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="杜鹏之家">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/9/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="杜鹏之家">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="mr.杜">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 6.2.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="https://img1.baidu.com/it/u=412709218,617594518&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=504&amp;h=500" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">mr.杜</a></h1>
		</hgroup>

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
						<!-- music -->
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Event-Loop/" style="font-size: 10px;">Event Loop</a> <a href="/tags/Graphviz/" style="font-size: 10px;">Graphviz</a> <a href="/tags/Mock/" style="font-size: 10px;">Mock</a> <a href="/tags/Promise/" style="font-size: 10px;">Promise</a> <a href="/tags/RESTful/" style="font-size: 10px;">RESTful</a> <a href="/tags/React/" style="font-size: 19.29px;">React</a> <a href="/tags/Redux/" style="font-size: 11.43px;">Redux</a> <a href="/tags/async-await/" style="font-size: 10px;">async/await</a> <a href="/tags/css/" style="font-size: 13.57px;">css</a> <a href="/tags/echart/" style="font-size: 10px;">echart</a> <a href="/tags/es6/" style="font-size: 16.43px;">es6</a> <a href="/tags/eslint/" style="font-size: 10px;">eslint</a> <a href="/tags/git/" style="font-size: 15.71px;">git</a> <a href="/tags/glup/" style="font-size: 10.71px;">glup</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/html/" style="font-size: 14.29px;">html</a> <a href="/tags/http/" style="font-size: 17.14px;">http</a> <a href="/tags/javascript/" style="font-size: 18.57px;">javascript</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10.71px;">nginx</a> <a href="/tags/nodejs/" style="font-size: 12.86px;">nodejs</a> <a href="/tags/python/" style="font-size: 10.71px;">python</a> <a href="/tags/qiankun/" style="font-size: 10px;">qiankun</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/serveless/" style="font-size: 10px;">serveless</a> <a href="/tags/typescript/" style="font-size: 12.14px;">typescript</a> <a href="/tags/vs-code/" style="font-size: 11.43px;">vs code</a> <a href="/tags/vue/" style="font-size: 20px;">vue</a> <a href="/tags/vue3/" style="font-size: 10px;">vue3</a> <a href="/tags/webpack/" style="font-size: 17.86px;">webpack</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a> <a href="/tags/%E4%BC%98%E5%8C%96/" style="font-size: 13.57px;">优化</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10.71px;">前端</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 15px;">小程序</a> <a href="/tags/%E6%8A%93%E5%8C%85/" style="font-size: 10px;">抓包</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">操作系统</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10px;">正则表达式</a> <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="font-size: 12.86px;">浏览器</a> <a href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/" style="font-size: 10.71px;">移动端</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 13.57px;">设计模式</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/">github</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">I&#39;m a developer.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://img1.baidu.com/it/u=412709218,617594518&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=504&amp;h=500" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-React/React-HOC高阶组件" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/01/10/React/React-HOC%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/" class="article-date">
  	<time datetime="2020-01-10T00:34:48.000Z" itemprop="datePublished">2020-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/10/React/React-HOC%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/">
        React HOC高阶组件
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、是什么"><a href="#一、是什么" class="headerlink" title="一、是什么"></a>一、是什么</h2><p>高阶函数（Higher-order function），至少满足下列一个条件的函数</p>
<ul>
<li>接受一个或多个函数作为输入</li>
<li>输出一个函数</li>
</ul>
<p>在<code>React</code>中，高阶组件即接受一个或多个组件作为参数并且返回一个组件，本质也就是一个函数，并不是一个组件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">EnhancedComponent</span> = <span class="title function_">highOrderComponent</span>(<span class="title class_">WrappedComponent</span>);</span><br></pre></td></tr></table></figure>

<p>上述代码中，该函数接受一个组件<code>WrappedComponent</code>作为参数，返回加工过的新组件<code>EnhancedComponent</code></p>
<p>高阶组件的这种实现方式，本质上是一个装饰者设计模式</p>
<h2 id="二、如何编写"><a href="#二、如何编写" class="headerlink" title="二、如何编写"></a>二、如何编写</h2><p>最基本的高阶组件的编写模板如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (<span class="title class_">WrappedComponent</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">EnhancedComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过对传入的原始组件 <code>WrappedComponent</code> 做一些你想要的操作（比如操作 props，提取 state，给原始组件包裹其他元素等），从而加工出想要的组件 <code>EnhancedComponent</code></p>
<p>把通用的逻辑放在高阶组件中，对组件实现一致的处理，从而实现代码的复用</p>
<p>所以，高阶组件的主要功能是封装并分离组件的通用逻辑，让通用逻辑在组件间更好地被复用</p>
<p>但在使用高阶组件的同时，一般遵循一些约定，如下：</p>
<ul>
<li>props 保持一致</li>
<li>你不能在函数式（无状态）组件上使用 ref 属性，因为它没有实例</li>
<li>不要以任何方式改变原始组件 WrappedComponent</li>
<li>透传不相关 props 属性给被包裹的组件 WrappedComponent</li>
<li>不要再 render() 方法中使用高阶组件</li>
<li>使用 compose 组合高阶组件</li>
<li>包装显示名字以便于调试</li>
</ul>
<p>这里需要注意的是，高阶组件可以传递所有的<code>props</code>，但是不能传递<code>ref</code></p>
<p>如果向一个高阶组件添加<code>refe</code>引用，那么<code>ref</code> 指向的是最外层容器组件实例的，而不是被包裹的组件，如果需要传递<code>refs</code>的话，则使用<code>React.forwardRef</code>，如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">withLogging</span>(<span class="params">WrappedComponent</span>) &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Enhance</span> <span class="keyword">extends</span> <span class="title class_ inherited__">WrappedComponent</span> &#123;</span><br><span class="line">        <span class="title function_">componentWillReceiveProps</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Current props&#x27;</span>, <span class="variable language_">this</span>.<span class="property">props</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Next props&#x27;</span>, nextProps);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123;forwardedRef, ...rest&#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">            <span class="comment">// 把 forwardedRef 赋值给 ref</span></span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...rest</span>&#125; <span class="attr">ref</span>=<span class="string">&#123;forwardedRef&#125;</span> /&gt;</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// React.forwardRef 方法会传入 props 和 ref 两个参数给其回调函数</span></span><br><span class="line">    <span class="comment">// 所以这边的 ref 是由 React.forwardRef 提供的</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">forwardRef</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Enhance</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">forwardRef</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(forwardRef);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">EnhancedComponent</span> = <span class="title function_">withLogging</span>(<span class="title class_">SomeComponent</span>);</span><br></pre></td></tr></table></figure>

<h2 id="三、应用场景"><a href="#三、应用场景" class="headerlink" title="三、应用场景"></a>三、应用场景</h2><p>通过上面的了解，高阶组件能够提高代码的复用性和灵活性，在实际应用中，常常用于与核心业务无关但又在多个模块使用的功能，如权限控制、日志记录、数据校验、异常处理、统计上报等</p>
<p>举个例子，存在一个组件，需要从缓存中获取数据，然后渲染。一般情况，我们会如下编写：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentWillMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> data = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;data&#x27;</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;data&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.state.data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码当然可以实现该功能，但是如果还有其他组件也有类似功能的时候，每个组件都需要重复写<code>componentWillMount</code>中的代码，这明显是冗杂的</p>
<p>下面就可以通过高价组件来进行改写，如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">withPersistentData</span>(<span class="params">WrappedComponent</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="title function_">componentWillMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> data = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;data&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;data&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 通过&#123;...this.props&#125; 把传递给当前组件的属性继续传递给被包装的组件WrappedComponent</span></span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> <span class="attr">data</span>=<span class="string">&#123;this.state.data&#125;</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent2</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;  </span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.props.data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyComponentWithPersistentData</span> = <span class="title function_">withPersistentData</span>(<span class="title class_">MyComponent2</span>)</span><br></pre></td></tr></table></figure>

<p>再比如组件渲染性能监控，如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Home</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">withTiming</span>(<span class="params">WrappedComponent</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">WrappedComponent</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">            <span class="variable language_">super</span>(props);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">start</span> = <span class="number">0</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">end</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">componentWillMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">super</span>.<span class="property">componentWillMount</span> &amp;&amp; <span class="variable language_">super</span>.<span class="title function_">componentWillMount</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">start</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">super</span>.<span class="property">componentDidMount</span> &amp;&amp; <span class="variable language_">super</span>.<span class="title function_">componentDidMount</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">end</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;WrappedComponent.name&#125;</span> 组件渲染时间为 <span class="subst">$&#123;<span class="variable language_">this</span>.end - <span class="variable language_">this</span>.start&#125;</span> ms`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">super</span>.<span class="title function_">render</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withTiming</span>(<span class="title class_">Home</span>);</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-React/React-Fiber" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/01/07/React/React-Fiber/" class="article-date">
  	<time datetime="2020-01-07T14:17:46.000Z" itemprop="datePublished">2020-01-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/07/React/React-Fiber/">
        React Fiber
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p><code>React Fiber</code>是对核心算法的一次重新实现。<code>React Fiber</code>把更新过程碎片化，把一个耗时长的任务分成很多小片，每一个小片的运行时间很短，虽然总时间依然很长，但是在每个小片执行完之后，都给其他任务一个执行的机会，这样唯一的线程就不会被独占，其他任务依然有运行的机会</p>
</blockquote>
<ol>
<li>在<code>React Fiber</code>中，一次更新过程会分成多个分片完成，所以完全有可能一个更新任务还没有完成，就被另一个更高优先级的更新过程打断，这时候，优先级高的更新任务会优先处理完，而低优先级更新任务所做的工作则会完全作废，然后等待机会重头再来</li>
<li>因为一个更新过程可能被打断，所以<code>React Fiber</code>一个更新过程被分为两个阶段(<code>Phase</code>)：第一个阶段<code>Reconciliation Phase</code>和第二阶段<code>Commit Phase</code></li>
<li>在第一阶段<code>Reconciliation Phase</code>，<code>React Fiber</code>会找出需要更新哪些<code>DOM</code>，这个阶段是可以被打断的；但是到了第二阶段<code>Commit Phase</code>，那就一鼓作气把<code>DOM</code>更新完，绝不会被打断</li>
<li>这两个阶段大部分工作都是<code>React Fiber</code>做，和我们相关的也就是生命周期函数</li>
</ol>
<blockquote>
<p><code>React Fiber</code>改变了之前<code>react</code>的组件渲染机制，新的架构使原来同步渲染的组件现在可以异步化，可中途中断渲染，执行更高优先级的任务。释放浏览器主线程</p>
</blockquote>
<p><strong>关键特性</strong></p>
<ul>
<li>增量渲染（把渲染任务拆分成块，匀到多帧）</li>
<li>更新时能够暂停，终止，复用渲染任务</li>
<li>给不同类型的更新赋予优先级</li>
<li>并发方面新的基础能力</li>
</ul>
<blockquote>
<p>增量渲染用来解决掉帧的问题，渲染任务拆分之后，每次只做一小段，做完一段就把时间控制权交还给主线程，而不像之前长时间占用</p>
</blockquote>
<h2 id="二、组件的渲染顺序"><a href="#二、组件的渲染顺序" class="headerlink" title="二、组件的渲染顺序"></a>二、组件的渲染顺序</h2><blockquote>
<p>假如有A,B,C,D组件，层级结构为：</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/414.png" alt="img"></p>
<p>我们知道组件的生命周期为：</p>
<p><strong>挂载阶段</strong>：</p>
<ul>
<li><code>constructor()</code></li>
<li><code>componentWillMount()</code></li>
<li><code>render()</code></li>
<li><code>componentDidMount()</code></li>
</ul>
<p><strong>更新阶段为</strong>：</p>
<ul>
<li><code>componentWillReceiveProps()</code></li>
<li><code>shouldComponentUpdate()</code></li>
<li><code>componentWillUpdate()</code></li>
<li><code>render()</code></li>
<li><code>componentDidUpdate</code></li>
</ul>
<blockquote>
<p>那么在挂载阶段，<code>A,B,C,D</code>的生命周期渲染顺序是如何的呢？</p>
</blockquote>
<p>那么在挂载阶段，A,B,C,D的生命周期渲染顺序是如何的呢？</p>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/415.png" alt="img"></p>
<blockquote>
<p>以<code>render()</code>函数为分界线。从顶层组件开始，一直往下，直至最底层子组件。然后再往上</p>
</blockquote>
<p>组件<code>update</code>阶段同理</p>
<p>前面是<code>react16</code>以前的组建渲染方式。这就存在一个问题</p>
<blockquote>
<p>如果这是一个很大，层级很深的组件，<code>react</code>渲染它需要几十甚至几百毫秒，在这期间，<code>react</code>会一直占用浏览器主线程，任何其他的操作（包括用户的点击，鼠标移动等操作）都无法执行</p>
</blockquote>
<p><strong>Fiber架构就是为了解决这个问题</strong></p>
<blockquote>
<p>看一下fiber架构 组建的渲染顺序</p>
</blockquote>
<blockquote>
<p>加入<code>fiber</code>的<code>react</code>将组件更新分为两个时期</p>
</blockquote>
<p><strong>这两个时期以render为分界</strong></p>
<ul>
<li><code>render</code>前的生命周期为<code>phase1</code>,</li>
<li><code>render</code>后的生命周期为<code>phase2</code></li>
</ul>
<blockquote>
<ul>
<li><code>phase1</code>的生命周期是可以被打断的，每隔一段时间它会跳出当前渲染进程，去确定是否有其他更重要的任务。此过程，<code>React</code>在 <code>workingProgressTree</code> （并不是真实的<code>virtualDomTree</code>）上复用 <code>current</code> 上的 <code>Fiber</code> 数据结构来一步地（通过<code>requestIdleCallback</code>）来构建新的 tree，标记处需要更新的节点，放入队列中</li>
<li><code>phase2</code>的生命周期是不可被打断的，<code>React</code> 将其所有的变更一次性更新到<code>DOM</code>上</li>
</ul>
</blockquote>
<p><strong>这里最重要的是phase1这是时期所做的事。因此我们需要具体了解phase1的机制</strong></p>
<ul>
<li>如果不被打断，那么<code>phase1</code>执行完会直接进入<code>render</code>函数，构建真实的<code>virtualDomTree</code></li>
<li>如果组件再<code>phase1</code>过程中被打断，即当前组件只渲染到一半（也许是在<code>willMount</code>,也许是<code>willUpdate</code>~反正是在render之前的生命周期），那么<code>react</code>会怎么干呢？ <code>react</code>会放弃当前组件所有干到一半的事情，去做更高优先级更重要的任务（当然，也可能是用户鼠标移动，或者其他react监听之外的任务），当所有高优先级任务执行完之后，<code>react</code>通过<code>callback</code>回到之前渲染到一半的组件，从头开始渲染。（看起来放弃已经渲染完的生命周期，会有点不合理，反而会增加渲染时长，但是<code>react</code>确实是这么干的）</li>
</ul>
<p><strong>所有phase1的生命周期函数都可能被执行多次，因为可能会被打断重来</strong></p>
<blockquote>
<p>这样的话，就和<code>react16</code>版本之前有很大区别了，因为可能会被执行多次，那么我们最好就得保证<code>phase1</code>的生命周期每一次执行的结果都是一样的，否则就会有问题，因此，最好都是纯函数</p>
</blockquote>
<ul>
<li>如果高优先级的任务一直存在，那么低优先级的任务则永远无法进行，组件永远无法继续渲染。这个问题facebook目前好像还没解决</li>
<li>所以，facebook在<code>react16</code>增加<code>fiber</code>结构，其实并不是为了减少组件的渲染时间，事实上也并不会减少，最重要的是现在可以使得一些更高优先级的任务，如用户的操作能够优先执行，提高用户的体验，至少用户不会感觉到卡顿</li>
</ul>
<h2 id="一、问题"><a href="#一、问题" class="headerlink" title="一、问题"></a>一、问题</h2><p><code>JavaScript</code>引擎和页面渲染引擎两个线程是互斥的，当其中一个线程执行时，另一个线程只能挂起等待</p>
<p>如果 <code>JavaScript</code> 线程长时间地占用了主线程，那么渲染层面的更新就不得不长时间地等待，界面长时间不更新，会导致页面响应度变差，用户可能会感觉到卡顿</p>
<p>而这也正是 <code>React 15</code> 的 <code>Stack Reconciler</code>所面临的问题，当 <code>React</code>在渲染组件时，从开始到渲染完成整个过程是一气呵成的，无法中断</p>
<p>如果组件较大，那么<code>js</code>线程会一直执行，然后等到整棵<code>VDOM</code>树计算完成后，才会交给渲染的线程</p>
<p>这就会导致一些用户交互、动画等任务无法立即得到处理，导致卡顿的情况</p>
<p><img src="https://static.vue-js.com/5eb3a850-ed24-11eb-ab90-d9ae814b240d.png" alt="img"></p>
<h2 id="二、是什么"><a href="#二、是什么" class="headerlink" title="二、是什么"></a>二、是什么</h2><p>React Fiber 是 Facebook 花费两年余时间对 React 做出的一个重大改变与优化，是对 React 核心算法的一次重新实现。从Facebook在 React Conf 2017 会议上确认，React Fiber 在React 16 版本发布</p>
<p>在<code>react</code>中，主要做了以下的操作：</p>
<ul>
<li>为每个增加了优先级，优先级高的任务可以中断低优先级的任务。然后再重新，注意是重新执行优先级低的任务</li>
<li>增加了异步任务，调用requestIdleCallback api，浏览器空闲的时候执行</li>
<li>dom diff树变成了链表，一个dom对应两个fiber（一个链表），对应两个队列，这都是为找到被中断的任务，重新执行</li>
</ul>
<p>从架构角度来看，<code>Fiber</code> 是对 <code>React</code>核心算法（即调和过程）的重写</p>
<p>从编码角度来看，<code>Fiber</code>是 <code>React</code>内部所定义的一种数据结构，它是 <code>Fiber</code>树结构的节点单位，也就是 <code>React 16</code> 新架构下的虚拟<code>DOM</code></p>
<p>一个 <code>fiber</code>就是一个 <code>JavaScript</code>对象，包含了元素的信息、该元素的更新操作队列、类型，其数据结构如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">Fiber</span> = &#123;</span><br><span class="line">  <span class="comment">// 用于标记fiber的WorkTag类型，主要表示当前fiber代表的组件类型如FunctionComponent、ClassComponent等</span></span><br><span class="line">  <span class="attr">tag</span>: <span class="title class_">WorkTag</span>,</span><br><span class="line">  <span class="comment">// ReactElement里面的key</span></span><br><span class="line">  <span class="attr">key</span>: <span class="literal">null</span> | string,</span><br><span class="line">  <span class="comment">// ReactElement.type，调用`createElement`的第一个参数</span></span><br><span class="line">  <span class="attr">elementType</span>: any,</span><br><span class="line">  <span class="comment">// The resolved function/class/ associated with this fiber.</span></span><br><span class="line">  <span class="comment">// 表示当前代表的节点类型</span></span><br><span class="line">  <span class="attr">type</span>: any,</span><br><span class="line">  <span class="comment">// 表示当前FiberNode对应的element组件实例</span></span><br><span class="line">  <span class="attr">stateNode</span>: any,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 指向他在Fiber节点树中的`parent`，用来在处理完这个节点之后向上返回</span></span><br><span class="line">  <span class="attr">return</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// 指向自己的第一个子节点</span></span><br><span class="line">  <span class="attr">child</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// 指向自己的兄弟结构，兄弟节点的return指向同一个父节点</span></span><br><span class="line">  <span class="attr">sibling</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">index</span>: number,</span><br><span class="line"></span><br><span class="line">  <span class="attr">ref</span>: <span class="literal">null</span> | ((<span class="function">(<span class="params">handle: mixed</span>) =&gt;</span> <span class="keyword">void</span>) &amp; &#123; <span class="attr">_stringRef</span>: ?string &#125;) | <span class="title class_">RefObject</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 当前处理过程中的组件props对象</span></span><br><span class="line">  <span class="attr">pendingProps</span>: any,</span><br><span class="line">  <span class="comment">// 上一次渲染完成之后的props</span></span><br><span class="line">  <span class="attr">memoizedProps</span>: any,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 该Fiber对应的组件产生的Update会存放在这个队列里面</span></span><br><span class="line">  <span class="attr">updateQueue</span>: <span class="title class_">UpdateQueue</span>&lt;any&gt; | <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 上一次渲染的时候的state</span></span><br><span class="line">  <span class="attr">memoizedState</span>: any,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一个列表，存放这个Fiber依赖的context</span></span><br><span class="line">  <span class="attr">firstContextDependency</span>: <span class="title class_">ContextDependency</span>&lt;mixed&gt; | <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">mode</span>: <span class="title class_">TypeOfMode</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Effect</span></span><br><span class="line">  <span class="comment">// 用来记录Side Effect</span></span><br><span class="line">  <span class="attr">effectTag</span>: <span class="title class_">SideEffectTag</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 单链表用来快速查找下一个side effect</span></span><br><span class="line">  <span class="attr">nextEffect</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 子树中第一个side effect</span></span><br><span class="line">  <span class="attr">firstEffect</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// 子树中最后一个side effect</span></span><br><span class="line">  <span class="attr">lastEffect</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 代表任务在未来的哪个时间点应该被完成，之后版本改名为 lanes</span></span><br><span class="line">  <span class="attr">expirationTime</span>: <span class="title class_">ExpirationTime</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 快速确定子树中是否有不在等待的变化</span></span><br><span class="line">  <span class="attr">childExpirationTime</span>: <span class="title class_">ExpirationTime</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// fiber的版本池，即记录fiber更新过程，便于恢复</span></span><br><span class="line">  <span class="attr">alternate</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、如何解决"><a href="#三、如何解决" class="headerlink" title="三、如何解决"></a>三、如何解决</h2><p><code>Fiber</code>把渲染更新过程拆分成多个子任务，每次只做一小部分，做完看是否还有剩余时间，如果有继续下一个任务；如果没有，挂起当前任务，将时间控制权交给主线程，等主线程不忙的时候在继续执行</p>
<p>即可以中断与恢复，恢复后也可以复用之前的中间状态，并给不同的任务赋予不同的优先级，其中每个任务更新单元为 <code>React Element</code> 对应的 <code>Fiber</code>节点</p>
<p>实现的上述方式的是<code>requestIdleCallback</code>方法</p>
<p><code>window.requestIdleCallback()</code>方法将在浏览器的空闲时段内调用的函数排队。这使开发者能够在主事件循环上执行后台和低优先级工作，而不会影响延迟关键事件，如动画和输入响应</p>
<p>首先 React 中任务切割为多个步骤，分批完成。在完成一部分任务之后，将控制权交回给浏览器，让浏览器有时间再进行页面的渲染。等浏览器忙完之后有剩余时间，再继续之前 React 未完成的任务，是一种合作式调度。</p>
<p>该实现过程是基于 <code>Fiber</code>节点实现，作为静态的数据结构来说，每个 <code>Fiber</code> 节点对应一个 <code>React element</code>，保存了该组件的类型（函数组件&#x2F;类组件&#x2F;原生组件等等）、对应的 DOM 节点等信息。</p>
<p>作为动态的工作单元来说，每个 <code>Fiber</code> 节点保存了本次更新中该组件改变的状态、要执行的工作。</p>
<p>每个 Fiber 节点有个对应的 <code>React element</code>，多个 <code>Fiber</code>节点根据如下三个属性构建一颗树：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指向父级Fiber节点</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">return</span> = <span class="literal">null</span></span><br><span class="line"><span class="comment">// 指向子Fiber节点</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">child</span> = <span class="literal">null</span></span><br><span class="line"><span class="comment">// 指向右边第一个兄弟Fiber节点</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">sibling</span> = <span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>通过这些属性就能找到下一个执行目标</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-React/React-ant-Design-Pro" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/25/React/React-ant-Design-Pro/" class="article-date">
  	<time datetime="2019-12-25T03:42:19.000Z" itemprop="datePublished">2019-12-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/25/React/React-ant-Design-Pro/">
        React-ant-Design-Pro总结
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h1><h2 id="1-1-ant-pro系统特性"><a href="#1-1-ant-pro系统特性" class="headerlink" title="1.1 ant pro系统特性"></a>1.1 ant pro系统特性</h2><ul>
<li>基于 <code>Ant Design</code> 体系精心设计</li>
<li>使用 <code>React/umi/dva/antd</code> 等前端前沿技术开发</li>
<li>针对不同屏幕大小设计</li>
<li>可配置的主题满足多样化的品牌诉求</li>
<li><code>Mock</code> 数据实用的本地数据调试方案</li>
</ul>
<h2 id="1-2-模板"><a href="#1-2-模板" class="headerlink" title="1.2 模板"></a>1.2 模板</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">- Dashboard</span><br><span class="line">  - 分析页</span><br><span class="line">  - 监控页</span><br><span class="line">  - 工作台</span><br><span class="line">- 表单页</span><br><span class="line">  - 基础表单页</span><br><span class="line">  - 分步表单页</span><br><span class="line">  - 高级表单页</span><br><span class="line">- 列表页</span><br><span class="line">  - 查询表格</span><br><span class="line">  - 标准列表</span><br><span class="line">  - 卡片列表</span><br><span class="line">  - 搜索列表（项目/应用/文章）</span><br><span class="line">- 详情页</span><br><span class="line">  - 基础详情页</span><br><span class="line">  - 高级详情页</span><br><span class="line">- 结果</span><br><span class="line">  - 成功页</span><br><span class="line">  - 失败页</span><br><span class="line">- 异常</span><br><span class="line">  - 403 无权限</span><br><span class="line">  - 404 找不到</span><br><span class="line">  - 500 服务器出错</span><br><span class="line">- 个人页</span><br><span class="line">  - 个人中心</span><br><span class="line">  - 个人设置</span><br><span class="line">- 帐户</span><br><span class="line">  - 登录</span><br><span class="line">  - 注册</span><br><span class="line">  - 注册成功</span><br></pre></td></tr></table></figure>

<h2 id="1-3-使用"><a href="#1-3-使用" class="headerlink" title="1.3 使用"></a>1.3 使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git clone --depth=1 https://github.com/ant-design/ant-design-pro.git my-project</span><br><span class="line">$ cd my-project</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install ant-design-pro-cli -g</span><br><span class="line">$ mkdir my-project &amp;&amp; cd my-project</span><br><span class="line">$ pro new  # 安装脚手架</span><br></pre></td></tr></table></figure>

<h2 id="1-4-目录结构"><a href="#1-4-目录结构" class="headerlink" title="1.4 目录结构"></a>1.4 目录结构</h2><p>整个项目的目录结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">├── mock                     # 本地模拟数据</span><br><span class="line">├── node_modules             # 依赖库</span><br><span class="line">├── public</span><br><span class="line">│   ├── favicon.ico          # Favicon</span><br><span class="line">│   └── index.html           # HTML 入口模板</span><br><span class="line">├── src</span><br><span class="line">│   ├── common               # 应用公用配置，如导航信息</span><br><span class="line">│   ├── components           # 业务通用组件</span><br><span class="line">│   ├── e2e                  # 集成测试用例</span><br><span class="line">│   ├── layouts              # 通用布局</span><br><span class="line">│   ├── models               # dva model</span><br><span class="line">│   ├── routes               # 业务页面入口和常用模板</span><br><span class="line">│   ├── services             # 后台接口服务</span><br><span class="line">│   ├── utils                # 工具库</span><br><span class="line">│   ├── g2.js                # 可视化图形配置</span><br><span class="line">│   ├── polyfill.js          # 兼容性垫片</span><br><span class="line">│   ├── theme.js             # 主题配置</span><br><span class="line">│   ├── index.js             # 应用入口</span><br><span class="line">│   ├── index.less           # 全局样式</span><br><span class="line">│   └── router.js            # 路由入口</span><br><span class="line">├── tests                    # 测试工具</span><br><span class="line">├── .editorconfig            # 编辑器配置</span><br><span class="line">├── .eslintrc                # js代码检测工具</span><br><span class="line">├── .ga                      # 未知</span><br><span class="line">├── .gitignore               # git版本配置</span><br><span class="line">├── .roadhogrc               # roadhog配置</span><br><span class="line">├── .roadhogrc.mock.js       # roadhog的模拟配置</span><br><span class="line">├── .stylelintrc             # css代码审查配置</span><br><span class="line">├── .travis.yml              # travis持续构建工具配置</span><br><span class="line">├── package.json             # web前端项目配置文件</span><br><span class="line">├── README.md</span><br><span class="line">└──</span><br></pre></td></tr></table></figure>

<h2 id="roadhog摘要介绍"><a href="#roadhog摘要介绍" class="headerlink" title="roadhog摘要介绍"></a>roadhog摘要介绍</h2><ul>
<li><code>roadhog</code> 是一个 <code>cli</code> 工具，提供 <code>server</code>、 <code>build</code> 和 test 三个命令，分别用于本地调试和构建，并且提供了特别易用的 mock 功能。命令行体验和 <code>create-react-app</code> 一致，配置略有不同，比如默认开启 <code>css``modules</code>，然后还提供了 <code>JSON</code> 格式的配置方式。</li>
<li>重点介绍<code>roadhog</code>有关的几个配置项，主要是在<code>ant design pro</code>的代码中用到了这些配置项</li>
</ul>
<p><strong>entry</strong></p>
<ul>
<li>指定 <code>webpack</code> 入口文件，支持 <code>glob</code>格式。</li>
<li>如果你的项目是多页类型，会希望把 <code>src/pages</code>的文件作为入口。可以这样配：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;entry&quot;: &quot;src/pages/\*.js&quot;</span><br></pre></td></tr></table></figure>

<p><strong>env</strong></p>
<blockquote>
<p>针对特定的环境进行配置。<code>server</code> 的环境变量是 <code>development</code>，<code>build</code> 的环境变量是<code>production</code>。</p>
</blockquote>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;extraBabelPlugins&quot;: [&quot;transform-runtime&quot;],</span><br><span class="line">&quot;env&quot;: &#123;</span><br><span class="line">  &quot;development&quot;: &#123;</span><br><span class="line">    &quot;extraBabelPlugins&quot;: [&quot;dva-hmr&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这样，开发环境下的 <code>extraBabelPlugins</code> 是 <code>[&quot;transform-runtime&quot;, &quot;dva-hmr&quot;]</code>，而生产环境下是 <code>[&quot;transform-runtime&quot;]</code>。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&quot;env&quot;: &#123;</span><br><span class="line">  &quot;development&quot;: &#123;</span><br><span class="line">    &quot;extraBabelPlugins&quot;: [</span><br><span class="line">      &quot;dva-hmr&quot;,</span><br><span class="line">      &quot;transform-runtime&quot;,</span><br><span class="line">      &quot;transform-decorators-legacy&quot;,</span><br><span class="line">      &quot;transform-class-properties&quot;,</span><br><span class="line">      [&quot;import&quot;, &#123; &quot;libraryName&quot;: &quot;antd&quot;, &quot;style&quot;: true &#125;]</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;production&quot;: &#123;</span><br><span class="line">    &quot;extraBabelPlugins&quot;: [</span><br><span class="line">      &quot;transform-runtime&quot;,</span><br><span class="line">      &quot;transform-decorators-legacy&quot;,</span><br><span class="line">      &quot;transform-class-properties&quot;,</span><br><span class="line">      [&quot;import&quot;, &#123; &quot;libraryName&quot;: &quot;antd&quot;, &quot;style&quot;: true &#125;]</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在这段代码中，开发环境和生产环境分别配置，其中开发环境使用了<code>dva-hmr</code>插件</p>
</blockquote>
<h1 id="二、布局"><a href="#二、布局" class="headerlink" title="二、布局"></a>二、布局</h1><blockquote>
<p>页面整体布局是一个产品最外层的框架结构，往往会包含导航、页脚、侧边栏、通知栏以及内容等。在页面之中，也有很多区块的布局结构。在真实项目中，页面布局通常统领整个应用的界面，有非常重要的作用</p>
</blockquote>
<h2 id="2-1-Ant-Design-Pro-的布局"><a href="#2-1-Ant-Design-Pro-的布局" class="headerlink" title="2.1 Ant Design Pro 的布局"></a>2.1 Ant Design Pro 的布局</h2><blockquote>
<p>在 Ant Design Pro 中，我们抽离了使用过程中的通用布局，都放在 <code>layouts</code> 目录中，分别为</p>
</blockquote>
<p><strong>BasicLayout：基础页面布局，包含了头部导航，侧边栏和通知栏</strong></p>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/oXmyfmffJVvdbmDoGvuF.png" alt="img"></p>
<p><strong>UserLayout：抽离出用于登陆注册页面的通用布局</strong></p>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/mXsydBXvLqBVEZLMssEy.png" alt="img"></p>
<p><strong>BlankLayout：空白的布局</strong></p>
<h2 id="2-2-如何使用-Ant-Design-Pro-布局"><a href="#2-2-如何使用-Ant-Design-Pro-布局" class="headerlink" title="2.2 如何使用 Ant Design Pro 布局"></a>2.2 如何使用 Ant Design Pro 布局</h2><blockquote>
<p>通常布局是和路由系统紧密结合的，Ant Design Pro 的路由使用了 <code>Umi</code> 的路由方案，为了统一方便的管理路由和页面的关系，我们将配置信息统一抽离到 <code>config/router.config.js</code> 下，通过如下配置定义每个页面的布局</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">module.exports = [&#123;</span><br><span class="line">  path: &#x27;/&#x27;,</span><br><span class="line">  component: &#x27;../layouts/BasicLayout&#x27;,  // 指定以下页面的布局</span><br><span class="line">  routes: [</span><br><span class="line">    // dashboard</span><br><span class="line">    &#123; path: &#x27;/&#x27;, redirect: &#x27;/dashboard/analysis&#x27; &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: &#x27;/dashboard&#x27;,</span><br><span class="line">      name: &#x27;dashboard&#x27;,</span><br><span class="line">      icon: &#x27;dashboard&#x27;,</span><br><span class="line">      routes: [</span><br><span class="line">        &#123; path: &#x27;/dashboard/analysis&#x27;, name: &#x27;analysis&#x27;, component: &#x27;./Dashboard/Analysis&#x27; &#125;,</span><br><span class="line">        &#123; path: &#x27;/dashboard/monitor&#x27;, name: &#x27;monitor&#x27;, component: &#x27;./Dashboard/Monitor&#x27; &#125;,</span><br><span class="line">        &#123; path: &#x27;/dashboard/workplace&#x27;, name: &#x27;workplace&#x27;, component: &#x27;./Dashboard/Workplace&#x27; &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>更多 Umi 的路由配置方式可以参考：<a target="_blank" rel="noopener" href="https://umijs.org/guide/router.html#%E9%85%8D%E7%BD%AE%E5%BC%8F%E8%B7%AF%E7%94%B1">Umi 配置式路由</a></p>
</blockquote>
<h2 id="2-3-Pro-扩展配置"><a href="#2-3-Pro-扩展配置" class="headerlink" title="2.3 Pro 扩展配置"></a>2.3 Pro 扩展配置</h2><blockquote>
<p>我们在 <code>router.config.js</code> 扩展了一些关于 <code>pro</code> 全局菜单的配置</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: &#x27;dashboard&#x27;,</span><br><span class="line">  icon: &#x27;dashboard&#x27;,</span><br><span class="line">  hideInMenu: true,</span><br><span class="line">  hideChildrenInMenu: true,</span><br><span class="line">  hideInBreadcrumb: true,</span><br><span class="line">  authority: [&#x27;admin&#x27;],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>name</code>: 当前路由在菜单和面包屑中的名称，注意这里是国际化配置的 <code>key</code>，具体展示菜单名可以在 <code>/src/locales/zh-CN.js</code> 进行配置。</li>
<li><code>icon</code>: 当前路由在菜单下的图标名。</li>
<li><code>hideInMenu</code>: 当前路由在菜单中不展现，默认 <code>false</code>。</li>
<li><code>hideChildrenInMenu</code>: 当前路由的子级在菜单中不展现，默认 <code>false</code>。</li>
<li><code>hideInBreadcrumb</code>: 当前路由在面包屑中不展现，默认 <code>false</code>。</li>
<li><code>authority</code>: 允许展示的权限，不设则都可见，详见：权限管理</li>
</ul>
<h2 id="2-4-Ant-Design-布局组件"><a href="#2-4-Ant-Design-布局组件" class="headerlink" title="2.4 Ant Design 布局组件"></a>2.4 Ant Design 布局组件</h2><blockquote>
<p>除了 Pro 里的内建布局以为，在一些页面中需要进行布局，可以使用 Ant Design 目前提供的两套布局组件工具：<code>Layout</code> 和 <code>Grid</code></p>
</blockquote>
<p><strong>Grid 组件</strong></p>
<blockquote>
<ul>
<li>栅格布局是网页中最常用的布局，其特点就是按照一定比例划分页面，能够随着屏幕的变化依旧保持比例，从而具有弹性布局的特点。</li>
<li>而 Ant Design 的栅格组件提供的功能更为强大，能够设置间距、具有支持响应式的比例设置，以及支持 flex 模式，基本上涵盖了大部分的布局场景 <a target="_blank" rel="noopener" href="https://ant.design/components/grid/">https://ant.design/components/grid/</a></li>
</ul>
</blockquote>
<p><strong>Layout 组件</strong></p>
<blockquote>
<p>如果你需要辅助页面框架级别的布局设计，那么 Layout 则是你最佳的选择，它抽象了大部分框架布局结构，使得只需要填空就可以开发规范专业的页面整体布局 <a target="_blank" rel="noopener" href="https://ant.design/components/layout-cn/">https://ant.design/components/layout-cn/</a></p>
</blockquote>
<ul>
<li>根据不同场景区分抽离布局组件#<br>在大部分场景下，我们需要基于上面两个组件封装一些适用于当下具体业务的组件，包含了通用的导航、侧边栏、顶部通知、页面标题等元素。例如 Ant Design Pro 的 <code>BasicLayout</code>。</li>
<li>通常，我们会把抽象出来的布局组件，放到跟 pages、 components 平行的 layouts 文件夹中方便管理。需要注意的是，这些布局组件和我们平时使用的其它组件并没有什么不同，只不过功能性上是为了处理布局问题</li>
</ul>
<h1 id="四、路由和菜单"><a href="#四、路由和菜单" class="headerlink" title="四、路由和菜单"></a>四、路由和菜单</h1><blockquote>
<p>路由和菜单是组织起一个应用的关键骨架，pro 中的路由为了方便管理，使用了中心化的方式，在 <code>router.config.js</code> 统一配置和管理</p>
</blockquote>
<h2 id="4-1-基本结构"><a href="#4-1-基本结构" class="headerlink" title="4.1 基本结构"></a>4.1 基本结构</h2><ul>
<li><strong>路由管理</strong> 通过约定的语法根据在 <code>router.config.js</code> 中配置路由。</li>
<li><strong>菜单生成</strong> 根据路由配置来生成菜单。菜单项名称，嵌套路径与路由高度耦合。</li>
<li><strong>面包屑</strong> 组件 <a target="_blank" rel="noopener" href="https://pro.ant.design/components/PageHeader-cn">PageHeader</a> 中内置的面包屑也可由脚手架提供的配置信息自动生成</li>
</ul>
<h3 id="4-1-1-路由"><a href="#4-1-1-路由" class="headerlink" title="4.1.1 路由"></a>4.1.1 路由</h3><blockquote>
<p>目前脚手架中所有的路由都通过 <code>router.config.js</code> 来统一管理，在 <code>umi</code> 的配置中我们增加了一些参数，如<code>name</code>,<code>icon</code>,<code>hideChildren</code>,<code>authority</code>，来辅助生成菜单。其中</p>
</blockquote>
<ul>
<li><code>name</code> 和 <code>icon</code>分别代表生成菜单项的图标和文本。</li>
<li><code>hideChildren</code> 用于隐藏不需要在菜单中展示的子路由。用法可以查看 分步表单 的配置。</li>
<li><code>hideInMenu</code> 可以在菜单中不展示这个路由，包括子路由。效果可以查看 <code>exception/trigger</code>页面。</li>
<li><code>authority</code> 用来配置这个路由的权限，如果配置了将会验证当前用户的权限，并决定是否展示</li>
</ul>
<h3 id="4-1-2-菜单"><a href="#4-1-2-菜单" class="headerlink" title="4.1.2 菜单"></a>4.1.2 菜单</h3><blockquote>
<p>菜单根据 <code>router.config.js</code> 生成，具体逻辑在 <code>src/layouts/BasicLayout</code> 中的 <code>formatter</code> 方法实现</p>
</blockquote>
<ul>
<li>如果你的项目并不需要菜单，你可以直接在<code>BasicLayout</code> 中删除 <code>SiderMenu</code> 组件的挂载。并在 <code>src/layouts/BasicLayout</code> 中 设置 <code>const MenuData = []</code>。</li>
<li>如果你需要从服务器请求菜单，可以将<code>menuData</code>设置为 <code>state</code>，然后通过网络获取来修改了 <code>state</code></li>
</ul>
<h3 id="4-1-3-面包屑"><a href="#4-1-3-面包屑" class="headerlink" title="4.1.3 面包屑"></a>4.1.3 面包屑</h3><blockquote>
<p>面包屑由 <code>PageHeaderLayout</code> 实现，<code>MenuContext</code> 将 根据 <code>MenuData</code> 生成的 <code>breadcrumbNameMap</code> 通过<code>props</code> 传递给了 <code>PageHeader</code>，如果你要做自定义的面包屑，可以通过修改传入的 <code>breadcrumbNameMap</code> 来解决</p>
</blockquote>
<p><code>breadcrumbNameMap</code> 示例数据如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &#x27;/&#x27;: &#123; path: &#x27;/&#x27;, redirect: &#x27;/dashboard/analysis&#x27;, locale: &#x27;menu&#x27; &#125;,</span><br><span class="line">  &#x27;/dashboard/analysis&#x27;: &#123;</span><br><span class="line">    name: &#x27;analysis&#x27;,</span><br><span class="line">    component: &#x27;./Dashboard/Analysis&#x27;,</span><br><span class="line">    locale: &#x27;menu.dashboard.analysis&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-2-需求实例"><a href="#4-2-需求实例" class="headerlink" title="4.2 需求实例"></a>4.2 需求实例</h2><h3 id="4-2-1-新增页面"><a href="#4-2-1-新增页面" class="headerlink" title="4.2.1 新增页面"></a>4.2.1 新增页面</h3><blockquote>
<p>脚手架默认提供了两种布局模板：基础布局 - <code>BasicLayout</code> 以及 账户相关布局 - <code>UserLayout</code></p>
</blockquote>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/oXmyfmffJVvdbmDoGvuF.png" alt="img"></p>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/mXsydBXvLqBVEZLMssEy.png" alt="img"></p>
<p>如果你的页面可以利用这两种布局，那么只需要在路由配置中增加一条即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> // app</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/&#x27;,</span><br><span class="line">    component: &#x27;../layouts/BasicLayout&#x27;,</span><br><span class="line">    routes: [</span><br><span class="line">      // dashboard</span><br><span class="line">      &#123; path: &#x27;/&#x27;, redirect: &#x27;/dashboard/analysis&#x27; &#125;,</span><br><span class="line">      &#123; path :&#x27;/dashboard/test&#x27;,component:&quot;./Dashboard/Test&quot;&#125;,</span><br><span class="line">    ...</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>加好后，会默认生成相关的路由及导航</p>
</blockquote>
<h3 id="4-2-2-新增布局"><a href="#4-2-2-新增布局" class="headerlink" title="4.2.2 新增布局"></a>4.2.2 新增布局</h3><blockquote>
<p>在脚手架中我们通过嵌套路由来实现布局模板。<code>router.config.js</code> 是一个数组，其中第一级数据就是我们的布局，如果你需要新增布局可以在直接增加一个新的一级数组</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">module.exports = [</span><br><span class="line">   // user</span><br><span class="line">   &#123;</span><br><span class="line">    path: &#x27;/user&#x27;,</span><br><span class="line">    component: &#x27;../layouts/UserLayout&#x27;,</span><br><span class="line">    routes:[...]</span><br><span class="line">   &#125;,</span><br><span class="line">   // app</span><br><span class="line">   &#123;</span><br><span class="line">    path: &#x27;/&#x27;,</span><br><span class="line">    component: &#x27;../layouts/BasicLayout&#x27;,</span><br><span class="line">    routes:[...]</span><br><span class="line">   &#125;,</span><br><span class="line">   // new</span><br><span class="line">   &#123;</span><br><span class="line">    path: &#x27;/new&#x27;,</span><br><span class="line">    component: &#x27;../layouts/new_page&#x27;,</span><br><span class="line">    routes:[...]</span><br><span class="line">   &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="4-2-3-带参数的路由"><a href="#4-2-3-带参数的路由" class="headerlink" title="4.2.3 带参数的路由"></a>4.2.3 带参数的路由</h3><blockquote>
<p>脚手架默认支持带参数的路由,但是在菜单中显示带参数的路由并不是个好主意，我们并不会自动的帮你注入一个参数，你可能需要在代码中自行处理</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">    path: &#x27;/dashboard/:page&#x27;,</span><br><span class="line">    hideInMenu:true, </span><br><span class="line">    name: &#x27;analysis&#x27;, </span><br><span class="line">    component: &#x27;./Dashboard/Analysis&#x27; </span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>你可以通过以下代码来跳转到这个路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import router from &#x27;umi/router&#x27;;</span><br><span class="line"></span><br><span class="line">router.push(&#x27;/dashboard/anyParams&#x27;)</span><br><span class="line"></span><br><span class="line">//or</span><br><span class="line"></span><br><span class="line">import Link from &#x27;umi/link&#x27;;</span><br><span class="line"></span><br><span class="line">&lt;Link to=&quot;/dashboard/anyParams&quot;&gt;go&lt;/Link&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在路由组件中，可以通过<code>this.props.match.params</code> 来获得路由参数</p>
</blockquote>
<h1 id="五、新增页面"><a href="#五、新增页面" class="headerlink" title="五、新增页面"></a>五、新增页面</h1><blockquote>
<p>这里的『页面』指配置了路由，能够通过链接直接访问的模块，要新建一个页面，通常只需要在脚手架的基础上进行简单的配置</p>
</blockquote>
<h2 id="5-1-新增-js、less"><a href="#5-1-新增-js、less" class="headerlink" title="5.1 新增 js、less"></a>5.1 新增 js、less</h2><blockquote>
<p>在 <code>src/pages</code> 下新建页面的 <code>js</code> 及 <code>less</code> 文件，如果相关页面有多个，可以新建一个文件夹来放置相关文件</p>
</blockquote>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/hjDyFTVOgRwDzAIHApMO.png" alt="img"></p>
<blockquote>
<p>样式文件默认使用 CSS Modules，如果需要，你可以在样式文件的头部引入 antd 样式变量文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;~antd/lib/style/themes/default.less&quot;;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-将文件加入菜单和路由"><a href="#5-2-将文件加入菜单和路由" class="headerlink" title="5.2 将文件加入菜单和路由"></a>5.2 将文件加入菜单和路由</h2><blockquote>
<p>加入菜单和路由的方式请参照 路由和菜单 - 添加路由&#x2F;菜单 中的介绍完成。加好后，访问 <code>http://localhost:8000/#/new</code> 就可以看到新增的页面了 <a target="_blank" rel="noopener" href="https://pro.ant.design/docs/router-and-nav-cn#%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1/%E8%8F%9C%E5%8D%95">https://pro.ant.design/docs/router-and-nav-cn#%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1/%E8%8F%9C%E5%8D%95</a></p>
</blockquote>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/xZIqExWKhdnzDBjajnZg.png" alt="img"></p>
<h2 id="5-3-新增-model、service"><a href="#5-3-新增-model、service" class="headerlink" title="5.3 新增 model、service"></a>5.3 新增 model、service</h2><blockquote>
<p>布局及路由都配置好之后，回到之前新建的 <code>NewPage.js</code>，可以开始写业务代码了！如果需要用到 <code>dva</code>中的数据流，还需要在 <code>src/models src/services</code> 中建立相应的<code>model</code> 和 service，具体可以参考脚手架内置页面的写法</p>
</blockquote>
<h1 id="六、新增业务组件"><a href="#六、新增业务组件" class="headerlink" title="六、新增业务组件"></a>六、新增业务组件</h1><blockquote>
<p>对于一些可能被多处引用的功能模块，建议提炼成业务组件统一管理。这些组件一般有以下特征：</p>
</blockquote>
<ul>
<li>只负责一块相对独立，稳定的功能；</li>
<li>没有单独的路由配置；</li>
<li>可能是纯静态的，也可能包含自己的 state，但不涉及 dva 的数据流，仅受父组件（通常是一个页面）传递的参数控制。</li>
</ul>
<p><strong>新建文件</strong></p>
<blockquote>
<p>在 <code>src/components</code> 下新建一个以组件名命名的文件夹，注意首字母大写，命名尽量体现组件的功能，这里就叫 <code>ImageWrapper</code>。在此文件夹下新增 js 文件及样式文件（如果需要），命名为 <code>index.js</code>和 <code>index.less</code></p>
</blockquote>
<ul>
<li>在使用组件时，默认会在 <code>index.js</code> 中寻找 <code>export</code> 的对象，如果你的组件比较复杂，可以分为多个文件，最后在 <code>index.js</code>中统一 <code>export</code>，就像这样</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// MainComponent.js</span><br><span class="line">export default (&#123; ... &#125;) =&gt; (...);</span><br><span class="line"></span><br><span class="line">// SubComponent1.js</span><br><span class="line">export default (&#123; ... &#125;) =&gt; (...);</span><br><span class="line"></span><br><span class="line">// SubComponent2.js</span><br><span class="line">export default (&#123; ... &#125;) =&gt; (...);</span><br><span class="line"></span><br><span class="line">// index.js</span><br><span class="line">import MainComponent from &#x27;./MainComponent&#x27;;</span><br><span class="line">import SubComponent1 from &#x27;./SubComponent1&#x27;;</span><br><span class="line">import SubComponent2 from &#x27;./SubComponent2&#x27;;</span><br><span class="line"></span><br><span class="line">MainComponent.SubComponent1 = SubComponent1;</span><br><span class="line">MainComponent.SubComponent2 = SubComponent2;</span><br><span class="line">export default MainComponent;</span><br></pre></td></tr></table></figure>

<p>你的代码大概是这个样子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// index.js</span><br><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import styles from &#x27;./index.less&#x27;;    // 按照 CSS Modules 的方式引入样式文件。</span><br><span class="line"></span><br><span class="line">export default (&#123; src, desc, style &#125;) =&gt; (</span><br><span class="line">  &lt;div style=&#123;style&#125; className=&#123;styles.imageWrapper&#125;&gt;</span><br><span class="line">    &lt;img className=&#123;styles.img&#125; src=&#123;src&#125; alt=&#123;desc&#125; /&gt;</span><br><span class="line">    &#123;desc &amp;&amp; &lt;div className=&#123;styles.desc&#125;&gt;&#123;desc&#125;&lt;/div&gt;&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br><span class="line">// index.less</span><br><span class="line">.imageWrapper &#123;</span><br><span class="line">  padding: 0 20px 8px;</span><br><span class="line">  background: #f2f4f5;</span><br><span class="line">  width: 400px;</span><br><span class="line">  margin: 0 auto;</span><br><span class="line">  text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.img &#123;</span><br><span class="line">  vertical-align: middle;</span><br><span class="line">  max-width: calc(100% - 32px);</span><br><span class="line">  margin: 2.4em 1em;</span><br><span class="line">  box-shadow: 0 8px 20px rgba(143, 168, 191, 0.35);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用</strong></p>
<blockquote>
<p>在要使用这个组件的地方，按照组件定义的 <code>API</code> 传入参数，直接使用就好，不过别忘了先引入</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import ImageWrapper from &#x27;@/components/ImageWrapper&#x27;;  // @ 表示相对于源文件根目录</span><br><span class="line"></span><br><span class="line">export default () =&gt; (</span><br><span class="line">  &lt;ImageWrapper</span><br><span class="line">    src=&quot;https://os.alipayobjects.com/rmsportal/mgesTPFxodmIwpi.png&quot;</span><br><span class="line">    desc=&quot;示意图&quot;</span><br><span class="line">  /&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h1 id="七、样式"><a href="#七、样式" class="headerlink" title="七、样式"></a>七、样式</h1><p><strong>less</strong></p>
<blockquote>
<p>Ant Design Pro 默认使用 less 作为样式语言</p>
</blockquote>
<p><strong>CSS Modules</strong></p>
<p>在样式开发过程中，有两个问题比较突出</p>
<ul>
<li>全局污染 —— CSS 文件中的选择器是全局生效的，不同文件中的同名选择器，根据 build 后生成文件中的先后顺序，后面的样式会将前面的覆盖；</li>
<li>选择器复杂 —— 为了避免上面的问题，我们在编写样式的时候不得不小心翼翼，类名里会带上限制范围的标识，变得越来越长，多人开发时还很容易导致命名风格混乱，一个元素上使用的选择器个数也可能越来越多。</li>
</ul>
<blockquote>
<p>为了解决上述问题，我们的脚手架默认使用 CSS Modules 模块化方案，先来看下在这种模式下怎么写样式</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// example.js</span><br><span class="line">import styles from &#x27;./example.less&#x27;;</span><br><span class="line"></span><br><span class="line">export default (&#123; title &#125;) =&gt; &lt;div className=&#123;styles.title&#125;&gt;&#123;title&#125;&lt;/div&gt;;</span><br><span class="line">// example.less</span><br><span class="line">.title &#123;</span><br><span class="line">  color: @heading-color;</span><br><span class="line">  font-weight: 600;</span><br><span class="line">  margin-bottom: 16px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>用 less 写样式好像没什么改变，只是类名比较简单（实际项目中也是这样），js 文件的改变就是在设置 <code>className</code> 时，用一个对象属性取代了原来的字符串，属性名跟 less 文件中对应的类名相同，对象从 less 文件中引入。</li>
<li>在上面的样式文件中，<code>.title</code> 只会在本文件生效，你可以在其他任意文件中使用同名选择器，也不会对这里造成影响。不过有的时候，我们就是想要一个全局生效的样式呢？可以使用 <code>:global</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// example.less</span><br><span class="line">.title &#123;</span><br><span class="line">  color: @heading-color;</span><br><span class="line">  font-weight: 600;</span><br><span class="line">  margin-bottom: 16px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 定义全局样式 */</span><br><span class="line">:global(.text) &#123;</span><br><span class="line">  font-size: 16px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 定义多个全局样式 */</span><br><span class="line">:global &#123;</span><br><span class="line">  .footer &#123;</span><br><span class="line">    color: #ccc;</span><br><span class="line">  &#125;</span><br><span class="line">  .sider &#123;</span><br><span class="line">    background: #ebebeb;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS Modules 的基本原理很简单，就是对每个类名（非 <code>:global</code> 声明的）按照一定规则进行转换，保证它的唯一性。如果在浏览器里查看这个示例的 dom 结构，你会发现实际渲染出来是这样的</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;title___3TqAx&quot;&gt;title&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>类名被自动添加了一个 <code>hash</code> 值，这保证了它的唯一性</li>
</ul>
<p><strong>样式文件类别</strong></p>
<blockquote>
<p>在一个项目中，样式文件根据功能不同，可以划分为不同的类别</p>
</blockquote>
<ul>
<li><code>src/index.less#</code></li>
</ul>
<blockquote>
<p>全局样式文件，在这里你可以进行一些通用设置，比如脚手架中自带的</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">html, body, :global(#root) &#123;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">body &#123;</span><br><span class="line">  text-rendering: optimizeLegibility;</span><br><span class="line">  -webkit-font-smoothing: antialiased;</span><br><span class="line">  -moz-osx-font-smoothing: grayscale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// temporary font size patch</span><br><span class="line">:global(.ant-tag) &#123;</span><br><span class="line">  font-size: 12px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>src/utils/utils.less#</code></li>
</ul>
<blockquote>
<p>这里可以放置一些工具函数供调用，比如清除浮动 <code>.clearfix</code></p>
</blockquote>
<ul>
<li>模块样式</li>
</ul>
<blockquote>
<p>针对某个模块&#x2F;页面生效的文件</p>
</blockquote>
<h1 id="八、和服务端进行交互"><a href="#八、和服务端进行交互" class="headerlink" title="八、和服务端进行交互"></a>八、和服务端进行交互</h1><p><strong>前端请求流程</strong></p>
<blockquote>
<p>在 Ant Design Pro 中，一个完整的前端 UI 交互到服务端处理流程是这样的</p>
</blockquote>
<ul>
<li>UI 组件交互操作；</li>
<li>调用 <code>model</code> 的 <code>effect</code>；</li>
<li>调用统一管理的 <code>service</code> 请求函数；</li>
<li>使用封装的 <code>request.js</code>发送请求；</li>
<li>获取服务端返回；</li>
<li>然后调用<code>reducer</code>改变 <code>state</code>；</li>
<li>更新 <code>model</code></li>
</ul>
<blockquote>
<p>为了方便管理维护，统一的请求处理都放在 services 文件夹中，并且一般按照 model 维度进行拆分文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">services/</span><br><span class="line">  user.js</span><br><span class="line">  api.js</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其中，<code>utils/request.js</code>是基于 <code>fetch</code> 的封装，便于统一处理 POST，GET 等请求参数，请求头，以及错误提示信息等</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// services/user.js</span><br><span class="line">import request from &#x27;../utils/request&#x27;;</span><br><span class="line"></span><br><span class="line">export async function query() &#123;</span><br><span class="line">  return request(&#x27;/api/users&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export async function queryCurrent() &#123;</span><br><span class="line">  return request(&#x27;/api/currentUser&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// models/user.js</span><br><span class="line">import &#123; queryCurrent &#125; from &#x27;../services/user&#x27;;</span><br><span class="line">...</span><br><span class="line">effects: &#123;</span><br><span class="line">  *fetch(&#123; payload &#125;, &#123; call, put &#125;) &#123;</span><br><span class="line">    ...</span><br><span class="line">    const response = yield call(queryUsers);</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>处理异步请求</strong></p>
<blockquote>
<p>在处理复杂的异步请求的时候，很容易让逻辑混乱，陷入嵌套陷阱，所以 <code>Ant Design Pro</code> 的底层基础框架 <code>dva</code>使用 <code>effect</code> 的方式来管理同步化异步请求</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">effects: &#123;</span><br><span class="line">  *fetch(&#123; payload &#125;, &#123; call, put &#125;) &#123;</span><br><span class="line">    yield put(&#123;</span><br><span class="line">      type: &#x27;changeLoading&#x27;,</span><br><span class="line">      payload: true,</span><br><span class="line">    &#125;);</span><br><span class="line">    // 异步请求 1</span><br><span class="line">    const response = yield call(queryFakeList, payload);</span><br><span class="line">    yield put(&#123;</span><br><span class="line">      type: &#x27;save&#x27;,</span><br><span class="line">      payload: response,</span><br><span class="line">    &#125;);</span><br><span class="line">    // 异步请求 2</span><br><span class="line">    const response2 = yield call(queryFakeList2, payload);</span><br><span class="line">    yield put(&#123;</span><br><span class="line">      type: &#x27;save2&#x27;,</span><br><span class="line">      payload: response2,</span><br><span class="line">    &#125;);</span><br><span class="line">    yield put(&#123;</span><br><span class="line">      type: &#x27;changeLoading&#x27;,</span><br><span class="line">      payload: false,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h1 id="九、引入外部模块"><a href="#九、引入外部模块" class="headerlink" title="九、引入外部模块"></a>九、引入外部模块</h1><blockquote>
<p>除了<code>antd</code>组件以及脚手架内置的业务组件，有时我们还需要引入其他外部模块，这里以引入富文本组件 <code>react-quill</code> 为例进行介绍</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ npm install react-quill --save</span><br><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import &#123; Button, notification, Card &#125; from &#x27;antd&#x27;;</span><br><span class="line">import ReactQuill from &#x27;react-quill&#x27;; </span><br><span class="line">import &#x27;react-quill/dist/quill.snow.css&#x27;;</span><br><span class="line"></span><br><span class="line">export default class NewPage extends React.Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    value: &#x27;test&#x27;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleChange = (value) =&gt; &#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">      value,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  prompt = () =&gt; &#123;</span><br><span class="line">    notification.open(&#123;</span><br><span class="line">      message: &#x27;We got value:&#x27;,</span><br><span class="line">      description: &lt;span dangerouslySetInnerHTML=&#123;&#123; __html: this.state.value &#125;&#125;&gt;&lt;/span&gt;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;Card title=&quot;富文本编辑器&quot;&gt;</span><br><span class="line">        &lt;ReactQuill value=&#123;this.state.value&#125; onChange=&#123;this.handleChange&#125; /&gt;</span><br><span class="line">        &lt;Button style=&#123;&#123; marginTop: 16 &#125;&#125; onClick=&#123;this.prompt&#125;&gt;Prompt&lt;/Button&gt;</span><br><span class="line">      &lt;/Card&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="十、图表"><a href="#十、图表" class="headerlink" title="十、图表"></a>十、图表</h1><blockquote>
<p>Ant Design Pro 提供了由设计师精心设计抽象的图表类型，是在 <code>BizCharts</code> 图表库基础上的二次封装，同时提供了业务中常用的图表套件，可以单独使用，也可以组合起来实现复杂的展示效果</p>
</blockquote>
<blockquote>
<p>图表组件 <a target="_blank" rel="noopener" href="https://pro.ant.design/components/Charts-cn/">https://pro.ant.design/components/Charts-cn/</a></p>
</blockquote>
<p><strong>使用 Ant Design Pro 的图表</strong></p>
<p>Charts 图表套件是在 <code>components/Charts</code> 包中，引用到项目就像使用其它组件一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ChartCard, MiniBar &#125; from &#x27;@/components/Charts&#x27;;</span><br><span class="line">import &#123; Tooltip, Icon &#125; from &#x27;antd&#x27;;</span><br><span class="line"></span><br><span class="line">const visitData = [</span><br><span class="line">  &#123;</span><br><span class="line">    x: &quot;2017-09-01&quot;,</span><br><span class="line">    y: 100</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    x: &quot;2017-09-02&quot;,</span><br><span class="line">    y: 120</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    x: &quot;2017-09-03&quot;,</span><br><span class="line">    y: 88</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    x: &quot;2017-09-04&quot;,</span><br><span class="line">    y: 65</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;ChartCard</span><br><span class="line">    title=&quot;支付笔数&quot;</span><br><span class="line">    action=&#123;</span><br><span class="line">      &lt;Tooltip title=&quot;支付笔数反应交易质量&quot;&gt;</span><br><span class="line">        &lt;Icon type=&quot;exclamation-circle-o&quot; /&gt;</span><br><span class="line">      &lt;/Tooltip&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    total=&quot;6,500&quot;</span><br><span class="line">    contentHeight=&#123;46&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;MiniBar height=&#123;46&#125; data=&#123;visitData&#125; /&gt;</span><br><span class="line">  &lt;/ChartCard&gt;,</span><br><span class="line">  mountNode</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/BizCharts">https://github.com/alibaba/BizCharts</a></p>
<p><strong>使用 BizCharts 绘制图表</strong></p>
<blockquote>
<p>如果 <code>Ant Design Pro</code> 不能满足你的业务需求，可以直接使用 <code>BizCharts</code> 封装自己的图表组件。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">npm install bizcharts --save</span><br><span class="line">import &#123; Chart, Axis, Tooltip, Geom &#125; from &#x27;bizcharts&#x27;;</span><br><span class="line"></span><br><span class="line">const data = [...];</span><br><span class="line"></span><br><span class="line">&lt;Chart height=&#123;400&#125; data=&#123;data&#125; forceFit&gt;</span><br><span class="line">  &lt;Axis name=&quot;month&quot; /&gt;</span><br><span class="line">  &lt;Axis name=&quot;temperature&quot; label=&#123;&#123; formatter: val =&gt; `$&#123;val&#125;°C` &#125;&#125; /&gt;</span><br><span class="line">  &lt;Tooltip crosshairs=&#123;&#123; type : &quot;y&quot; &#125;&#125; /&gt;</span><br><span class="line">  &lt;Geom type=&quot;line&quot; position=&quot;month*temperature&quot; size=&#123;2&#125; color=&#123;&#x27;city&#x27;&#125; /&gt;</span><br><span class="line">  &lt;Geom type=&#x27;point&#x27; position=&quot;month*temperature&quot; size=&#123;4&#125; color=&#123;&#x27;city&#x27;&#125; /&gt;</span><br><span class="line">&lt;/Chart&gt;</span><br></pre></td></tr></table></figure>

<h1 id="十一、业务图标"><a href="#十一、业务图标" class="headerlink" title="十一、业务图标"></a>十一、业务图标</h1><blockquote>
<p>通常情况下，你可以通过 <code>Ant Design</code> 提供的 &#96;&#96; 图标组件来使用 Ant Design 官方图标。基本使用方式如下：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Icon type=&quot;heart&quot; style=&#123;&#123; fontSize: &#x27;16px&#x27;, color: &#x27;hotpink&#x27; &#125;&#125; /&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果你没有在 <code>Ant Design</code> 官方图标中找到需要的图标，可以到 <code>iconfont.cn</code> 上采集并生成自己的业务图标库，再进行使用</p>
</blockquote>
<p><strong>生成图标库代码</strong></p>
<ul>
<li>首先，搜索并找到你需要的图标，将它采集到你的购物车里，在购物车里，你可以将选中的图标添加到项目中（没有的话，新建一个），后续生成的资源&#x2F;代码都是以项目为维度的。</li>
<li>如果你已经有了设计稿，只是需要生成相关代码，可以上传你的图标后，再进行上面的操作</li>
</ul>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/jJQYzRyqVFBBamUOppXH.png" alt="img"></p>
<blockquote>
<p>来到刚才选中的项目页，点击『生成代码』的链接，会在下方生成不同引入方式的代码，下面会分别介绍</p>
</blockquote>
<p><img src="https://gw.alipayobjects.com/zos/rmsportal/DbDSgiRukSANKWyhULir.png" alt="img"></p>
<p><strong>引入</strong></p>
<ul>
<li>有三种引入方式供你选择：<code>SVG Symbol</code>、<code>Unicode</code> 及 <code>Font class</code>。我们推荐在现代浏览器下使用 <code>SVG Symbol</code>方式引入。</li>
</ul>
<blockquote>
<p>SVG 符号引入是现代浏览器未来主流的图标引入方式。其方法是预先加载符号，在合适的地方引入并渲染为矢量图形。有如下特点：</p>
</blockquote>
<ul>
<li>支持多色图标，不再受到单色图标的限制</li>
<li>通过一些技巧，支持像字体那样，通过 <code>font-size</code>、<code>color</code> 来调整样式</li>
<li>支持IE 9+ 及现代浏览器</li>
</ul>
<blockquote>
<p>切换到 <code>Symbol</code> 页签，复制项目生成的地址代码：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//at.alicdn.com/t/font_405362_lyhvoky9rc7ynwmi.js</span><br></pre></td></tr></table></figure>

<p>加入图标样式代码，如果没有特殊的要求，你可以直接复用 Ant Design 图标的样式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.icon &#123;</span><br><span class="line">  width: 1em;</span><br><span class="line">  height: 1em;</span><br><span class="line">  fill: currentColor;</span><br><span class="line">  vertical-align: -.125em;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>挑选相应图标并获取类名，应用于页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg class=&quot;icon&quot; aria-hidden=&quot;true&quot;&gt;</span><br><span class="line">    &lt;use xlink:href=&quot;#icon-ali-pay&quot;&gt;&lt;/use&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure>

<p>你也可以通过使用 Ant Design 图标组件提供的 <code>Icon.createFromIconfontCN(&#123;...&#125;)</code> 方法来更加方便地使用图标，使用方式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Icon &#125; from &#x27;antd&#x27;;</span><br><span class="line"></span><br><span class="line">const IconFont = Icon.createFromIconfontCN(&#123;</span><br><span class="line">  scriptUrl: &#x27;//at.alicdn.com/t/font_405362_lyhvoky9rc7ynwmi.js&#x27;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default IconFont;</span><br></pre></td></tr></table></figure>

<p>之后可以像使用 &#96;&#96; 组件一样方便地使用，支持配置样式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;IconFont type=&quot;icon-ali-pay&quot; style=&#123;&#123; fontSize: &#x27;16px&#x27;, color: &#x27;lightblue&#x27; &#125;&#125; /&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>了解更多用法 <a target="_blank" rel="noopener" href="https://pro.ant.design/docs/biz-icon-cn#%E4%BA%8C%E3%80%81%E5%BC%95%E5%85%A5">https://pro.ant.design/docs/biz-icon-cn#%E4%BA%8C%E3%80%81%E5%BC%95%E5%85%A5</a></p>
</blockquote>
<h1 id="十二、Mock-和联调"><a href="#十二、Mock-和联调" class="headerlink" title="十二、Mock 和联调"></a>十二、Mock 和联调</h1><blockquote>
<p>Mock 数据是前端开发过程中必不可少的一环，是分离前后端开发的关键链路。通过预先跟服务器端约定好的接口，模拟请求数据甚至逻辑，能够让前端开发独立自主，不会被服务端的开发所阻塞</p>
</blockquote>
<ul>
<li>在 <code>Ant Design Pro</code> 中，因为我们的底层框架是 <code>umi</code>，而它自带了代理请求功能，通过代理请求就能够轻松处理数据模拟的功能</li>
</ul>
<p><strong>使用 umi 的 mock 功能</strong></p>
<blockquote>
<p>umi 里约定 mock 文件夹下的文件即 mock 文件，文件导出接口定义，支持基于 require 动态分析的实时刷新，支持 ES6 语法，以及友好的出错提示</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  // 支持值为 Object 和 Array</span><br><span class="line">  &#x27;GET /api/users&#x27;: &#123; users: [1, 2] &#125;,</span><br><span class="line"></span><br><span class="line">  // GET POST 可省略</span><br><span class="line">  &#x27;/api/users/1&#x27;: &#123; id: 1 &#125;,</span><br><span class="line"></span><br><span class="line">  // 支持自定义函数，API 参考 express@4</span><br><span class="line">  &#x27;POST /api/users/create&#x27;: (req, res) =&gt; &#123; res.end(&#x27;OK&#x27;); &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当客户端（浏览器）发送请求，如：<code>GET /api/users</code>，那么本地启动的 umi dev 会跟此配置文件匹配请求路径以及方法，如果匹配到了，就会将请求通过配置处理，就可以像样例一样，你可以直接返回数据，也可以通过函数处理以及重定向到另一个服务器</p>
</blockquote>
<p>了解更多 <a target="_blank" rel="noopener" href="https://pro.ant.design/docs/mock-api-cn#%E4%BD%BF%E7%94%A8-umi-%E7%9A%84-mock-%E5%8A%9F%E8%83%BD">https://pro.ant.design/docs/mock-api-cn#%E4%BD%BF%E7%94%A8-umi-%E7%9A%84-mock-%E5%8A%9F%E8%83%BD</a></p>
<h1 id="十三、主题定制"><a href="#十三、主题定制" class="headerlink" title="十三、主题定制"></a>十三、主题定制</h1><blockquote>
<p>我们基于 Ant Design React 进行开发，完全支持官方提供的 less 变量定制功能. 你可以在脚手架目录中找到 <code>config/config.js</code> 代码类似这样</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">theme: &#123;</span><br><span class="line">  &#x27;font-size-base&#x27;: &#x27;14px&#x27;,</span><br><span class="line">  &#x27;badge-font-size&#x27;: &#x27;12px&#x27;,</span><br><span class="line">  &#x27;btn-font-size-lg&#x27;: &#x27;@font-size-base&#x27;,</span><br><span class="line">  &#x27;menu-dark-bg&#x27;: &#x27;#00182E&#x27;,</span><br><span class="line">  &#x27;menu-dark-submenu-bg&#x27;: &#x27;#000B14&#x27;,</span><br><span class="line">  &#x27;layout-sider-background&#x27;: &#x27;#00182E&#x27;,</span><br><span class="line">  &#x27;layout-body-background&#x27;: &#x27;#f0f2f5&#x27;,</span><br><span class="line">&#125;;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h1 id="十四、权限管理"><a href="#十四、权限管理" class="headerlink" title="十四、权限管理"></a>十四、权限管理</h1><blockquote>
<p>只需要在配置菜单的时候配置上准入身份，在登录成功以后获取到登陆者身份以后更新登录人身份参数即可</p>
</blockquote>
<h2 id="权限组件-Authorized"><a href="#权限组件-Authorized" class="headerlink" title="权限组件 Authorized"></a>权限组件 Authorized</h2><blockquote>
<p>这是脚手架权限管理的基础，基本思路是通过比对当前权限与准入权限，决定展示正常渲染内容还是异常内容</p>
</blockquote>
<p><strong>控制菜单和路由显示</strong></p>
<blockquote>
<p>如需对某些页面进行权限控制，只须在路由配置文件 <code>router.config.js</code> 中设置 <code>authority</code> 属性即可，代表该路由的准入权限，pro 的路由系统中会默认包裹 <code>Authorized</code> 进行判断处理。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: &#x27;/form&#x27;,</span><br><span class="line">  icon: &#x27;form&#x27;,</span><br><span class="line">  name: &#x27;form&#x27;,</span><br><span class="line">  routes:[&#123;</span><br><span class="line">    path: &#x27;/form/basic-form&#x27;,</span><br><span class="line">    name: &#x27;basicform&#x27;,</span><br><span class="line">    component: &#x27;./Forms/BasicForm&#x27;,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    path: &#x27;/form/step-form&#x27;,</span><br><span class="line">    name: &#x27;stepform&#x27;,</span><br><span class="line">    component: &#x27;./Forms/StepForm&#x27;,</span><br><span class="line">    authority: [&#x27;guest&#x27;], // 配置准入权限，可以配置多个角色</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    path: &#x27;/form/advanced-form&#x27;,</span><br><span class="line">    name: &#x27;advancedform&#x27;,</span><br><span class="line">    component: &#x27;./Forms/AdvancedForm&#x27;,</span><br><span class="line">    authority: [&#x27;admin&#x27;], // 配置准入权限，可以配置多个角色</span><br><span class="line">  &#125;],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制页面元素显示"><a href="#控制页面元素显示" class="headerlink" title="控制页面元素显示"></a>控制页面元素显示</h2><blockquote>
<p>使用 <code>Authorized</code> 或<code>Authorized.Secured</code> 可以很方便地控制元素&#x2F;组件的渲染。<a target="_blank" rel="noopener" href="https://pro.ant.design/components/Authorized#Authorized.Secured">https://pro.ant.design/components/Authorized#Authorized.Secured</a></p>
</blockquote>
<h2 id="demo关于权限简介"><a href="#demo关于权限简介" class="headerlink" title="demo关于权限简介"></a>demo关于权限简介</h2><ul>
<li>用邮箱自己注册账户（注册后可以登录但是没有任何权限）<code>guest</code></li>
<li>联系管理员分配权限（分配后可以查看有权限的页面）</li>
<li>每次登录后获取最新的权限身份（如：<code>admin</code>，<code>user</code>，<code>guest</code>）</li>
</ul>
<blockquote>
<p>在<code>src/router.js</code>中会发现如下代码</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;AuthorizedRoute</span><br><span class="line">    path=&quot;/&quot;</span><br><span class="line">    render=&#123;props =&gt; &lt;BasicLayout &#123;...props&#125; /&gt;&#125;</span><br><span class="line">    authority=&#123;[&#x27;admin&#x27;, &#x27;user&#x27;, &#x27;guest&#x27;]&#125;</span><br><span class="line">    redirectPath=&quot;/user/login&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其中<code>authority</code>对象就是准入身份的数组，表示只有这些身份的人可以登录，我们在配置的时候一定不要忘记在这更新我们新增的身份</p>
</blockquote>
<ul>
<li>然后就是<code>menu.js</code>,如下，展示了我们在配置菜单的时候怎么配身份</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const menuData = [&#123;</span><br><span class="line">  name: &#x27;题库管理&#x27;,</span><br><span class="line">  path: &#x27;question&#x27;,</span><br><span class="line">  icon: &#x27;warning&#x27;,</span><br><span class="line">  authority: [&#x27;admin&#x27;, &#x27;user&#x27;],</span><br><span class="line">  children: [&#123;</span><br><span class="line">    name: &#x27;题库列表&#x27;,</span><br><span class="line">    path: &#x27;list&#x27;,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    name: &#x27;编辑题目&#x27;,</span><br><span class="line">    path: &#x27;create-question&#x27;,</span><br><span class="line">    hideInMenu: true,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    name: &#x27;科目管理&#x27;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  name: &#x27;账号管理&#x27;,</span><br><span class="line">  icon: &#x27;warning&#x27;,</span><br><span class="line">  path: &#x27;account&#x27;,</span><br><span class="line">  children: [&#123;</span><br><span class="line">    name: &#x27;账号列表&#x27;,</span><br><span class="line">    path: &#x27;list&#x27;,</span><br><span class="line">    authority: &#x27;admin&#x27;,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    name: &#x27;建设中&#x27;,</span><br><span class="line">    path: &#x27;&#x27;,</span><br><span class="line">    authority: [&#x27;admin&#x27;, &#x27;user&#x27;],</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>登录成功以后怎么获取权限了</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">effects：&#123;</span><br><span class="line">* login(&#123;payload&#125;, &#123;call, put&#125;) &#123;</span><br><span class="line">      const response = yield call(login, payload);</span><br><span class="line">      yield put(&#123;</span><br><span class="line">        type: &#x27;changeLoginStatus&#x27;,</span><br><span class="line">        payload: response,</span><br><span class="line">      &#125;);</span><br><span class="line">      // 登录成功以后更新权限，跳转页面</span><br><span class="line">      if (response &amp;&amp; response.code === &#x27;0000&#x27;) &#123;</span><br><span class="line">        reloadAuthorized();</span><br><span class="line">        yield put(routerRedux.push(&#x27;/&#x27;));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;，</span><br><span class="line">reducers: &#123;</span><br><span class="line">    changeLoginStatus(state, &#123;payload&#125;) &#123;</span><br><span class="line">      let _status = &quot;ok&quot;;</span><br><span class="line">      let _user = &quot;admin&quot;;</span><br><span class="line">      setToken(&quot;token&quot;);</span><br><span class="line">      setAuthority(_user);//设置权限</span><br><span class="line">      return &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        status: _status,</span><br><span class="line">        type: &#x27;account&#x27;,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>我们看看<code>setAuthority</code>、<code>reloadAuthorized</code>这两个方法都做了什么事儿</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//设置身份</span><br><span class="line">export function setAuthority(authority) &#123;</span><br><span class="line">  return localStorage.setItem(&#x27;antd-pro-authority&#x27;, authority);</span><br><span class="line">&#125;</span><br><span class="line">//获取身份</span><br><span class="line">export function getAuthority() &#123;</span><br><span class="line">  return localStorage.getItem(&#x27;antd-pro-authority&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如此而且，只是把新的身份值存在<code>localStorage</code>里边，注意<code>getAuthority</code>，下边会用到</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import RenderAuthorized from &#x27;../components/Authorized&#x27;;</span><br><span class="line">import &#123; getAuthority &#125; from &#x27;./authority&#x27;;</span><br><span class="line">let Authorized = RenderAuthorized(getAuthority());</span><br><span class="line">const reloadAuthorized = () =&gt; &#123;</span><br><span class="line">  Authorized = RenderAuthorized(getAuthority());</span><br><span class="line">&#125;;</span><br><span class="line">export &#123; reloadAuthorized &#125;;</span><br><span class="line">export default Authorized;</span><br><span class="line">RenderAuthorized: (currentAuthority: string | () =&gt; string) =&gt; Authorized</span><br></pre></td></tr></table></figure>

<blockquote>
<p>权限组件默认 <code>export RenderAuthorized</code> 函数，它接收当前权限作为参数，返回一个权限对象，该对象提供以下几种使用方式</p>
</blockquote>
<p><strong>Authorized</strong></p>
<blockquote>
<p>最基础的权限控制</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>children</code></td>
<td align="left">正常渲染的元素，权限判断通过时展示</td>
</tr>
<tr>
<td align="left"><code>authority</code></td>
<td align="left">准入权限&#x2F;权限判断</td>
</tr>
<tr>
<td align="left"><code>noMatch</code></td>
<td align="left">权限异常渲染元素，权限判断不通过时展示</td>
</tr>
</tbody></table>
<p><strong>Authorized.AuthorizedRoute</strong></p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>authority</code></td>
<td align="left">准入权限&#x2F;权限判断</td>
</tr>
<tr>
<td align="left"><code>redirectPath</code></td>
<td align="left">权限异常时重定向的页面路由</td>
</tr>
</tbody></table>
<p><strong>Authorized.Secured</strong></p>
<blockquote>
<p>注解方式，[<code>@Authorized.Secured](mailto:</code>@Authorized.Secured)(authority, error)&#96;</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>authority</code></td>
<td align="left">准入权限&#x2F;权限判断</td>
</tr>
<tr>
<td align="left"><code>error</code></td>
<td align="left">权限异常时渲染元素</td>
</tr>
</tbody></table>
<p><strong>Authorized.check</strong></p>
<blockquote>
<p>函数形式的 <code>Authorized</code>，用于某些不能被 <code>HOC</code> 包裹的组件。 <code>Authorized.check(authority, target, Exception)</code></p>
</blockquote>
<ul>
<li>注意：传入一个 <code>Promise</code> 时，无论正确还是错误返回的都是一个 <code>ReactClass</code></li>
</ul>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>authority</code></td>
<td align="left">准入权限&#x2F;权限判断</td>
</tr>
<tr>
<td align="left"><code>target</code></td>
<td align="left">权限判断通过时渲染的元素</td>
</tr>
<tr>
<td align="left"><code>Exception</code></td>
<td align="left">权限异常时渲染元素</td>
</tr>
</tbody></table>
<h1 id="十五、构建和发布"><a href="#十五、构建和发布" class="headerlink" title="十五、构建和发布"></a>十五、构建和发布</h1><p><strong>构建</strong></p>
<blockquote>
<p>当项目开发完毕，只需要运行一行命令就可以打包你的应用：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run build</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于 Ant Design Pro 使用的工具 Umi 已经将复杂的流程封装完毕，构建打包文件只需要一个命令 umi build，构建打包成功之后，会在根目录生成 dist 文件夹，里面就是构建打包好的文件，通常是 <em>.js、</em>.css、index.html 等静态文件</p>
</blockquote>
<p><strong>分析构建文件体积</strong></p>
<blockquote>
<p>如果你的构建文件很大，你可以通过 analyze 命令构建并分析依赖模块的体积分布，从而优化你的代码。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run analyze</span><br></pre></td></tr></table></figure>

<p><strong>发布</strong></p>
<blockquote>
<p>对于发布来讲，只需要将最终生成的静态文件，也就是通常情况下 dist 文件夹的静态文件发布到你的 cdn 或者静态服务器即可，需要注意的是其中的 <code>index.html</code> 通常会是你后台服务的入口页面，在确定了 js 和 css 的静态之后可能需要改变页面的引入路径</p>
</blockquote>
<p><strong>前端路由与服务端的结合</strong></p>
<blockquote>
<p>Ant Design Pro 使用的 Umi 支持两种路由方式：<code>browserHistory</code> 和 <code>hashHistory</code>。</p>
</blockquote>
<ul>
<li>可以在 <code>config/config.js</code> 中进行配置选择用哪个方式：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  history: &#x27;hash&#x27;, // 默认是 browser</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="十六、一些问题"><a href="#十六、一些问题" class="headerlink" title="十六、一些问题"></a>十六、一些问题</h1><h2 id="在ant-design-pro中解决跨域办法"><a href="#在ant-design-pro中解决跨域办法" class="headerlink" title="在ant-design-pro中解决跨域办法"></a>在ant-design-pro中解决跨域办法</h2><blockquote>
<p>需要在配置文件中(<code>.webpackrc</code>)加入如下代码</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;proxy&quot;: &#123;</span><br><span class="line">  &quot;/api&quot;: &#123;</span><br><span class="line">    &quot;target&quot;: &quot;http://xxx:xx/&quot;,</span><br><span class="line">    &quot;changeOrigin&quot;: true,</span><br><span class="line">    &quot;pathRewrite&quot;: &#123; &quot;^/api&quot; : &quot;&quot; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意的是此处不是将<code>/api/</code>代理到正式请求<code>/api/</code>中，（例如请求<code>/api/users</code>则会代理到<code>http://xxx:xx/users</code>）<br>如果需要多次代理且需要代理到不同的服务器则可以在配置文件中进行如下配置</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;proxy&quot;: &#123;</span><br><span class="line">      &quot;/test&quot;: &#123;</span><br><span class="line">        &quot;target&quot;: &quot;http://xxx:xx/&quot;,</span><br><span class="line">        &quot;changeOrigin&quot;: true,</span><br><span class="line">        &quot;pathRewrite&quot;: &#123; &quot;^/test&quot; : &quot;&quot; &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;/cross&quot;: &#123;</span><br><span class="line">        &quot;target&quot;: &quot;http://jsonplaceholder.typicode.com&quot;,</span><br><span class="line">        &quot;changeOrigin&quot;: true,</span><br><span class="line">        &quot;pathRewrite&quot;: &#123;&quot;^/cross&quot;: &quot;&quot;&#125;</span><br><span class="line">      &#125; // 此处有一点需要注意，不能在最后一个代理对象后面加逗号，否则会报错！！！</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="在model中怎么同时发起多次请求"><a href="#在model中怎么同时发起多次请求" class="headerlink" title="在model中怎么同时发起多次请求"></a>在model中怎么同时发起多次请求</h2><blockquote>
<p>因为<code>yield</code>将异步请求转为同步请求了，所以请求会按照同步顺序依次执行，使请求时间延长</p>
</blockquote>
<p><strong>错误写法</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// effects将按顺序执行</span><br><span class="line">const response = yield call(fetch, &#x27;/users&#x27;);</span><br><span class="line">const res = yield call(fetch, &#x27;/roles&#x27;);</span><br></pre></td></tr></table></figure>

<p><strong>正确写法</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// effects将会同步执行</span><br><span class="line">const [response, res] = yield [</span><br><span class="line">  call(fetch, &#x27;/users&#x27;),</span><br><span class="line">  call(fetch, &#x27;/roles&#x27;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-React/React-组件通信" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/21/React/React-%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/" class="article-date">
  	<time datetime="2019-12-21T01:20:03.000Z" itemprop="datePublished">2019-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/21/React/React-%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/">
        React组件通信
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一如何通信"><a href="#一如何通信" class="headerlink" title="一如何通信"></a>一如何通信</h2><p>组件传递的方式有很多种，根据传送者和接收者可以分为如下：</p>
<ul>
<li>父组件向子组件传递</li>
<li>子组件向父组件传递</li>
<li>兄弟组件之间的通信</li>
<li>父组件向后代组件传递</li>
<li>非关系组件传递</li>
</ul>
<h3 id="父组件向子组件传递"><a href="#父组件向子组件传递" class="headerlink" title="父组件向子组件传递"></a>父组件向子组件传递</h3><p>由于<code>React</code>的数据流动为单向的，父组件向子组件传递是最常见的方式</p>
<p>父组件在调用子组件的时候，只需要在子组件标签内传递参数，子组件通过<code>props</code>属性就能接收父组件传递过来的参数</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">EmailInput</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      Email: <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;props.email&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> element = <span class="language-xml"><span class="tag">&lt;<span class="name">EmailInput</span> <span class="attr">email</span>=<span class="string">&quot;123124132@163.com&quot;</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="子组件向父组件传递"><a href="#子组件向父组件传递" class="headerlink" title="子组件向父组件传递"></a>子组件向父组件传递</h3><p>子组件向父组件通信的基本思路是，父组件向子组件传一个函数，然后通过这个函数的回调，拿到子组件传过来的值</p>
<p>父组件对应代码如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parents</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">price</span>: <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getItemPrice</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">price</span>: e</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>price: &#123;this.state.price&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;/* 向子组件中传入一个函数  */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Child</span> <span class="attr">getPrice</span>=<span class="string">&#123;this.getItemPrice.bind(this)&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>子组件对应代码如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">clickGoods</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="comment">// 在此函数中传入值</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">getPrice</span>(e);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.clickGoods.bind(this,</span> <span class="attr">100</span>)&#125;&gt;</span>goods1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.clickGoods.bind(this,</span> <span class="attr">1000</span>)&#125;&gt;</span>goods2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="兄弟组件之间的通信"><a href="#兄弟组件之间的通信" class="headerlink" title="兄弟组件之间的通信"></a>兄弟组件之间的通信</h3><p>如果是兄弟组件之间的传递，则父组件作为中间层来实现数据的互通，通过使用父组件传递</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;<span class="attr">count</span>: <span class="number">0</span>&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  setCount = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">count</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">count</span> + <span class="number">1</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">SiblingA</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">count</span>=<span class="string">&#123;this.state.count&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">SiblingB</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;this.setCount&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="父组件向后代组件传递"><a href="#父组件向后代组件传递" class="headerlink" title="父组件向后代组件传递"></a>父组件向后代组件传递</h3><p>父组件向后代组件传递数据是一件最普通的事情，就像全局数据一样</p>
<p>使用<code>context</code>提供了组件之间通讯的一种方式，可以共享数据，其他数据都能读取对应的数据</p>
<p>通过使用<code>React.createContext</code>创建一个<code>context</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">PriceContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(<span class="string">&#x27;price&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>context</code>创建成功后，其下存在<code>Provider</code>组件用于创建数据源，<code>Consumer</code>组件用于接收数据，使用实例如下：</p>
<p><code>Provider</code>组件通过<code>value</code>属性用于给后代组件传递数据：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">PriceContext</span>.<span class="property">Provider</span> value=&#123;<span class="number">100</span>&#125;&gt;</span><br><span class="line">&lt;/<span class="title class_">PriceContext</span>.<span class="property">Provider</span>&gt;</span><br></pre></td></tr></table></figure>

<p>如果想要获取<code>Provider</code>传递的数据，可以通过<code>Consumer</code>组件或者或者使用<code>contextType</code>属性接收，对应分别如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> contextType = <span class="title class_">PriceContext</span>;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> price = <span class="variable language_">this</span>.<span class="property">context</span>;</span><br><span class="line">    <span class="comment">/* 基于这个值进行渲染工作 */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Consumer</code>组件：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">PriceContext</span>.<span class="property">Consumer</span>&gt;</span><br><span class="line">    &#123; <span class="comment">/*这里是一个函数*/</span> &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="params">price</span> =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>price：&#123;price&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&lt;/<span class="title class_">PriceContext</span>.<span class="property">Consumer</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="非关系组件传递"><a href="#非关系组件传递" class="headerlink" title="非关系组件传递"></a>非关系组件传递</h3><p>如果组件之间关系类型比较复杂的情况，建议将数据进行一个全局资源管理，从而实现通信，例如<code>redux</code>。关于<code>redux</code>的使用后续再详细介绍</p>
<h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><p>由于<code>React</code>是单向数据流，主要思想是组件不会改变接收的数据，只会监听数据的变化，当数据发生变化时它们会使用接收到的新值，而不是去修改已有的值</p>
<p>因此，可以看到通信过程中，数据的存储位置都是存放在上级位置中</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-React/React-引入css" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/16/React/React-%E5%BC%95%E5%85%A5css/" class="article-date">
  	<time datetime="2019-12-16T04:35:42.000Z" itemprop="datePublished">2019-12-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/16/React/React-%E5%BC%95%E5%85%A5css/">
        React引入css
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、是什么"><a href="#一、是什么" class="headerlink" title="一、是什么"></a>一、是什么</h2><p>组件式开发选择合适的<code>css</code>解决方案尤为重要</p>
<p>通常会遵循以下规则：</p>
<ul>
<li>可以编写局部css，不会随意污染其他组件内的原生；</li>
<li>可以编写动态的css，可以获取当前组件的一些状态，根据状态的变化生成不同的css样式；</li>
<li>支持所有的css特性：伪类、动画、媒体查询等；</li>
<li>编写起来简洁方便、最好符合一贯的css风格特点</li>
</ul>
<p>在这一方面，<code>vue</code>使用<code>css</code>起来更为简洁：</p>
<ul>
<li>通过 style 标签编写样式</li>
<li>scoped 属性决定编写的样式是否局部有效</li>
<li>lang 属性设置预处理器</li>
<li>内联样式风格的方式来根据最新状态设置和改变css</li>
</ul>
<p>而在<code>react</code>中，引入<code>CSS</code>就不如<code>Vue</code>方便简洁，其引入<code>css</code>的方式有很多种，各有利弊</p>
<h2 id="二、方式"><a href="#二、方式" class="headerlink" title="二、方式"></a>二、方式</h2><p>常见的<code>CSS</code>引入方式有以下：</p>
<ul>
<li>在组件内直接使用</li>
<li>组件中引入 .css 文件</li>
<li>组件中引入 .module.css 文件</li>
<li>CSS in JS</li>
</ul>
<h3 id="在组件内直接使用"><a href="#在组件内直接使用" class="headerlink" title="在组件内直接使用"></a>在组件内直接使用</h3><p>直接在组件中书写<code>css</code>样式，通过<code>style</code>属性直接引入，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> div1 = &#123;</span><br><span class="line">  <span class="attr">width</span>: <span class="string">&quot;300px&quot;</span>,</span><br><span class="line">  <span class="attr">margin</span>: <span class="string">&quot;30px auto&quot;</span>,</span><br><span class="line">  <span class="attr">backgroundColor</span>: <span class="string">&quot;#44014C&quot;</span>,  <span class="comment">//驼峰法</span></span><br><span class="line">  <span class="attr">minHeight</span>: <span class="string">&quot;200px&quot;</span>,</span><br><span class="line">  <span class="attr">boxSizing</span>: <span class="string">&quot;border-box&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">     <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;div1&#125;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;backgroundColor:</span>&quot;<span class="attr">red</span>&quot;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    );</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">export default Test;</span></span><br></pre></td></tr></table></figure>

<p>上面可以看到，<code>css</code>属性需要转换成驼峰写法</p>
<p>这种方式优点：</p>
<ul>
<li>内联样式, 样式之间不会有冲突</li>
<li>可以动态获取当前state中的状态</li>
</ul>
<p>缺点：</p>
<ul>
<li>写法上都需要使用驼峰标识</li>
<li>某些样式没有提示</li>
<li>大量的样式, 代码混乱</li>
<li>某些样式无法编写(比如伪类&#x2F;伪元素)</li>
</ul>
<h3 id="组件中引入css文件"><a href="#组件中引入css文件" class="headerlink" title="组件中引入css文件"></a>组件中引入css文件</h3><p>将<code>css</code>单独写在一个<code>css</code>文件中，然后在组件中直接引入</p>
<p><code>App.css</code>文件：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.title</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.desc</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">  <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>组件中引入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">PureComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;./Home&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">className</span>=<span class="string">&quot;title&quot;</span>&gt;</span>我是App的标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;desc&quot;</span>&gt;</span>我是App中的一段文字描述&lt;/p &gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Home</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    )</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这种方式存在不好的地方在于样式是全局生效，样式之间会互相影响</p>
<h3 id="组件中引入-module-css-文件"><a href="#组件中引入-module-css-文件" class="headerlink" title="组件中引入 .module.css 文件"></a>组件中引入 .module.css 文件</h3><p>将<code>css</code>文件作为一个模块引入，这个模块中的所有<code>css</code>，只作用于当前组件。不会影响当前组件的后代组件</p>
<p>这种方式是<code>webpack</code>特工的方案，只需要配置<code>webpack</code>配置文件中<code>modules:true</code>即可</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">PureComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;./Home&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.module.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">className</span>=<span class="string">&quot;title&quot;</span>&gt;</span>我是App的标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;desc&quot;</span>&gt;</span>我是App中的一段文字描述&lt;/p &gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Home</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    )</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这种方式能够解决局部作用域问题，但也有一定的缺陷：</p>
<ul>
<li>引用的类名，不能使用连接符(.xxx-xx)，在 JavaScript 中是不识别的</li>
<li>所有的 className 都必须使用 {style.className} 的形式来编写</li>
<li>不方便动态来修改某些样式，依然需要使用内联样式的方式；</li>
</ul>
<h3 id="CSS-in-JS"><a href="#CSS-in-JS" class="headerlink" title="CSS in JS"></a>CSS in JS</h3><p>CSS-in-JS， 是指一种模式，其中<code>CSS</code>由 <code>JavaScript</code>生成而不是在外部文件中定义</p>
<p>此功能并不是 React 的一部分，而是由第三方库提供，例如：</p>
<ul>
<li>styled-components</li>
<li>emotion</li>
<li>glamorous</li>
</ul>
<p>下面主要看看<code>styled-components</code>的基本使用</p>
<p>本质是通过函数的调用，最终创建出一个组件：</p>
<ul>
<li>这个组件会被自动添加上一个不重复的class</li>
<li>styled-components会给该class添加相关的样式</li>
</ul>
<p>基本使用如下：</p>
<p>创建一个<code>style.js</code>文件用于存放样式组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">SelfLink</span> = styled.<span class="property">div</span><span class="string">`</span></span><br><span class="line"><span class="string">  height: 50px;</span></span><br><span class="line"><span class="string">  border: 1px solid red;</span></span><br><span class="line"><span class="string">  color: yellow;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">SelfButton</span> = styled.<span class="property">div</span><span class="string">`</span></span><br><span class="line"><span class="string">  height: 150px;</span></span><br><span class="line"><span class="string">  width: 150px;</span></span><br><span class="line"><span class="string">  color: <span class="subst">$&#123;props =&gt; props.color&#125;</span>;</span></span><br><span class="line"><span class="string">  background-image: url(<span class="subst">$&#123;props =&gt; props.src&#125;</span>);</span></span><br><span class="line"><span class="string">  background-size: 150px 150px;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<p>引入样式组件也很简单：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">SelfLink</span>, <span class="title class_">SelfButton</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./style&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">  &#125;  </span><br><span class="line"> </span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">     <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">SelfLink</span> <span class="attr">title</span>=<span class="string">&quot;People&#x27;s Republic of China&quot;</span>&gt;</span>app.js<span class="tag">&lt;/<span class="name">SelfLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">SelfButton</span> <span class="attr">color</span>=<span class="string">&quot;palevioletred&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> &quot;<span class="attr">pink</span>&quot; &#125;&#125; <span class="attr">src</span>=<span class="string">&#123;fist&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          SelfButton</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">SelfButton</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Test</span>;</span><br></pre></td></tr></table></figure>

<h2 id="三、区别"><a href="#三、区别" class="headerlink" title="三、区别"></a>三、区别</h2><p>通过上面四种样式的引入，可以看到：</p>
<ul>
<li>在组件内直接使用<code>css</code>该方式编写方便，容易能够根据状态修改样式属性，但是大量的演示编写容易导致代码混乱</li>
<li>组件中引入 .css 文件符合我们日常的编写习惯，但是作用域是全局的，样式之间会层叠</li>
<li>引入.module.css 文件能够解决局部作用域问题，但是不方便动态修改样式，需要使用内联的方式进行样式的编写</li>
<li>通过css in js 这种方法，可以满足大部分场景的应用，可以类似于预处理器一样样式嵌套、定义、修改状态等</li>
</ul>
<p>至于使用<code>react</code>用哪种方案引入<code>css</code>，并没有一个绝对的答案，可以根据各自情况选择合适的方案</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-React/React-dva" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/12/React/React-dva/" class="article-date">
  	<time datetime="2019-12-12T02:50:48.000Z" itemprop="datePublished">2019-12-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/12/React/React-dva/">
        React dva总结
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一、环境搭建"><a href="#一、环境搭建" class="headerlink" title="一、环境搭建"></a>一、环境搭建</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ npm install dva-cli -g</span><br><span class="line"></span><br><span class="line"># 创建应用</span><br><span class="line">$ dva new dva-quickstart</span><br><span class="line"></span><br><span class="line"># 启动</span><br><span class="line">$ npm start</span><br></pre></td></tr></table></figure>

<blockquote>
<p>react项目的推荐目录结构（如果使用dva脚手架创建，则自动生成如下）</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">|── /mock/             # 数据mock的接口文件  </span><br><span class="line">|── /src/              # 项目源码目录（我们开发的主要工作区域）   </span><br><span class="line">|   |── /components/   # 项目组件（用于路由组件内引用的可复用组件）   </span><br><span class="line">|   |── /routes/       # 路由组件（页面维度） </span><br><span class="line">|   |  |── route1.js  </span><br><span class="line">|   |  |── route2.js   # 根据router.js中的映射，在不同的url下，挂载不同的路由组件</span><br><span class="line">|   |  └── route3.js    </span><br><span class="line">|   |── /models/       # 数据模型（可以理解为store，用于存储数据与方法）  </span><br><span class="line">|   |  |── model1.js  </span><br><span class="line">|   |  |── model2.js   # 选择分离为多个model模型，是根据业务实体进行划分</span><br><span class="line">|   |  └── model3.js  </span><br><span class="line">|   |── /services/     # 数据接口（处理前台页面的ajax请求，转发到后台）   </span><br><span class="line">|   |── /utils/        # 工具函数（工具库，存储通用函数与配置参数）     </span><br><span class="line">|   |── router.js       # 路由配置（定义路由与对应的路由组件）  </span><br><span class="line">|   |── index.js       # 入口文件  </span><br><span class="line">|   |── index.less      </span><br><span class="line">|   └── index.html     </span><br><span class="line">|── package.json       # 项目信息  </span><br><span class="line">└── proxy.config.js    # 数据mock配置</span><br></pre></td></tr></table></figure>

<p><strong>使用 antd</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i babel-plugin-import --save</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>babel-plugin-import</code> 是用来按需加载 <code>antd</code> 的脚本和样式的</p>
</blockquote>
<ul>
<li>编辑 <code>.webpackrc</code>，使 <code>babel-plugin-import</code> 插件生效</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">+  &quot;extraBabelPlugins&quot;: [</span><br><span class="line">+    [&quot;import&quot;, &#123; &quot;libraryName&quot;: &quot;antd&quot;, &quot;libraryDirectory&quot;: &quot;es&quot;, &quot;style&quot;: &quot;css&quot; &#125;]</span><br><span class="line">+  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="二、初识Dva"><a href="#二、初识Dva" class="headerlink" title="二、初识Dva"></a>二、初识Dva</h1><h2 id="2-1-Dva的特性"><a href="#2-1-Dva的特性" class="headerlink" title="2.1 Dva的特性"></a>2.1 Dva的特性</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dva = React-Router + Redux + Redux-saga</span><br></pre></td></tr></table></figure>

<ul>
<li>仅有 5 个<code>API</code>，仅有5个主要的<code>api</code></li>
<li>支持 <code>HMR</code>，支持模块的热更新</li>
<li>支持 <code>SSR (ServerSideRender)</code>，支持服务器端渲染</li>
<li>支持 <code>Mobile/ReactNative</code>，支持移动手机端的代码编写</li>
<li>支持<code>TypeScript</code></li>
<li>支持路由和 <code>Model</code> 的动态加载</li>
</ul>
<h2 id="2-2-Dva的五个API"><a href="#2-2-Dva的五个API" class="headerlink" title="2.2 Dva的五个API"></a>2.2 Dva的五个API</h2><p><img src="https://poetries1.gitee.io/img-repo/20191001/43.png" alt="img"></p>
<h3 id="2-2-1-app-x3D-dva-Opts"><a href="#2-2-1-app-x3D-dva-Opts" class="headerlink" title="2.2.1 app &#x3D; dva(Opts)"></a>2.2.1 app &#x3D; dva(Opts)</h3><blockquote>
<p><code>app = dva(Opts)</code>：创建应用，返回 <code>dva</code> 实例。(注：dva 支持多实例)**</p>
</blockquote>
<p>在<code>opts</code>可以配置所有的<code>hooks</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const app = dva(&#123;</span><br><span class="line">     history,</span><br><span class="line">     initialState,</span><br><span class="line">     onError,</span><br><span class="line">     onAction,</span><br><span class="line">     onStateChange,</span><br><span class="line">     onReducer,</span><br><span class="line">     onEffect,</span><br><span class="line">     onHmr,</span><br><span class="line">     extraReducers,</span><br><span class="line">     extraEnhancers,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>hooks包含如下配置项</p>
</blockquote>
<p>1、 <code>onError((err, dispatch) =&gt; &#123;&#125;)</code></p>
<ul>
<li><code>effect</code> 执行错误或 <code>subscription</code> 通过<code>done</code> 主动抛错时触发，可用于管理全局出错状态</li>
<li>注意：<code>subscription</code> 并没有加 <code>try...catch</code>，所以有错误时需通过第二个参数 <code>done</code> 主动抛错</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.model(&#123;</span><br><span class="line">  subscriptions: &#123;</span><br><span class="line">    setup(&#123; dispatch &#125;, done) &#123;</span><br><span class="line">      done(e)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>2、 <code>onAction(fn | fn[])</code></p>
<blockquote>
<p>在<code>action</code>被<code>dispatch</code>时触发，用于注册 <code>redux</code> 中间件。支持函数或函数数组格式</p>
</blockquote>
<ul>
<li>例如我们要通过 <code>redux-logger</code> 打印日志</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import createLogger from &#x27;redux-logger&#x27;;</span><br><span class="line">const app = dva(&#123;</span><br><span class="line">  onAction: createLogger(opts),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>3、 <code>onStateChange(fn)</code></p>
<blockquote>
<p><code>state</code> 改变时触发，可用于同步 state 到 <code>localStorage</code>，服务器端等</p>
</blockquote>
<p>4、 <code>onReducer(fn)</code></p>
<blockquote>
<p>封装 <code>reducer</code> 执行，比如借助 <code>redux-undo</code> 实现 <code>redo/undo</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import undoable from &#x27;redux-undo&#x27;;</span><br><span class="line">const app = dva(&#123;</span><br><span class="line">  onReducer: reducer =&gt; &#123;</span><br><span class="line">    return (state, action) =&gt; &#123;</span><br><span class="line">      const undoOpts = &#123;&#125;;</span><br><span class="line">      const newState = undoable(reducer, undoOpts)(state, action);</span><br><span class="line">      // 由于 dva 同步了 routing 数据，所以需要把这部分还原</span><br><span class="line">      return &#123; ...newState, routing: newState.present.routing &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>5、 <code>onEffect(fn)</code></p>
<blockquote>
<p>封装 <code>effect</code> 执行。比如 <code>dva-loading</code> 基于此实现了自动处理 <code>loading</code> 状态</p>
</blockquote>
<p>6、 <code>onHmr(fn)</code></p>
<blockquote>
<p>热替换相关，目前用于 <code>babel-plugin-dva-hmr</code></p>
</blockquote>
<p>7、 <code>extraReducers</code></p>
<blockquote>
<p>指定额外的 <code>reducer</code>，比如 <code>redux-form</code> 需要指定额外的 <code>form reducer</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reducer as formReducer &#125; from &#x27;redux-form&#x27;</span><br><span class="line">const app = dva(&#123;</span><br><span class="line">  extraReducers: &#123;</span><br><span class="line">    form: formReducer,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里比较常用的是，<code>history</code>的配置，一般默认的是<code>hashHistory</code>，如果要配置 <code>history</code>为 <code>browserHistory</code>，可以这样</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import createHistory from &#x27;history/createBrowserHistory&#x27;;</span><br><span class="line">const app = dva(&#123;</span><br><span class="line">  history: createHistory(),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initialState`：指定初始数据，优先级高于 `model` 中的 `state`，默认是 `&#123;&#125;`，但是基本上都在`modal`里面设置相应的`state</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="2-2-2-app-use-Hooks"><a href="#2-2-2-app-use-Hooks" class="headerlink" title="2.2.2 app.use(Hooks)"></a>2.2.2 app.use(Hooks)</h3><blockquote>
<p>app.use(Hooks)：配置 hooks 或者注册插件</p>
</blockquote>
<p>这里最常见的就是<code>dva-loading</code>插件的配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import createLoading from &#x27;dva-loading&#x27;;</span><br><span class="line">...</span><br><span class="line">app.use(createLoading(opts));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>但是一般对于全局的<code>loading</code>我们会根据业务的不同来显示相应不同的<code>loading</code>图标，我们可以根据自己的需要来选择注册相应的插件</p>
</blockquote>
<h3 id="2-2-3-app-model-ModelObject"><a href="#2-2-3-app-model-ModelObject" class="headerlink" title="2.2.3 app.model(ModelObject)"></a>2.2.3 app.model(ModelObject)</h3><blockquote>
<p><code>app.model(ModelObject)</code>：这个是你数据逻辑处理，数据流动的地方</p>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/20191001/44.png" alt="img"></p>
<h3 id="2-2-4-app-unmodel-namespace"><a href="#2-2-4-app-unmodel-namespace" class="headerlink" title="2.2.4 app.unmodel(namespace)"></a>2.2.4 app.unmodel(namespace)</h3><blockquote>
<p>取消 <code>model</code> 注册，清理 <code>reducers</code>,<code>effects</code> 和 <code>subscriptions</code>。<code>subscription</code> 如果没有返回 <code>unlisten</code> 函数，使用 <code>app.unmodel</code> 会给予警告</p>
</blockquote>
<h3 id="2-2-5-app-router-Function"><a href="#2-2-5-app-router-Function" class="headerlink" title="2.2.5 app.router(Function)"></a>2.2.5 app.router(Function)</h3><blockquote>
<p>注册路由表，这一操作步骤在dva中也很重要</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 注册路由</span><br><span class="line">app.router(require(&#x27;./router&#x27;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 路由文件</span><br><span class="line">import &#123; Router, Route &#125; from &#x27;dva/router&#x27;;</span><br><span class="line">import IndexPage from &#x27;./routes/IndexPage&#x27;</span><br><span class="line">import TodoList from &#x27;./routes/TodoList&#x27;</span><br><span class="line"></span><br><span class="line">function RouterConfig(&#123; history &#125;) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Router history=&#123;history&#125;&gt;</span><br><span class="line">        &lt;Route path=&quot;/&quot; component=&#123;IndexPage&#125; /&gt;</span><br><span class="line">        &lt;Route path=&#x27;/todoList&#x27; components=&#123;TodoList&#125;/&gt;</span><br><span class="line">    &lt;/Router&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">export default RouterConfig</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果我们想解决组件动态加载问题，我们的路由文件也可以按照下面的写法来写</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Router, Switch, Route &#125; from &#x27;dva/router&#x27;</span><br><span class="line">import dynamic from &#x27;dva/dynamic&#x27;</span><br><span class="line"></span><br><span class="line">function RouterConfig(&#123; history, app &#125;) &#123;</span><br><span class="line">  const IndexPage = dynamic(&#123;</span><br><span class="line">    app,</span><br><span class="line">    component: () =&gt; import(&#x27;./routes/IndexPage&#x27;),</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  const Users = dynamic(&#123;</span><br><span class="line">    app,</span><br><span class="line">    models: () =&gt; [import(&#x27;./models/users&#x27;)],</span><br><span class="line">    component: () =&gt; import(&#x27;./routes/Users&#x27;),</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;Router history=&#123;history&#125;&gt;</span><br><span class="line">      &lt;Switch&gt;</span><br><span class="line">        &lt;Route exact path=&quot;/&quot; component=&#123;IndexPage&#125; /&gt;</span><br><span class="line">        &lt;Route exact path=&quot;/users&quot; component=&#123;Users&#125; /&gt;</span><br><span class="line">      &lt;/Switch&gt;</span><br><span class="line">    &lt;/Router&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default RouterConfig</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其中<code>dynamic(opts)</code> 中<code>opt</code>包含三个配置项：</p>
</blockquote>
<ul>
<li><code>app</code>: <code>dva</code> 实例，加载 <code>models</code> 时需要</li>
<li><code>models</code>: 返回 <code>Promise</code> 数组的函数，<code>Promise</code>返回 dva model&#96;</li>
<li><code>component</code>：返回 <code>Promise</code>的函数，<code>Promise</code>返回 <code>React Component</code></li>
</ul>
<h3 id="2-2-6-app-start"><a href="#2-2-6-app-start" class="headerlink" title="2.2.6 app.start"></a>2.2.6 app.start</h3><blockquote>
<p>启动应用，即将我们的应用跑起来</p>
</blockquote>
<h2 id="2-3-Dva九个概念"><a href="#2-3-Dva九个概念" class="headerlink" title="2.3 Dva九个概念"></a>2.3 Dva九个概念</h2><h3 id="2-3-1-State"><a href="#2-3-1-State" class="headerlink" title="2.3.1 State"></a>2.3.1 State</h3><blockquote>
<p>初始值，我们在 <code>dva()</code> 初始化的时候和在 modal 里面的 <code>state</code> 对其两处进行定义，其中 modal 中的优先级低于传给 <code>dva()</code> 的 <code>opts.initialState</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// dva()初始化</span><br><span class="line">const app = dva(&#123;</span><br><span class="line">  initialState: &#123; count: 1 &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// modal()定义事件</span><br><span class="line">app.model(&#123;</span><br><span class="line">  namespace: &#x27;count&#x27;,</span><br><span class="line">  state: 0,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-Action"><a href="#2-3-2-Action" class="headerlink" title="2.3.2 Action"></a>2.3.2 Action</h3><blockquote>
<p>表示操作事件，可以是同步，也可以是异步</p>
</blockquote>
<ul>
<li><code>action</code> 的格式如下，它需要有一个 <code>type</code>，表示这个 <code>action</code> 要触发什么操作；<code>payload</code> 则表示这个 <code>action</code> 将要传递的数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  type: String,</span><br><span class="line">  payload: data,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们通过 dispatch 方法来发送一个 action</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch(&#123; type: &#x27;todos/add&#x27;, payload: &#x27;Learn Dva&#x27; &#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其实我们可以构建一个Action 创建函数，如下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function addTodo(text) &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    type: ADD_TODO,</span><br><span class="line">    text</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//我们直接dispatch(addTodo()),就发送了一个action。</span><br><span class="line">dispatch(addTodo())</span><br></pre></td></tr></table></figure>

<h3 id="2-3-3-Model"><a href="#2-3-3-Model" class="headerlink" title="2.3.3 Model"></a>2.3.3 Model</h3><blockquote>
<p><code>model</code> 是 <code>dva</code> 中最重要的概念，<code>Model</code> 非 <code>MVC</code> 中的 <code>M</code>，而是领域模型，用于把数据相关的逻辑聚合到一起，几乎所有的数据，逻辑都在这边进行处理分发</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">import queryString from &#x27;query-string&#x27;</span><br><span class="line">import * as todoService from &#x27;../services/todo&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  namespace: &#x27;todo&#x27;,</span><br><span class="line">  state: &#123;</span><br><span class="line">    list: []</span><br><span class="line">  &#125;,</span><br><span class="line">  reducers: &#123;</span><br><span class="line">    save(state, &#123; payload: &#123; list &#125; &#125;) &#123;</span><br><span class="line">      return &#123; ...state, list &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  effects: &#123;</span><br><span class="line">    *addTodo(&#123; payload: value &#125;, &#123; call, put, select &#125;) &#123;</span><br><span class="line">      // 模拟网络请求</span><br><span class="line">      const data = yield call(todoService.query, value)</span><br><span class="line">      console.log(data)</span><br><span class="line">      let tempList = yield select(state =&gt; state.todo.list)</span><br><span class="line">      let list = []</span><br><span class="line">      list = list.concat(tempList)</span><br><span class="line">      const tempObj = &#123;&#125;</span><br><span class="line">      tempObj.title = value</span><br><span class="line">      tempObj.id = list.length</span><br><span class="line">      tempObj.finished = false</span><br><span class="line">      list.push(tempObj)</span><br><span class="line">      yield put(&#123; type: &#x27;save&#x27;, payload: &#123; list &#125;&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    *toggle(&#123; payload: index &#125;, &#123; call, put, select &#125;) &#123;</span><br><span class="line">      // 模拟网络请求</span><br><span class="line">      const data = yield call(todoService.query, index)</span><br><span class="line">      let tempList = yield select(state =&gt; state.todo.list)</span><br><span class="line">      let list = []</span><br><span class="line">      list = list.concat(tempList)</span><br><span class="line">      let obj = list[index]</span><br><span class="line">      obj.finished = !obj.finished</span><br><span class="line">      yield put(&#123; type: &#x27;save&#x27;, payload: &#123; list &#125; &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    *delete(&#123; payload: index &#125;, &#123; call, put, select &#125;) &#123;</span><br><span class="line">      const data = yield call(todoService.query, index)</span><br><span class="line">      let tempList = yield select(state =&gt; state.todo.list)</span><br><span class="line">      let list = []</span><br><span class="line">      list = list.concat(tempList)</span><br><span class="line">      list.splice(index, 1)</span><br><span class="line">      yield put(&#123; type: &#x27;save&#x27;, payload: &#123; list &#125; &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    *modify(&#123; payload: &#123; value, index &#125; &#125;, &#123; call, put, select &#125;) &#123;</span><br><span class="line">      const data = yield call(todoService.query, value)</span><br><span class="line">      let tempList = yield select(state =&gt; state.todo.list)</span><br><span class="line">      let list = []</span><br><span class="line">      list = list.concat(tempList)</span><br><span class="line">      let obj = list[index]</span><br><span class="line">      obj.title = value</span><br><span class="line">      yield put(&#123; type: &#x27;save&#x27;, payload: &#123; list &#125; &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  subscriptions: &#123;</span><br><span class="line">    setup(&#123; dispatch, history &#125;) &#123;</span><br><span class="line">      // 监听路由的变化，请求页面数据</span><br><span class="line">      return history.listen((&#123; pathname, search &#125;) =&gt; &#123;</span><br><span class="line">        const query = queryString.parse(search)</span><br><span class="line">        let list = []</span><br><span class="line">        if (pathname === &#x27;todoList&#x27;) &#123;</span><br><span class="line">          dispatch(&#123; type: &#x27;save&#x27;, payload: &#123;list&#125; &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>model</code>对象中包含5个重要的属性</p>
</blockquote>
<p><strong>state</strong></p>
<blockquote>
<p>这里的 state 跟我们刚刚讲的 state 的概念是一样的，只不过她的优先级比初始化的低，但是基本上项目中的 state 都是在这里定义的</p>
</blockquote>
<p><strong>namespace</strong></p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model` 的命名空间，同时也是他在全局 `state` 上的属性，只能用字符串，我们发送在发送 `action` 到相应的 `reducer` 时，就会需要用到 `namespace</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>Reducer</strong></p>
<blockquote>
<p>以<code>key/value</code> 格式定义 <code>reducer</code>，用于处理同步操作，唯一可以修改 <code>state</code> 的地方。由 <code>action</code> 触发。其实一个纯函数</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">namespace: &#x27;todo&#x27;,</span><br><span class="line">  state: &#123;</span><br><span class="line">    list: []</span><br><span class="line">  &#125;,</span><br><span class="line">  // reducers 写法</span><br><span class="line">  reducers: &#123;</span><br><span class="line">    save(state, &#123; payload: &#123; list &#125; &#125;) &#123;</span><br><span class="line">      return &#123; ...state, list &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>Effect</strong></p>
<blockquote>
<p>用于处理异步操作和业务逻辑，不直接修改 <code>state</code>，简单的来说，就是获取从服务端获取数据，并且发起一个 <code>action</code>交给<code>reducer</code> 的地方</p>
</blockquote>
<p>其中它用到了<code>redux-saga</code>，里面有几个常用的函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// effects 写法</span><br><span class="line">effects: &#123;</span><br><span class="line">    *addTodo(&#123; payload: value &#125;, &#123; call, put, select &#125;) &#123;</span><br><span class="line">      // 模拟网络请求</span><br><span class="line">      const data = yield call(todoService.query, value)</span><br><span class="line">      console.log(data)</span><br><span class="line">      let tempList = yield select(state =&gt; state.todo.list)</span><br><span class="line">      let list = []</span><br><span class="line">      list = list.concat(tempList)</span><br><span class="line">      const tempObj = &#123;&#125;</span><br><span class="line">      tempObj.title = value</span><br><span class="line">      tempObj.id = list.length</span><br><span class="line">      tempObj.finished = false</span><br><span class="line">      list.push(tempObj)</span><br><span class="line">      yield put(&#123; type: &#x27;save&#x27;, payload: &#123; list &#125;&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    *toggle(&#123; payload: index &#125;, &#123; call, put, select &#125;) &#123;</span><br><span class="line">      // 模拟网络请求</span><br><span class="line">      const data = yield call(todoService.query, index)</span><br><span class="line">      let tempList = yield select(state =&gt; state.todo.list)</span><br><span class="line">      let list = []</span><br><span class="line">      list = list.concat(tempList)</span><br><span class="line">      let obj = list[index]</span><br><span class="line">      obj.finished = !obj.finished</span><br><span class="line">      yield put(&#123; type: &#x27;save&#x27;, payload: &#123; list &#125; &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    *delete(&#123; payload: index &#125;, &#123; call, put, select &#125;) &#123;</span><br><span class="line">      const data = yield call(todoService.query, index)</span><br><span class="line">      let tempList = yield select(state =&gt; state.todo.list)</span><br><span class="line">      let list = []</span><br><span class="line">      list = list.concat(tempList)</span><br><span class="line">      list.splice(index, 1)</span><br><span class="line">      yield put(&#123; type: &#x27;save&#x27;, payload: &#123; list &#125; &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    *modify(&#123; payload: &#123; value, index &#125; &#125;, &#123; call, put, select &#125;) &#123;</span><br><span class="line">      const data = yield call(todoService.query, value)</span><br><span class="line">      let tempList = yield select(state =&gt; state.todo.list)</span><br><span class="line">      let list = []</span><br><span class="line">      list = list.concat(tempList)</span><br><span class="line">      let obj = list[index]</span><br><span class="line">      obj.title = value</span><br><span class="line">      yield put(&#123; type: &#x27;save&#x27;, payload: &#123; list &#125; &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/1505342-9ecb8ba2d8fd3ec2.png" alt="img"></p>
<blockquote>
<p>在项目中最主要的会用到的是 <code>put</code> 与 <code>call</code></p>
</blockquote>
<p><strong>Subscription</strong></p>
<blockquote>
<ul>
<li>以 <code>key/value</code> 格式定义 <code>subscription</code>，<code>subscription</code> 是订阅，用于订阅一个数据源，然后根据需要 dispatch 相应的 action</li>
<li><code>subscription</code> 是订阅，用于订阅一个数据源，然后根据需要 <code>dispatch</code> 相应的<code>action</code>。在 <code>app.start()</code> 时被执行，数据源可以是当前的时间、当前页面的<code>url</code>、服务器的 <code>websocket</code> 连接、<code>history</code>路由变化等等。</li>
</ul>
</blockquote>
<ul>
<li><strong>注意</strong>：如果要使用 <code>app.unmodel()</code>，<code>subscription</code> 必须返回 <code>unlisten</code> 方法，用于取消数据订阅</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// subscriptions 写法</span><br><span class="line">subscriptions: &#123;</span><br><span class="line">    setup(&#123; dispatch, history &#125;) &#123;</span><br><span class="line">      // 监听路由的变化，请求页面数据</span><br><span class="line">      return history.listen((&#123; pathname, search &#125;) =&gt; &#123;</span><br><span class="line">        const query = queryString.parse(search)</span><br><span class="line">        let list = []</span><br><span class="line">        if (pathname === &#x27;todoList&#x27;) &#123;</span><br><span class="line">          dispatch(&#123; type: &#x27;save&#x27;, payload: &#123;list&#125; &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-4-Router"><a href="#2-3-4-Router" class="headerlink" title="2.3.4 Router"></a>2.3.4 Router</h3><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Router` 表示路由配置信息，项目中的 `router.js</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export default function(&#123; history &#125;)&#123;</span><br><span class="line">  return(</span><br><span class="line">    &lt;Router history=&#123;history&#125;&gt;</span><br><span class="line">      &lt;Route path=&quot;/&quot; component=&#123;App&#125; /&gt;</span><br><span class="line">    &lt;/Router&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>RouteComponent</strong></p>
<blockquote>
<p><code>RouteComponent</code> 表示<code>Router</code> 里匹配路径的 <code>Component</code>，通常会绑定<code>model</code>的数据。如下:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import &#123; connect &#125; from &#x27;dva&#x27;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  return &lt;div&gt;App&lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mapStateToProps(state) &#123;</span><br><span class="line">  return &#123; todos: state.todos &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default connect(mapStateToProps)(App);</span><br></pre></td></tr></table></figure>

<h2 id="2-4-整体架构"><a href="#2-4-整体架构" class="headerlink" title="2.4 整体架构"></a>2.4 整体架构</h2><p><img src="https://poetries1.gitee.io/img-repo/20191001/45.png" alt="img"></p>
<ul>
<li>首先我们根据 <code>url</code> 访问相关的 <code>Route-Component</code>，在组件中我们通过 <code>dispatch</code>发送 <code>action</code> 到 <code>model</code>里面的 <code>effect</code> 或者直接 <code>Reducer</code></li>
<li>当我们将<code>action</code>发送给<code>Effect</code>，基本上是取服务器上面请求数据的，服务器返回数据之后，<code>effect</code> 会发送相应的 <code>action</code>给 <code>reducer</code>，由唯一能改变 <code>state</code>的 <code>reducer</code> 改变 <code>state</code> ，然后通过<code>connect</code>重新渲染组件。</li>
<li>当我们将<code>action</code>发送给<code>reducer</code>，那直接由 <code>reducer</code> 改变 <code>state</code>，然后通过<code>connect</code>重新渲染组件</li>
</ul>
<h2 id="2-5-Dva图解"><a href="#2-5-Dva图解" class="headerlink" title="2.5 Dva图解"></a>2.5 Dva图解</h2><p><strong>图解一：加入Saga</strong></p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">React` 只负责页面渲染, 而不负责页面逻辑, 页面逻辑可以从中单独抽取出来, 变成 `store</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://poetries1.gitee.io/img-repo/20191001/46.png" alt="img"></p>
<blockquote>
<p>使用 <code>Middleware</code> 拦截 <code>action</code>, 这样一来异步的网络操作也就很方便了, 做成一个 <code>Middleware</code>就行了, 这里使用<code>redux-saga</code> 这个类库</p>
</blockquote>
<ul>
<li>点击创建 <code>Todo</code>的按钮, 发起一个 <code>type == addTodo</code> 的 <code>action</code></li>
<li><code>saga</code> 拦截这个 <code>action</code>, 发起 <code>http</code> 请求, 如果请求成功, 则继续向 <code>reducer</code> 发一个 <code>type == addTodoSucc</code> 的 <code>action</code>, 提示创建成功, 反之则发送 <code>type == addTodoFail</code> 的<code>action</code> 即可</li>
</ul>
<p><strong>图解二：Dva表示法</strong></p>
<p><img src="https://poetries1.gitee.io/img-repo/20191001/47.png" alt="img"></p>
<blockquote>
<p>dva做了 3 件很重要的事情</p>
</blockquote>
<ul>
<li>把 <code>store</code>及 <code>saga</code> 统一为一个 <code>model</code> 的概念, 写在一个 js 文件里面</li>
<li>增加了一个 <code>Subscriptions</code>, 用于收集其他来源的 <code>action</code>, eg: 键盘操作</li>
<li><code>model</code> 写法很简约, 类似于 <code>DSL</code> 或者 <code>RoR</code></li>
</ul>
<h1 id="三、计数器例子"><a href="#三、计数器例子" class="headerlink" title="三、计数器例子"></a>三、计数器例子</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dva new myapp</span><br></pre></td></tr></table></figure>

<p><strong>目录结构介绍</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── mock    // mock数据文件夹</span><br><span class="line">├── node_modules // 第三方的依赖</span><br><span class="line">├── public  // 存放公共public文件的文件夹</span><br><span class="line">├── src  // 最重要的文件夹，编写代码都在这个文件夹下</span><br><span class="line">│   ├── assets // 可以放图片等公共资源</span><br><span class="line">│   ├── components // 就是react中的木偶组件</span><br><span class="line">│   ├── models // dva最重要的文件夹，所有的数据交互及逻辑都写在这里</span><br><span class="line">│   ├── routes // 就是react中的智能组件，不要被文件夹名字误导。</span><br><span class="line">│   ├── services // 放请求借口方法的文件夹</span><br><span class="line">│   ├── utils // 自己的工具方法可以放在这边</span><br><span class="line">│   ├── index.css // 入口文件样式</span><br><span class="line">│   ├── index.ejs // ejs模板引擎</span><br><span class="line">│   ├── index.js // 入口文件</span><br><span class="line">│   └── router.js // 项目的路由文件</span><br><span class="line">├── .eslintrc // bower安装目录的配置</span><br><span class="line">├── .editorconfig // 保证代码在不同编辑器可视化的工具</span><br><span class="line">├── .gitignore // git上传时忽略的文件</span><br><span class="line">├── .roadhogrc.js // 项目的配置文件，配置接口转发，css_module等都在这边。</span><br><span class="line">├── .roadhogrc.mock.js // 项目的配置文件</span><br><span class="line">└── package.json // 当前整一个项目的依赖</span><br></pre></td></tr></table></figure>

<p><strong>首先是前端的页面，我们使用 class 形式来创建组件，原例子中是使用无状态来创建的。react 创建组件的各种方式，大家可以看<a target="_blank" rel="noopener" href="http://www.cnblogs.com/wonyun/p/5930333.html">React创建组件的三种方式及其区别</a></strong></p>
<blockquote>
<p>我们先修改<code>route/IndexPage.js</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import &#123; connect &#125; from &#x27;dva&#x27;;</span><br><span class="line">import styles from &#x27;./IndexPage.css&#x27;;</span><br><span class="line"></span><br><span class="line">class IndexPage extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; dispatch &#125; = this.props;</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&#123;styles.normal&#125;&gt;</span><br><span class="line">        &lt;div className=&#123;styles.record&#125;&gt;Highest Record: 1&lt;/div&gt;</span><br><span class="line">        &lt;div className=&#123;styles.current&#125;&gt;2&lt;/div&gt;</span><br><span class="line">        &lt;div className=&#123;styles.button&#125;&gt;</span><br><span class="line">          &lt;button onClick=&#123;() =&gt; &#123;&#125;&#125;&gt;+&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default connect()(IndexPage);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>同时修改样式<code>routes/IndexPage.css</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">.normal &#123;</span><br><span class="line">  width: 200px;</span><br><span class="line">  margin: 100px auto;</span><br><span class="line">  padding: 20px;</span><br><span class="line">  border: 1px solid #ccc;</span><br><span class="line">  box-shadow: 0 0 20px #ccc;</span><br><span class="line">&#125;</span><br><span class="line">.record &#123;</span><br><span class="line">  border-bottom: 1px solid #ccc;</span><br><span class="line">  padding-bottom: 8px;</span><br><span class="line">  color: #ccc;</span><br><span class="line">&#125;</span><br><span class="line">.current &#123;</span><br><span class="line">  text-align: center;</span><br><span class="line">  font-size: 40px;</span><br><span class="line">  padding: 40px 0;</span><br><span class="line">&#125;</span><br><span class="line">.button &#123;</span><br><span class="line">  text-align: center;</span><br><span class="line">  button &#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 40px;</span><br><span class="line">    background: #aaa;</span><br><span class="line">    color: #fff;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在 <code>model</code> 处理<code>state</code>，在页面里面输出 <code>model</code> 中的 <code>state</code></p>
</blockquote>
<ul>
<li>首先我们在index.js中将<code>models/example.js</code>，即将model下一行的的注释打开</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import dva from &#x27;dva&#x27;;</span><br><span class="line">import &#x27;./index.css&#x27;;</span><br><span class="line"></span><br><span class="line">// 1. Initialize</span><br><span class="line">const app = dva();</span><br><span class="line"></span><br><span class="line">// 2. Plugins</span><br><span class="line">// app.use(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">// 3. Model</span><br><span class="line">app.model(require(&#x27;./models/example&#x27;)); // 打开注释</span><br><span class="line"></span><br><span class="line">// 4. Router</span><br><span class="line">app.router(require(&#x27;./router&#x27;));</span><br><span class="line"></span><br><span class="line">// 5. Start</span><br><span class="line">app.start(&#x27;#root&#x27;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>接下来我们进入 <code>models/example.js</code>，将<code>namespace</code> 名字改为 <code>count</code>，<code>state</code>对象加上 <code>record</code> 与 <code>current</code> 属性。如下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  namespace: &#x27;count&#x27;,</span><br><span class="line">  state: &#123;</span><br><span class="line">    record: 0,</span><br><span class="line">    current: 0,</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>接着我们来到 <code>routes/indexpage.js</code> 页面，通过的 <code>mapStateToProps</code>引入相关的 <code>state</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import &#123; connect &#125; from &#x27;dva&#x27;;</span><br><span class="line">import styles from &#x27;./IndexPage.css&#x27;;</span><br><span class="line"></span><br><span class="line">class IndexPage extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; dispatch, count &#125; = this.props;</span><br><span class="line">    </span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&#123;styles.normal&#125;&gt;</span><br><span class="line">        &lt;div className=&#123;styles.record&#125;&gt;</span><br><span class="line">         Highest Record: &#123;count.record&#125; // 将count的record输出</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=&#123;styles.current&#125;&gt;</span><br><span class="line">         &#123;count.current&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=&#123;styles.button&#125;&gt;</span><br><span class="line">          &lt;button onClick=&#123;() =&gt; &#123;&#125; &#125; &gt;</span><br><span class="line">                 +</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mapStateToProps(state) &#123;</span><br><span class="line">  return &#123; count: state.count &#125;;</span><br><span class="line">&#125; // 获取state</span><br><span class="line"></span><br><span class="line">export default connect(mapStateToProps)(IndexPage);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过 <code>+</code> 发送 <code>action</code>，通过 <code>reducer</code> 改变相应的 <code>state</code></p>
</blockquote>
<ul>
<li>首先我们在 <code>models/example.js</code>，写相应的 <code>reducer</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  ...</span><br><span class="line">  reducers: &#123;</span><br><span class="line">    add1(state) &#123;</span><br><span class="line">      const newCurrent = state.current + 1;</span><br><span class="line">      return &#123; ...state,</span><br><span class="line">        record: newCurrent &gt; state.record ? newCurrent : state.record,</span><br><span class="line">        current: newCurrent,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    minus(state) &#123;</span><br><span class="line">      return &#123; ...state, current: state.current - 1 &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在页面的模板 <code>routes/IndexPage.js</code> 中 <code>+</code> 号点击的时候，<code>dispatch</code>一个 <code>action</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import &#123; connect &#125; from &#x27;dva&#x27;;</span><br><span class="line">import styles from &#x27;./IndexPage.css&#x27;;</span><br><span class="line"></span><br><span class="line">class IndexPage extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; dispatch, count &#125; = this.props;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&#123;styles.normal&#125;&gt;</span><br><span class="line">        &lt;div className=&#123;styles.record&#125;&gt;Highest Record: &#123;count.record&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div className=&#123;styles.current&#125;&gt;&#123;count.current&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div className=&#123;styles.button&#125;&gt;</span><br><span class="line">          &lt;button </span><br><span class="line">+            onClick=&#123;() =&gt; &#123; dispatch(&#123; type: &#x27;count/add1&#x27; &#125;);&#125;</span><br><span class="line">          &#125;&gt;+&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">function mapStateToProps(state) &#123;</span><br><span class="line">  return &#123; count: state.count &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default connect(mapStateToProps)(IndexPage);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>接下来我们来使用 <code>effect</code> 模拟一个数据接口请求，返回之后，通过 <code>yield put()</code> 改变相应的 <code>state</code></p>
</blockquote>
<ul>
<li>首先我们替换相应的 <code>models/example.js</code> 的 <code>effect</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">effects: &#123;</span><br><span class="line">    *add(action, &#123; call, put &#125;) &#123;</span><br><span class="line">      yield call(delay, 1000);</span><br><span class="line">      yield put(&#123; type: &#x27;minus&#x27; &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里的 <code>delay</code>，是我这边写的一个延时的函数，我们在 <code>utils</code> 里面编写一个 <code>utils.js</code> ，一般请求接口的函数都会写在 <code>servers</code> 文件夹中</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export function delay(timeout) &#123;</span><br><span class="line">  return new Promise((resolve) =&gt; &#123;</span><br><span class="line">    setTimeout(resolve, timeout);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>订阅订阅键盘事件，使用 <code>subscriptions</code>，当用户按住 <code>command+up</code> 时候触发添加数字的 <code>action</code></p>
</blockquote>
<ul>
<li>在 <code>models/example.js</code> 中作如下修改</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+import key from &#x27;keymaster&#x27;;</span><br><span class="line">...</span><br><span class="line">app.model(&#123;</span><br><span class="line">  namespace: &#x27;count&#x27;,</span><br><span class="line">+ subscriptions: &#123;</span><br><span class="line">+   keyboardWatcher(&#123; dispatch &#125;) &#123;</span><br><span class="line">+     key(&#x27;⌘+up, ctrl+up&#x27;, () =&gt; &#123; dispatch(&#123;type:&#x27;add&#x27;&#125;) &#125;);</span><br><span class="line">+   &#125;,</span><br><span class="line">+ &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>在这里你需要安装 <code>keymaster</code> 这个依赖</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install keymaster --save</span><br></pre></td></tr></table></figure>

<ul>
<li>现在你可以按住 <code>command+up</code> 就可以使 <code>current</code> 加1</li>
</ul>
<h1 id="四、Dva实践"><a href="#四、Dva实践" class="headerlink" title="四、Dva实践"></a>四、Dva实践</h1><h2 id="4-1-抽离Model"><a href="#4-1-抽离Model" class="headerlink" title="4.1 抽离Model"></a>4.1 抽离Model</h2><blockquote>
<p>抽离<code>Model</code>，根据设计页面需求，设计相应的<code>Model</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// models/users.js</span><br><span class="line">// version1: 从数据维度抽取，更适用于无状态的数据</span><br><span class="line">// version2: 从业务状态抽取，将数据与组件的业务状态统一抽离成一个model</span><br><span class="line">// 新增部分为在数据维度基础上，改为从业务状态抽取而添加的代码</span><br><span class="line">export default &#123;</span><br><span class="line">  namespace: &#x27;users&#x27;,</span><br><span class="line">  state: &#123;</span><br><span class="line">    list: [],</span><br><span class="line">    total: null,</span><br><span class="line">+   loading: false, // 控制加载状态</span><br><span class="line">+   current: null, // 当前分页信息</span><br><span class="line">+   currentItem: &#123;&#125;, // 当前操作的用户对象</span><br><span class="line">+   modalVisible: false, // 弹出窗的显示状态</span><br><span class="line">+   modalType: &#x27;create&#x27;, // 弹出窗的类型（添加用户，编辑用户）</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">    // 异步操作</span><br><span class="line">    effects: &#123;</span><br><span class="line">        *query()&#123;&#125;,</span><br><span class="line">        *create()&#123;&#125;,</span><br><span class="line">        *&#x27;delete&#x27;()&#123;&#125;,   // 因为delete是关键字，特殊处理</span><br><span class="line">        *update()&#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 替换状态树</span><br><span class="line">    reducers: &#123;</span><br><span class="line">+       showLoading()&#123;&#125;, // 控制加载状态的 reducer</span><br><span class="line">+       showModel()&#123;&#125;, // 控制 Model 显示状态的 reducer</span><br><span class="line">+       hideModel()&#123;&#125;,</span><br><span class="line">        querySuccess()&#123;&#125;,</span><br><span class="line">        createSuccess()&#123;&#125;,</span><br><span class="line">        deleteSuccess()&#123;&#125;,</span><br><span class="line">        updateSuccess()&#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-2-设计组件"><a href="#4-2-设计组件" class="headerlink" title="4.2 设计组件"></a>4.2 设计组件</h2><blockquote>
<p>先设置容器组件的访问路径，再创建组件文件</p>
</blockquote>
<h3 id="4-2-1-容器组件"><a href="#4-2-1-容器组件" class="headerlink" title="4.2.1 容器组件"></a>4.2.1 容器组件</h3><blockquote>
<p>具有监听数据行为的组件，职责是绑定相关联的 model 数据，包含子组件；传入的数据来源于model</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component, PropTypes &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">// dva 的 connect 方法可以将组件和数据关联在一起</span><br><span class="line">import &#123; connect &#125; from &#x27;dva&#x27;;</span><br><span class="line"></span><br><span class="line">// 组件本身</span><br><span class="line">const MyComponent = (props)=&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">// propTypes属性，用于限制props的传入数据类型</span><br><span class="line">MyComponent.propTypes = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">// 声明模型传递函数，用于建立组件和数据的映射关系</span><br><span class="line">// 实际表示 将ModelA这一个数据模型，绑定到当前的组件中，则在当前组件中，随时可以取到ModelA的最新值</span><br><span class="line">// 可以绑定多个Model</span><br><span class="line">function mapStateToProps(&#123;ModelA&#125;) &#123;</span><br><span class="line">  return &#123;ModelA&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 关联 model</span><br><span class="line">// 正式调用模型传递函数，完成模型绑定</span><br><span class="line">export default connect(mapStateToProps)(MyComponent);</span><br></pre></td></tr></table></figure>

<h3 id="4-2-2-展示组件"><a href="#4-2-2-展示组件" class="headerlink" title="4.2.2 展示组件"></a>4.2.2 展示组件</h3><blockquote>
<p>展示通过 <code>props</code> 传递到组件内部数据；传入的数据来源于容器组件向展示组件的<code>props</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component, PropTypes &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">// 组件本身</span><br><span class="line">// 所需要的数据通过 Container Component 通过 props 传递下来</span><br><span class="line">const MyComponent = (props)=&gt;&#123;&#125;</span><br><span class="line">MyComponent.propTypes = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">// 并不会监听数据</span><br><span class="line">export default MyComponent;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-3-设置路由"><a href="#4-2-3-设置路由" class="headerlink" title="4.2.3 设置路由"></a>4.2.3 设置路由</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// .src/router.js</span><br><span class="line">import React, &#123; PropTypes &#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123; Router, Route &#125; from &#x27;dva/router&#x27;;</span><br><span class="line">import Users from &#x27;./routes/Users&#x27;;</span><br><span class="line"></span><br><span class="line">export default function(&#123; history &#125;) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Router history=&#123;history&#125;&gt;</span><br><span class="line">      &lt;Route path=&quot;/users&quot; component=&#123;Users&#125; /&gt;</span><br><span class="line">    &lt;/Router&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>容器组件雏形</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// .src/routes/Users.jsx</span><br><span class="line">import React, &#123; PropTypes &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">function Users() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;User Router Component&lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Users;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-4-设计容器组件"><a href="#4-2-4-设计容器组件" class="headerlink" title="4.2.4 设计容器组件"></a>4.2.4 设计容器组件</h3><blockquote>
<p>自顶向下的设计方法：先设计容器组件，再逐步细化内部的展示容器</p>
</blockquote>
<p>组件的定义方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 方法一： es6 的写法，当组件设计react生命周期时，可采用这种写法</span><br><span class="line">// 具有生命周期的组件，可以在接收到传入数据变化时，自定义执行方法，有自己的行为模式</span><br><span class="line">// 比如在组件生成后调用xx请求(componentDidMount)、可以自己决定要不要更新渲染(shouldComponentUpdate)等</span><br><span class="line">class App extends React.Component(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">// 方法二： stateless 的写法，定义无状态组件</span><br><span class="line">// 无状态组件，仅仅根据传入的数据更新，修改自己的渲染内容</span><br><span class="line">const App = (props) =&gt; (&#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>容器组件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">// ./src/routes/Users.jsx</span><br><span class="line">import React, &#123; Component, PropTypes &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">// 引入展示组件 （暂时都没实现）</span><br><span class="line">import UserList from &#x27;../components/Users/UserList&#x27;;</span><br><span class="line">import UserSearch from &#x27;../components/Users/UserSearch&#x27;;</span><br><span class="line">import UserModal from &#x27;../components/Users/UserModal&#x27;;</span><br><span class="line"></span><br><span class="line">// 引入css样式表</span><br><span class="line">import styles from &#x27;./style.less&#x27;</span><br><span class="line"></span><br><span class="line">function Users() &#123;</span><br><span class="line"></span><br><span class="line">  // 向userListProps中传入静态数据</span><br><span class="line">  const userSearchProps = &#123;&#125;;</span><br><span class="line">  const userListProps = &#123;</span><br><span class="line">    total: 3,</span><br><span class="line">    current: 1,</span><br><span class="line">    loading: false,</span><br><span class="line">    dataSource: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: &#x27;张三&#x27;,</span><br><span class="line">        age: 23,</span><br><span class="line">        address: &#x27;成都&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: &#x27;李四&#x27;,</span><br><span class="line">        age: 24,</span><br><span class="line">        address: &#x27;杭州&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: &#x27;王五&#x27;,</span><br><span class="line">        age: 25,</span><br><span class="line">        address: &#x27;上海&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;;</span><br><span class="line">  const userModalProps = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&#123;styles.normal&#125;&gt;</span><br><span class="line">      &#123;/* 用户筛选搜索框 */&#125;</span><br><span class="line">      &lt;UserSearch &#123;...userSearchProps&#125; /&gt;</span><br><span class="line">      &#123;/* 用户信息展示列表 */&#125;</span><br><span class="line">      &lt;UserList &#123;...userListProps&#125; /&gt;</span><br><span class="line">      &#123;/* 添加用户 &amp; 修改用户弹出的浮层 */&#125;</span><br><span class="line">      &lt;UserModal &#123;...userModalProps&#125; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 很关键的对外输出export；使外部可通过import引用使用此组件</span><br><span class="line">export default Users;</span><br></pre></td></tr></table></figure>

<p>展示组件UserList</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">// ./src/components/Users/UserList.jsx</span><br><span class="line">import React, &#123; Component, PropTypes &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">// 采用antd的UI组件</span><br><span class="line">import &#123; Table, message, Popconfirm &#125; from &#x27;antd&#x27;;</span><br><span class="line"></span><br><span class="line">// 采用 stateless 的写法</span><br><span class="line">const UserList = (&#123;</span><br><span class="line">    total,</span><br><span class="line">    current,</span><br><span class="line">    loading,</span><br><span class="line">    dataSource,</span><br><span class="line">&#125;) =&gt; &#123;</span><br><span class="line">  const columns = [&#123;</span><br><span class="line">    title: &#x27;姓名&#x27;,</span><br><span class="line">    dataIndex: &#x27;name&#x27;,</span><br><span class="line">    key: &#x27;name&#x27;,</span><br><span class="line">    render: (text) =&gt; &lt;a href=&quot;#&quot;&gt;&#123;text&#125;&lt;/a&gt;,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    title: &#x27;年龄&#x27;,</span><br><span class="line">    dataIndex: &#x27;age&#x27;,</span><br><span class="line">    key: &#x27;age&#x27;,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    title: &#x27;住址&#x27;,</span><br><span class="line">    dataIndex: &#x27;address&#x27;,</span><br><span class="line">    key: &#x27;address&#x27;,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    title: &#x27;操作&#x27;,</span><br><span class="line">    key: &#x27;operation&#x27;,</span><br><span class="line">    render: (text, record) =&gt; (</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        &lt;a onClick=&#123;()=&gt;&#123;&#125;&#125;&gt;编辑&lt;/a&gt;</span><br><span class="line">         </span><br><span class="line">        &lt;Popconfirm title=&quot;确定要删除吗？&quot; onConfirm=&#123;()=&gt;&#123;&#125;&#125;&gt;</span><br><span class="line">          &lt;a&gt;删除&lt;/a&gt;</span><br><span class="line">        &lt;/Popconfirm&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    ),</span><br><span class="line">  &#125;];</span><br><span class="line"></span><br><span class="line">  // 定义分页对象</span><br><span class="line">  const pagination = &#123;</span><br><span class="line">    total,</span><br><span class="line">    current,</span><br><span class="line">    pageSize: 10,</span><br><span class="line">    onChange: ()=&gt;&#123;&#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // 此处的Table标签使用了antd组件，传入的参数格式是由antd组件库本身决定的</span><br><span class="line">  // 此外还需要在index.js中引入antd  import &#x27;antd/dist/antd.css&#x27;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Table</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">        dataSource=&#123;dataSource&#125;</span><br><span class="line">        loading=&#123;loading&#125;</span><br><span class="line">        rowKey=&#123;record =&gt; record.id&#125;</span><br><span class="line">        pagination=&#123;pagination&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default UserList;</span><br></pre></td></tr></table></figure>

<h2 id="4-3-添加Reducer"><a href="#4-3-添加Reducer" class="headerlink" title="4.3 添加Reducer"></a>4.3 添加Reducer</h2><blockquote>
<p>在整个应用中，只有<code>model</code>中的<code>reducer</code>函数可以直接修改自己所在<code>model</code>的<code>state</code>参数，其余都是非法操作；<br>并且必须使用<code>return &#123;...state&#125;</code>的形式进行修改</p>
</blockquote>
<h3 id="4-3-1-第一步：实现reducer函数"><a href="#4-3-1-第一步：实现reducer函数" class="headerlink" title="4.3.1 第一步：实现reducer函数"></a>4.3.1 第一步：实现reducer函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">// models/users.js</span><br><span class="line">// 使用静态数据返回，把userList中的静态数据移到此处</span><br><span class="line">// querySuccess这个action的作用在于，修改了model的数据</span><br><span class="line">export default &#123;</span><br><span class="line">  namespace: &#x27;users&#x27;,</span><br><span class="line">  state： &#123;&#125;，</span><br><span class="line">  subscriptions: &#123;&#125;,</span><br><span class="line">  effects: &#123;&#125;,</span><br><span class="line">  reducers: &#123;</span><br><span class="line">    querySuccess(state)&#123;</span><br><span class="line">        const mock = &#123;</span><br><span class="line">          total: 3,</span><br><span class="line">          current: 1,</span><br><span class="line">          loading: false,</span><br><span class="line">          list: [</span><br><span class="line">            &#123;</span><br><span class="line">              id: 1,</span><br><span class="line">              name: &#x27;张三&#x27;,</span><br><span class="line">              age: 23,</span><br><span class="line">              address: &#x27;成都&#x27;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              id: 2,</span><br><span class="line">              name: &#x27;李四&#x27;,</span><br><span class="line">              age: 24,</span><br><span class="line">              address: &#x27;杭州&#x27;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              id: 3,</span><br><span class="line">              name: &#x27;王五&#x27;,</span><br><span class="line">              age: 25,</span><br><span class="line">              address: &#x27;上海&#x27;,</span><br><span class="line">            &#125;,</span><br><span class="line">          ]</span><br><span class="line">        &#125;;</span><br><span class="line">        // return 的内容是一个对象，涵盖原state中的所有属性，以实现“更新替换”的效果</span><br><span class="line">        return &#123;...state, ...mock, loading: false&#125;;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-2-第二步：关联Model中的数据源"><a href="#4-3-2-第二步：关联Model中的数据源" class="headerlink" title="4.3.2 第二步：关联Model中的数据源"></a>4.3.2 第二步：关联Model中的数据源</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">// routes/Users.jsx</span><br><span class="line"></span><br><span class="line">import React, &#123; PropTypes &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">// 最后用到了connect函数，需要在头部预先引入connect</span><br><span class="line">import &#123; connect &#125; from &#x27;dva&#x27;;</span><br><span class="line"></span><br><span class="line">function Users(&#123; location, dispatch, users &#125;) &#123;</span><br><span class="line"></span><br><span class="line">  const &#123;</span><br><span class="line">    loading, list, total, current,</span><br><span class="line">    currentItem, modalVisible, modalType</span><br><span class="line">    &#125; = users;</span><br><span class="line"></span><br><span class="line">  const userSearchProps=&#123;&#125;;</span><br><span class="line"></span><br><span class="line">  // 使用传入的数据源，进行数据渲染</span><br><span class="line">  const userListProps=&#123;</span><br><span class="line">    dataSource: list,</span><br><span class="line">    total,</span><br><span class="line">    loading,</span><br><span class="line">    current,</span><br><span class="line">  &#125;;</span><br><span class="line">  const userModalProps=&#123;&#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&#123;styles.normal&#125;&gt;</span><br><span class="line">      &#123;/* 用户筛选搜索框 */&#125;</span><br><span class="line">      &lt;UserSearch &#123;...userSearchProps&#125; /&gt;</span><br><span class="line">      &#123;/* 用户信息展示列表 */&#125;</span><br><span class="line">      &lt;UserList &#123;...userListProps&#125; /&gt;</span><br><span class="line">      &#123;/* 添加用户 &amp; 修改用户弹出的浮层 */&#125;</span><br><span class="line">      &lt;UserModal &#123;...userModalProps&#125; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 声明组件的props类型</span><br><span class="line">Users.propTypes = &#123;</span><br><span class="line">  users: PropTypes.object,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 指定订阅数据，并且关联到users中</span><br><span class="line">function mapStateToProps(&#123; users &#125;) &#123;</span><br><span class="line">  return &#123;users&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 建立数据关联关系</span><br><span class="line">export default connect(mapStateToProps)(Users);</span><br></pre></td></tr></table></figure>

<h3 id="4-3-3-第三步：通过发起Action，在组件中获取Model中的数据"><a href="#4-3-3-第三步：通过发起Action，在组件中获取Model中的数据" class="headerlink" title="4.3.3 第三步：通过发起Action，在组件中获取Model中的数据"></a>4.3.3 第三步：通过发起Action，在组件中获取Model中的数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// models/users.js</span><br><span class="line">// 在组件生成后发出action，示例：</span><br><span class="line">componentDidMount() &#123;</span><br><span class="line">  this.props.dispatch(&#123;</span><br><span class="line">    type: &#x27;model/action&#x27;,     // type对应action的名字</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 在本次实践中，在访问/users/路由时，就是我们获取用户数据的时机</span><br><span class="line">// 因此把dispatch移至subscription中</span><br><span class="line">// subcription，订阅(或是监听)一个数据源，然后根据条件dispatch对应的action</span><br><span class="line">// 数据源可以是当前的时间、服务器的 websocket 连接、keyboard 输入、geolocation 变化、history 路由变化等等  </span><br><span class="line">// 此处订阅的数据源就是路由信息，当路由为/users，则派发&#x27;querySuccess&#x27;这个effects方法</span><br><span class="line">subscriptions: &#123;</span><br><span class="line">    setup(&#123; dispatch, history &#125;) &#123;</span><br><span class="line">      history.listen(location =&gt; &#123;</span><br><span class="line">        if (location.pathname === &#x27;/users&#x27;) &#123;</span><br><span class="line">          dispatch(&#123;</span><br><span class="line">            type: &#x27;querySuccess&#x27;,</span><br><span class="line">            payload: &#123;&#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="4-3-4-第四步：-在index-js中添加models"><a href="#4-3-4-第四步：-在index-js中添加models" class="headerlink" title="4.3.4 第四步： 在index.js中添加models"></a>4.3.4 第四步： 在index.js中添加models</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// model必须在此完成注册，才能全局有效</span><br><span class="line">// index.js</span><br><span class="line">app.model(require(&#x27;./models/users.js&#x27;));</span><br></pre></td></tr></table></figure>

<h3 id="4-4-添加Effects"><a href="#4-4-添加Effects" class="headerlink" title="4.4 添加Effects"></a>4.4 添加Effects</h3><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Effects`的作用在于处理异步函数，控制数据流程。</span><br><span class="line">因为在真实场景中，数据都来自服务器，需要在发起异步请求获得返回值后再设置数据，更新`state`。</span><br><span class="line">因此我们往往在`Effects`中调用`reducer</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  namespace: &#x27;users&#x27;,</span><br><span class="line">  state： &#123;&#125;，</span><br><span class="line">  subscriptions: &#123;&#125;,</span><br><span class="line">  effects: &#123;</span><br><span class="line">    // 添加effects函数</span><br><span class="line">    // call与put是dva的函数</span><br><span class="line">    // call调用执行一个函数</span><br><span class="line">    // put则是dispatch执行一个action</span><br><span class="line">    // select用于访问其他model</span><br><span class="line">    *query(&#123; payload &#125;, &#123; select, call, put &#125;) &#123;</span><br><span class="line">        yield put(&#123; type: &#x27;showLoading&#x27; &#125;);</span><br><span class="line">        const &#123; data &#125; = yield call(query);</span><br><span class="line">        if (data) &#123;</span><br><span class="line">          yield put(&#123;</span><br><span class="line">            type: &#x27;querySuccess&#x27;,</span><br><span class="line">            payload: &#123;</span><br><span class="line">              list: data.data,</span><br><span class="line">              total: data.page.total,</span><br><span class="line">              current: data.page.current</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  reducers: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 添加请求处理   包含了一个ajax请求</span><br><span class="line">// models/users.js</span><br><span class="line">import request from &#x27;../utils/request&#x27;;</span><br><span class="line">import qs from &#x27;qs&#x27;;</span><br><span class="line">async function query(params) &#123;</span><br><span class="line">  return request(`/api/users?$&#123;qs.stringify(params)&#125;`);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-5-把请求处理分离到service中"><a href="#4-5-把请求处理分离到service中" class="headerlink" title="4.5 把请求处理分离到service中"></a>4.5 把请求处理分离到service中</h3><blockquote>
<p>用意在于分离(可复用的)ajax请求</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// services/users.js</span><br><span class="line">import request from &#x27;../utils/request&#x27;;</span><br><span class="line">import qs from &#x27;qs&#x27;;</span><br><span class="line">export async function query(params) &#123;</span><br><span class="line">  return request(`/api/users?$&#123;qs.stringify(params)&#125;`);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 在models中引用</span><br><span class="line">// models/users.js</span><br><span class="line">import &#123;query&#125; from &#x27;../services/users&#x27;;</span><br></pre></td></tr></table></figure>

<h2 id="五、使用dva框架和直接使用redux写法的区别"><a href="#五、使用dva框架和直接使用redux写法的区别" class="headerlink" title="五、使用dva框架和直接使用redux写法的区别"></a>五、使用dva框架和直接使用redux写法的区别</h2><h3 id="5-1-使用-redux"><a href="#5-1-使用-redux" class="headerlink" title="5.1 使用 redux"></a>5.1 使用 redux</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">// action.js</span><br><span class="line"></span><br><span class="line">export const REQUEST_TODO = &#x27;REQUEST_TODO&#x27;;</span><br><span class="line">export const RESPONSE_TODO = &#x27;RESPONSE_TODO&#x27;;</span><br><span class="line"></span><br><span class="line">const request = count =&gt; (&#123;type: REQUEST_TODO, payload: &#123;loading: true, count&#125;&#125;);</span><br><span class="line"></span><br><span class="line">const response = count =&gt; (&#123;type: RESPONSE_TODO, payload: &#123;loading: false, count&#125;&#125;);</span><br><span class="line"></span><br><span class="line">export const fetch = count =&gt; &#123;</span><br><span class="line">  return (dispatch) =&gt; &#123;</span><br><span class="line">    dispatch(request(count));</span><br><span class="line"></span><br><span class="line">    return new Promise(resolve =&gt; &#123;</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        resolve(count + 1);</span><br><span class="line">      &#125;, 1000)</span><br><span class="line">    &#125;).then(data =&gt; &#123;</span><br><span class="line">      dispatch(response(data))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">//reducer.js</span><br><span class="line">import &#123; REQUEST_TODO, RESPONSE_TODO &#125; from &#x27;./actions&#x27;;</span><br><span class="line"></span><br><span class="line">export default (state = &#123;</span><br><span class="line">  loading: false,</span><br><span class="line">  count: 0</span><br><span class="line">&#125;, action) =&gt; &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case REQUEST_TODO:</span><br><span class="line">      return &#123;...state, ...action.payload&#125;;</span><br><span class="line">    case RESPONSE_TODO:</span><br><span class="line">      return &#123;...state, ...action.payload&#125;;</span><br><span class="line">    default:</span><br><span class="line">      return state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// app.js</span><br><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import &#123; bindActionCreators &#125; from &#x27;redux&#x27;;</span><br><span class="line">import &#123; connect &#125; from &#x27;react-redux&#x27;;</span><br><span class="line"></span><br><span class="line">import * as actions from &#x27;./actions&#x27;;</span><br><span class="line"></span><br><span class="line">const App = (&#123;fetch, count, loading&#125;) =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;loading ? &lt;div&gt;loading...&lt;/div&gt; : &lt;div&gt;&#123;count&#125;&lt;/div&gt;&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; fetch(count)&#125;&gt;add&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mapStateToProps(state) &#123;</span><br><span class="line">  return state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mapDispatchToProps(dispatch) &#123;</span><br><span class="line">  return bindActionCreators(actions, dispatch)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default connect(mapStateToProps, mapDispatchToProps)(App)</span><br><span class="line">//index.js</span><br><span class="line">import &#123; render &#125; from &#x27;react-dom&#x27;;</span><br><span class="line">import &#123; createStore, applyMiddleware &#125; from &#x27;redux&#x27;;</span><br><span class="line">import &#123; Provider &#125; from &#x27;react-redux&#x27;</span><br><span class="line">import thunkMiddleware from &#x27;redux-thunk&#x27;;</span><br><span class="line"></span><br><span class="line">import reducer from &#x27;./app/reducer&#x27;;</span><br><span class="line">import App from &#x27;./app/app&#x27;;</span><br><span class="line"></span><br><span class="line">const store = createStore(reducer, applyMiddleware(thunkMiddleware));</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App/&gt;</span><br><span class="line">  &lt;/Provider&gt;</span><br><span class="line">  ,</span><br><span class="line">  document.getElementById(&#x27;app&#x27;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="5-2-使用dva"><a href="#5-2-使用dva" class="headerlink" title="5.2 使用dva"></a>5.2 使用dva</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">// model.js</span><br><span class="line">export default &#123;</span><br><span class="line">  namespace: &#x27;demo&#x27;,</span><br><span class="line">  state: &#123;</span><br><span class="line">    loading: false,</span><br><span class="line">    count: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  reducers: &#123;</span><br><span class="line">    request(state, payload) &#123;</span><br><span class="line">      return &#123;...state, ...payload&#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    response(state, payload) &#123;</span><br><span class="line">      return &#123;...state, ...payload&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  effects: &#123;</span><br><span class="line">    *&#x27;fetch&#x27;(action, &#123;put, call&#125;) &#123;</span><br><span class="line">      yield put(&#123;type: &#x27;request&#x27;, loading: true&#125;);</span><br><span class="line"></span><br><span class="line">      let count = yield call((count) =&gt; &#123;</span><br><span class="line">        return new Promise(resolve =&gt; &#123;</span><br><span class="line">          setTimeout(() =&gt; &#123;</span><br><span class="line">            resolve(count + 1);</span><br><span class="line">          &#125;, 1000);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;, action.count);</span><br><span class="line"></span><br><span class="line">      yield put(&#123;</span><br><span class="line">        type: &#x27;response&#x27;,</span><br><span class="line">        loading: false,</span><br><span class="line">        count</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">//app.js</span><br><span class="line"></span><br><span class="line">import React from &#x27;react&#x27;</span><br><span class="line">import &#123; connect &#125; from &#x27;dva&#x27;;</span><br><span class="line"></span><br><span class="line">const App = (&#123;fetch, count, loading&#125;) =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;loading ? &lt;div&gt;loading...&lt;/div&gt; : &lt;div&gt;&#123;count&#125;&lt;/div&gt;&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; fetch(count)&#125;&gt;add&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mapStateToProps(state) &#123;</span><br><span class="line">  return state.demo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mapDispatchToProps(dispatch) &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    fetch(count)&#123;</span><br><span class="line">      dispatch(&#123;type: &#x27;demo/fetch&#x27;, count&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default connect(mapStateToProps, mapDispatchToProps)(App)</span><br><span class="line">// index.js</span><br><span class="line">import dva from &#x27;dva&#x27;;</span><br><span class="line">import model from &#x27;./model&#x27;;</span><br><span class="line">import App from &#x27;./app&#x27;;</span><br><span class="line"></span><br><span class="line">const app = dva();</span><br><span class="line"></span><br><span class="line">app.use(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">app.model(model);</span><br><span class="line"></span><br><span class="line">app.router(() =&gt; &lt;App /&gt;);</span><br><span class="line"></span><br><span class="line">app.start();</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 <code>redux</code> 需要拆分出<code>action</code>模块和<code>reducer</code>模块</li>
<li><code>dva</code>将<code>action</code>和<code>reducer</code>封装到<code>model</code>中，异步流程采用<code>Generator</code>处理</li>
</ul>
<h1 id="六、使用axios统一处理"><a href="#六、使用axios统一处理" class="headerlink" title="六、使用axios统一处理"></a>六、使用axios统一处理</h1><h2 id="6-1-示例代码"><a href="#6-1-示例代码" class="headerlink" title="6.1 示例代码"></a>6.1 示例代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">// request.js</span><br><span class="line">import axios from &#x27;axios&#x27;;</span><br><span class="line">import NProgress from &#x27;nprogress&#x27;;</span><br><span class="line">import &#123; notification, message &#125; from &#x27;antd&#x27;;</span><br><span class="line">import &#123; routerRedux &#125; from &#x27;dva/router&#x27;;</span><br><span class="line">import store from &#x27;../index&#x27;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 一、功能：</span><br><span class="line"> * 1. 统一拦截http错误请求码；</span><br><span class="line"> * 2. 统一拦截业务错误代码；</span><br><span class="line"> * 3. 统一设置请求前缀</span><br><span class="line"> * |-- 每个 http 加前缀 baseURL = /api/v1，从配置文件中获取 apiPrefix</span><br><span class="line"> * 4. 配置异步请求过渡状态：显示蓝色加载条表示正在请求中，避免给用户页面假死的不好体验。</span><br><span class="line"> * |-- 使用 NProgress 工具库。</span><br><span class="line"> * </span><br><span class="line"> * 二、引包：</span><br><span class="line"> * |-- axios：http 请求工具库</span><br><span class="line"> * |-- NProgress：异步请求过度条，在浏览器主体部分顶部显示蓝色小条</span><br><span class="line"> * |-- notification：Antd组件 &gt; 处理错误响应码提示信息</span><br><span class="line"> * |-- routerRedux：dva/router对象，用于路由跳转，错误响应码跳转相应页面</span><br><span class="line"> * |-- store：dva中对象，使用里面的 dispatch 对象，用于触发路由跳转</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">// 设置全局参数，如响应超市时间，请求前缀等。</span><br><span class="line">axios.defaults.timeout = 5000</span><br><span class="line">axios.defaults.baseURL = &#x27;/api/v1&#x27;;</span><br><span class="line">axios.defaults.withCredentials = true;</span><br><span class="line"></span><br><span class="line">// 状态码错误信息</span><br><span class="line">const codeMessage = &#123;</span><br><span class="line">  200: &#x27;服务器成功返回请求的数据。&#x27;,</span><br><span class="line">  201: &#x27;新建或修改数据成功。&#x27;,</span><br><span class="line">  202: &#x27;一个请求已经进入后台排队（异步任务）。&#x27;,</span><br><span class="line">  204: &#x27;删除数据成功。&#x27;,</span><br><span class="line">  400: &#x27;发出的请求有错误，服务器没有进行新建或修改数据的操作。&#x27;,</span><br><span class="line">  401: &#x27;用户没有权限（令牌、用户名、密码错误）。&#x27;,</span><br><span class="line">  403: &#x27;用户得到授权，但是访问是被禁止的。&#x27;,</span><br><span class="line">  404: &#x27;发出的请求针对的是不存在的记录，服务器没有进行操作。&#x27;,</span><br><span class="line">  406: &#x27;请求的格式不可得。&#x27;,</span><br><span class="line">  410: &#x27;请求的资源被永久删除，且不会再得到的。&#x27;,</span><br><span class="line">  422: &#x27;当创建一个对象时，发生一个验证错误。&#x27;,</span><br><span class="line">  500: &#x27;服务器发生错误，请检查服务器。&#x27;,</span><br><span class="line">  502: &#x27;网关错误。&#x27;,</span><br><span class="line">  503: &#x27;服务不可用，服务器暂时过载或维护。&#x27;,</span><br><span class="line">  504: &#x27;网关超时。&#x27;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 添加一个请求拦截器，用于设置请求过渡状态</span><br><span class="line">axios.interceptors.request.use((config) =&gt; &#123;</span><br><span class="line">  // 请求开始，蓝色过渡滚动条开始出现</span><br><span class="line">  NProgress.start();</span><br><span class="line">  return config;</span><br><span class="line">&#125;, (error) =&gt; &#123;</span><br><span class="line">  return Promise.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 添加一个返回拦截器</span><br><span class="line">axios.interceptors.response.use((response) =&gt; &#123;</span><br><span class="line">  // 请求结束，蓝色过渡滚动条消失</span><br><span class="line">  NProgress.done();</span><br><span class="line">  return response;</span><br><span class="line">&#125;, (error) =&gt; &#123;</span><br><span class="line">  // 请求结束，蓝色过渡滚动条消失</span><br><span class="line">  // 即使出现异常，也要调用关闭方法，否则一直处于加载状态很奇怪</span><br><span class="line">  NProgress.done();</span><br><span class="line">  return Promise.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default function request (opt) &#123;</span><br><span class="line">  // 调用 axios api，统一拦截</span><br><span class="line">  return axios(opt)</span><br><span class="line">    .then((response) =&gt; </span><br><span class="line">      // &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 请求成功 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">      console.log(`【$&#123;opt.method&#125; $&#123;opt.url&#125;】请求成功，响应数据：%o`, response);</span><br><span class="line"></span><br><span class="line">      // 打印业务错误提示</span><br><span class="line">      if (response.data &amp;&amp; response.data.code != &#x27;0000&#x27;) &#123;</span><br><span class="line">        message.error(response.data.message);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return &#123; ...response.data &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch((error) =&gt; &#123;</span><br><span class="line">      // &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 请求失败 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">      // 请求配置发生的错误</span><br><span class="line">      if (!error.response) &#123;</span><br><span class="line">        return console.log(&#x27;Error&#x27;, error.message);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // 响应时状态码处理 </span><br><span class="line">      const status = error.response.status;</span><br><span class="line">      const errortext = codeMessage[status] || error.response.statusText;</span><br><span class="line">      </span><br><span class="line">      notification.error(&#123;</span><br><span class="line">        message: `请求错误 $&#123;status&#125;`,</span><br><span class="line">        description: errortext,</span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">      // 存在请求，但是服务器的返回一个状态码，它们都在2xx之外</span><br><span class="line">      const &#123; dispatch &#125; = store;</span><br><span class="line"></span><br><span class="line">      if (status === 401) &#123;</span><br><span class="line">        dispatch(routerRedux.push(&#x27;/user/login&#x27;));</span><br><span class="line">      &#125; else if (status === 403) &#123;</span><br><span class="line">        dispatch(routerRedux.push(&#x27;/exception/403&#x27;));</span><br><span class="line">      &#125; else if (status &lt;= 504 &amp;&amp; status &gt;= 500) &#123;</span><br><span class="line">        dispatch(routerRedux.push(&#x27;/exception/500&#x27;));</span><br><span class="line">      &#125; else if (status &gt;= 404 &amp;&amp; status &lt; 422) &#123;</span><br><span class="line">        dispatch(routerRedux.push(&#x27;/exception/404&#x27;));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // 开发时使用，上线时删除</span><br><span class="line">      console.log(`【$&#123;opt.method&#125; $&#123;opt.url&#125;】请求失败，响应数据：%o`, error.response);</span><br><span class="line"></span><br><span class="line">      return &#123; code: status, message: errortext &#125;; </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-2-明确响应体"><a href="#6-2-明确响应体" class="headerlink" title="6.2 明确响应体"></a>6.2 明确响应体</h2><blockquote>
<p>以微信小程序为例，请求响应数据分为两部分：</p>
</blockquote>
<ul>
<li>网络请求是否成功；</li>
<li>业务场景值。即便网络请求成功了，业务处理上可能有时也会出错，比如校验不通过</li>
</ul>
<p>我们在拦截响应时要分别对这两部分进行处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">response = &#123;</span><br><span class="line">  status: 200,                // 网络请求状态。</span><br><span class="line">  statusText: &#x27;xxx&#x27;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    code: &#x27;1001&#x27;,             // 业务请求状态。这里 &#x27;0000&#x27; 表示业务没问题，其它都有问题</span><br><span class="line">    message: &#x27;yyy&#x27;,</span><br><span class="line">    data: &#123;  &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-3-依赖包分析"><a href="#6-3-依赖包分析" class="headerlink" title="6.3 依赖包分析"></a>6.3 依赖包分析</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import axios from &#x27;axios&#x27;;</span><br><span class="line">import NProgress from &#x27;nprogress&#x27;;</span><br><span class="line">import &#123; notification, message &#125; from &#x27;antd&#x27;;</span><br><span class="line">import &#123; routerRedux &#125; from &#x27;dva/router&#x27;;</span><br><span class="line">import store from &#x27;../index&#x27;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>import store from &#39;../index&#39;;</code>这是 <code>dva</code> 中导出的对象。即下面代码最终导出的 <code>app._store</code>，引入它是因为 <code>dispatch</code> 对象在里面，我们需要 dispatch 对象进行路由跳转</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// index.js</span><br><span class="line">import dva from &#x27;dva&#x27;;</span><br><span class="line">import &#123; message &#125; from &#x27;antd&#x27;;</span><br><span class="line">import &#123; createBrowserHistory as createHistory &#125; from &#x27;history&#x27;;</span><br><span class="line"></span><br><span class="line">// 1. Initialize</span><br><span class="line">const app = dva(&#123;</span><br><span class="line">  history: createHistory(),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 2. Plugins</span><br><span class="line">app.use(createLoading());</span><br><span class="line"></span><br><span class="line">// 3. Model</span><br><span class="line">app.model(require(&#x27;./models/app/global&#x27;).default);</span><br><span class="line"></span><br><span class="line">// 4. Router</span><br><span class="line">app.router(require(&#x27;./router&#x27;).default);</span><br><span class="line"></span><br><span class="line">// 5. Start</span><br><span class="line">app.start(&#x27;#root&#x27;);</span><br><span class="line"></span><br><span class="line">export default app._store;</span><br></pre></td></tr></table></figure>

<h2 id="6-4-axios-全局配置"><a href="#6-4-axios-全局配置" class="headerlink" title="6.4 axios 全局配置"></a>6.4 axios 全局配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 设置全局参数，如响应超市时间，请求前缀等。</span><br><span class="line">axios.defaults.timeout = 5000</span><br><span class="line">axios.defaults.baseURL = &#x27;/api/v1&#x27;;</span><br><span class="line">axios.defaults.withCredentials = true;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>axios 可以设置很多全局配置，具体可参阅 <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000008470355">https://segmentfault.com/a/1190000008470355</a></p>
</blockquote>
<h2 id="6-5-加载-NProgress-过渡组件"><a href="#6-5-加载-NProgress-过渡组件" class="headerlink" title="6.5 加载 NProgress 过渡组件"></a>6.5 加载 NProgress 过渡组件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/ 添加一个请求拦截器，用于设置请求过渡状态</span><br><span class="line">axios.interceptors.request.use((config) =&gt; &#123;</span><br><span class="line">  // 请求开始，蓝色过渡滚动条开始出现</span><br><span class="line">  NProgress.start();</span><br><span class="line">  return config;</span><br><span class="line">&#125;, (error) =&gt; &#123;</span><br><span class="line">  return Promise.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 添加一个返回拦截器</span><br><span class="line">axios.interceptors.response.use((response) =&gt; &#123;</span><br><span class="line">  // 请求结束，蓝色过渡滚动条消失</span><br><span class="line">  NProgress.done();</span><br><span class="line">  return response;</span><br><span class="line">&#125;, (error) =&gt; &#123;</span><br><span class="line">  // 请求结束，蓝色过渡滚动条消失</span><br><span class="line">  // 即使出现异常，也要调用关闭方法，否则一直处于加载状态很奇怪</span><br><span class="line">  NProgress.done();</span><br><span class="line">  return Promise.reject(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>NProgress</code> 的使用主要有两个方法，当调用 <code>NProgress.start();</code> 时在浏览器顶部就会出现蓝色小条，当调用 <code>NProgress.done();</code> 蓝色小条就会消失。我们分别在请求开始和接收到响应调用这两个方法</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/6693922-948c3efcfeeaf4fd.gif" alt="img"></p>
<h2 id="6-6-网络请求成功处理"><a href="#6-6-网络请求成功处理" class="headerlink" title="6.6 网络请求成功处理"></a>6.6 网络请求成功处理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.then((response) =&gt; </span><br><span class="line">      // &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 请求成功 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">      console.log(`【$&#123;opt.method&#125; $&#123;opt.url&#125;】请求成功，响应数据：%o`, response);</span><br><span class="line"></span><br><span class="line">      // 打印业务错误提示</span><br><span class="line">      if (response.data &amp;&amp; response.data.code != &#x27;0000&#x27;) &#123;</span><br><span class="line">        message.error(response.data.message);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return &#123; ...response.data &#125;;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>网络请求状态码为 <code>200-300</code> 表示成功，此时还应该判断业务处理是否成功。这个根据具体项目具体规定，比如微信小程序有一套场景值。在实际项目中可以自行规定 <code>code = &#39;0000&#39;</code> 业务处理完全没问题，<code>code = &#39;1111&#39;</code>校验不通过，<code>code = &#39;2222&#39;</code> 数据库出错等等。</p>
</blockquote>
<ul>
<li>最后别忘了要返回具体对象 <code>&#123; ...response.data &#125;</code></li>
</ul>
<h2 id="6-7-网络请求失败处理"><a href="#6-7-网络请求失败处理" class="headerlink" title="6.7 网络请求失败处理"></a>6.7 网络请求失败处理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">// 状态码错误信息</span><br><span class="line">const codeMessage = &#123;</span><br><span class="line">  200: &#x27;服务器成功返回请求的数据。&#x27;,</span><br><span class="line">  201: &#x27;新建或修改数据成功。&#x27;,</span><br><span class="line">  202: &#x27;一个请求已经进入后台排队（异步任务）。&#x27;,</span><br><span class="line">  204: &#x27;删除数据成功。&#x27;,</span><br><span class="line">  400: &#x27;发出的请求有错误，服务器没有进行新建或修改数据的操作。&#x27;,</span><br><span class="line">  401: &#x27;用户没有权限（令牌、用户名、密码错误）。&#x27;,</span><br><span class="line">  403: &#x27;用户得到授权，但是访问是被禁止的。&#x27;,</span><br><span class="line">  404: &#x27;发出的请求针对的是不存在的记录，服务器没有进行操作。&#x27;,</span><br><span class="line">  406: &#x27;请求的格式不可得。&#x27;,</span><br><span class="line">  410: &#x27;请求的资源被永久删除，且不会再得到的。&#x27;,</span><br><span class="line">  422: &#x27;当创建一个对象时，发生一个验证错误。&#x27;,</span><br><span class="line">  500: &#x27;服务器发生错误，请检查服务器。&#x27;,</span><br><span class="line">  502: &#x27;网关错误。&#x27;,</span><br><span class="line">  503: &#x27;服务不可用，服务器暂时过载或维护。&#x27;,</span><br><span class="line">  504: &#x27;网关超时。&#x27;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// ...........</span><br><span class="line"></span><br><span class="line">.catch((error) =&gt; &#123;</span><br><span class="line">      // &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 请求失败 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">      // 请求配置发生的错误</span><br><span class="line">      if (!error.response) &#123;</span><br><span class="line">        return console.log(&#x27;Error&#x27;, error.message);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // 响应时状态码处理 </span><br><span class="line">      const status = error.response.status;</span><br><span class="line">      const errortext = codeMessage[status] || error.response.statusText;</span><br><span class="line">      </span><br><span class="line">      notification.error(&#123;</span><br><span class="line">        message: `请求错误 $&#123;status&#125;`,</span><br><span class="line">        description: errortext,</span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">      // 存在请求，但是服务器的返回一个状态码，它们都在2xx之外</span><br><span class="line">      const &#123; dispatch &#125; = store;</span><br><span class="line"></span><br><span class="line">      if (status === 401) &#123;</span><br><span class="line">        dispatch(routerRedux.push(&#x27;/user/login&#x27;));</span><br><span class="line">      &#125; else if (status === 403) &#123;</span><br><span class="line">        dispatch(routerRedux.push(&#x27;/exception/403&#x27;));</span><br><span class="line">      &#125; else if (status &lt;= 504 &amp;&amp; status &gt;= 500) &#123;</span><br><span class="line">        dispatch(routerRedux.push(&#x27;/exception/500&#x27;));</span><br><span class="line">      &#125; else if (status &gt;= 404 &amp;&amp; status &lt; 422) &#123;</span><br><span class="line">        dispatch(routerRedux.push(&#x27;/exception/404&#x27;));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // 开发时使用，上线时删除</span><br><span class="line">      console.log(`【$&#123;opt.method&#125; $&#123;opt.url&#125;】请求失败，响应数据：%o`, error.response);</span><br><span class="line"></span><br><span class="line">      return &#123; code: status, message: errortext &#125;; </span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>网络请求失败，首先需要根据 <code>status</code> 打印提示消息，告诉用户为什么请求失败。如响应码为 <code>401</code>，那么提示用户的文字就会是 用户没有权限（令牌、用户名、密码错误）</li>
<li>如果是 <code>401</code> 错误，表示用户没有权限访问或者用户名密码输入错误，应该跳转到登录页面：<code>dispatch(routerRedux.push(&#39;/user/login&#39;));</code></li>
</ul>
<h1 id="七、更多参考"><a href="#七、更多参考" class="headerlink" title="七、更多参考"></a>七、更多参考</h1><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/dvajs/dva-docs/blob/master/v1/zh-cn/tutorial/01-%E6%A6%82%E8%A6%81.md">dva官方教程</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dvajs/dva/blob/master/README_zh-CN.md">官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dvajs/dva-knowledgemap">使用Dva的所有知识点</a></li>
<li><a target="_blank" rel="noopener" href="http://slides.com/sorrycc/dva#/">Dva-React 应用框架在蚂蚁金服的实践</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/sorrycc/roadhog#%E9%85%8D%E7%BD%AE">roadhog介绍</a></li>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/dkvirus/blog/1057996">创建一个 dva 脚手架工程</a></li>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/dkvirus/blog/1058203">dva 脚手架目录分析</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/sorrycc/blog/issues/18">12 步 30 分钟，完成用户管理的 CURD 应用 (react+dva+antd)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c5ec9ffa29be">dva router4.0 使用实践总结</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7de59752b8a8">dva 2.0中如何使用代码进行路由跳转</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2e9e45e9a880">dva 配置 browserHistory 实践总结</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/61fe7a57fad4">dva-loading 实践用法</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/649e97ff4354">dva 升级2.0版本遇到的问题小结</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e0a220906301">dva 中进行页面复用实践总结</a></li>
<li><a target="_blank" rel="noopener" href="https://dvajs.com/knowledgemap/#javascript-%E8%AF%AD%E8%A8%80">Dva知识地图</a></li>
<li><a target="_blank" rel="noopener" href="https://dvajs.com/api/">dva-API文档</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-React/React-diff原理" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/05/React/React-diff%E5%8E%9F%E7%90%86/" class="article-date">
  	<time datetime="2019-12-05T09:40:50.000Z" itemprop="datePublished">2019-12-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/05/React/React-diff%E5%8E%9F%E7%90%86/">
        React-diff原理
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、是什么"><a href="#一、是什么" class="headerlink" title="一、是什么"></a>一、是什么</h2><p>跟<code>Vue</code>一致，<code>React</code>通过引入<code>Virtual DOM</code>的概念，极大地避免无效的<code>Dom</code>操作，使我们的页面的构建效率提到了极大的提升</p>
<p>而<code>diff</code>算法就是更高效地通过对比新旧<code>Virtual DOM</code>来找出真正的<code>Dom</code>变化之处</p>
<p>传统diff算法通过循环递归对节点进行依次对比，效率低下，算法复杂度达到 O(n^3)，<code>react</code>将算法进行一个优化，复杂度姜维<code>O(n)</code>，两者效率差距如下图：</p>
<p><img src="https://static.vue-js.com/a43c9960-ec91-11eb-ab90-d9ae814b240d.png" alt="img"></p>
<h2 id="二、原理"><a href="#二、原理" class="headerlink" title="二、原理"></a>二、原理</h2><p><code>react</code>中<code>diff</code>算法主要遵循三个层级的策略：</p>
<ul>
<li>tree层级</li>
<li>conponent 层级</li>
<li>element 层级</li>
</ul>
<h3 id="tree层级"><a href="#tree层级" class="headerlink" title="tree层级"></a>tree层级</h3><p><code>DOM</code>节点跨层级的操作不做优化，只会对相同层级的节点进行比较</p>
<p><img src="https://static.vue-js.com/ae71d1c0-ec91-11eb-85f6-6fac77c0c9b3.png" alt="img"></p>
<p>只有删除、创建操作，没有移动操作，如下图：</p>
<p><img src="https://static.vue-js.com/b85f2bb0-ec91-11eb-ab90-d9ae814b240d.png" alt="img"></p>
<p><code>react</code>发现新树中，R节点下没有了A，那么直接删除A，在D节点下创建A以及下属节点</p>
<p>上述操作中，只有删除和创建操作</p>
<h3 id="conponent层级"><a href="#conponent层级" class="headerlink" title="conponent层级"></a>conponent层级</h3><p>如果是同一个类的组件，则会继续往下<code>diff</code>运算，如果不是一个类的组件，那么直接删除这个组件下的所有子节点，创建新的</p>
<p><img src="https://static.vue-js.com/c1fcdf00-ec91-11eb-ab90-d9ae814b240d.png" alt="img"></p>
<p>当<code>component D</code>换成了<code>component G</code> 后，即使两者的结构非常类似，也会将<code>D</code>删除再重新创建<code>G</code></p>
<h3 id="element层级"><a href="#element层级" class="headerlink" title="element层级"></a>element层级</h3><p>对于比较同一层级的节点们，每个节点在对应的层级用唯一的<code>key</code>作为标识</p>
<p>提供了 3 种节点操作，分别为 <code>INSERT_MARKUP</code>(插入)、<code>MOVE_EXISTING</code> (移动)和 <code>REMOVE_NODE</code> (删除)</p>
<p>如下场景：</p>
<p><img src="https://static.vue-js.com/cae1c9a0-ec91-11eb-ab90-d9ae814b240d.png" alt="img"></p>
<p>通过<code>key</code>可以准确地发现新旧集合中的节点都是相同的节点，因此无需进行节点删除和创建，只需要将旧集合中节点的位置进行移动，更新为新集合中节点的位置</p>
<p>流程如下表：</p>
<p><img src="https://static.vue-js.com/d34c5420-ec91-11eb-85f6-6fac77c0c9b3.png" alt="img"></p>
<ul>
<li>index： 新集合的遍历下标。</li>
<li>oldIndex：当前节点在老集合中的下标</li>
<li>maxIndex：在新集合访问过的节点中，其在老集合的最大下标</li>
</ul>
<p>如果当前节点在新集合中的位置比老集合中的位置靠前的话，是不会影响后续节点操作的，这里这时候被动字节不用动</p>
<p>操作过程中只比较oldIndex和maxIndex，规则如下：</p>
<ul>
<li>当oldIndex&gt;maxIndex时，将oldIndex的值赋值给maxIndex</li>
<li>当oldIndex&#x3D;maxIndex时，不操作</li>
<li>当oldIndex&lt;maxIndex时，将当前节点移动到index的位置</li>
</ul>
<p><code>diff</code>过程如下：</p>
<ul>
<li>节点B：此时 maxIndex&#x3D;0，oldIndex&#x3D;1；满足 maxIndex&lt; oldIndex，因此B节点不动，此时maxIndex&#x3D; Math.max(oldIndex, maxIndex)，就是1</li>
<li>节点A：此时maxIndex&#x3D;1，oldIndex&#x3D;0；不满足maxIndex&lt; oldIndex，因此A节点进行移动操作，此时maxIndex&#x3D; Math.max(oldIndex, maxIndex)，还是1</li>
<li>节点D：此时maxIndex&#x3D;1, oldIndex&#x3D;3；满足maxIndex&lt; oldIndex，因此D节点不动，此时maxIndex&#x3D; Math.max(oldIndex, maxIndex)，就是3</li>
<li>节点C：此时maxIndex&#x3D;3，oldIndex&#x3D;2；不满足maxIndex&lt; oldIndex，因此C节点进行移动操作，当前已经比较完了</li>
</ul>
<p>当ABCD节点比较完成后，<code>diff</code>过程还没完，还会整体遍历老集合中节点，看有没有没用到的节点，有的话，就删除</p>
<h2 id="三、注意事项"><a href="#三、注意事项" class="headerlink" title="三、注意事项"></a>三、注意事项</h2><p>对于简单列表渲染而言，不使用<code>key</code>比使用<code>key</code>的性能，例如：</p>
<p>将一个[1,2,3,4,5]，渲染成如下的样子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>后续更改成[1,3,2,5,4]，使用<code>key</code>与不使用<code>key</code>作用如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.加key</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;1&#x27;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;1&#x27;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>     </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;2&#x27;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;3&#x27;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;3&#x27;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  ========&gt;  <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;2&#x27;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;4&#x27;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;5&#x27;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;5&#x27;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;4&#x27;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">操作：节点2移动至下标为2的位置，节点4移动至下标为4的位置。</span><br><span class="line"></span><br><span class="line">2.不加key</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>     </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  ========&gt;  <span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">操作：修改第1个到第5个节点的innerText</span><br></pre></td></tr></table></figure>

<p>如果我们对这个集合进行增删的操作改成[1,3,2,5,6]</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.加key</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;1&#x27;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;1&#x27;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>     </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;2&#x27;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;3&#x27;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;3&#x27;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  ========&gt;  <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;2&#x27;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;4&#x27;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;5&#x27;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;5&#x27;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#x27;6&#x27;</span>&gt;</span>6<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">操作：节点2移动至下标为2的位置，新增节点6至下标为4的位置，删除节点4。</span><br><span class="line"></span><br><span class="line">2.不加key</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>     </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  ========&gt;  <span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>6<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">操作：修改第1个到第5个节点的innerText</span><br></pre></td></tr></table></figure>

<p>由于<code>dom</code>节点的移动操作开销是比较昂贵的，没有<code>key</code>的情况下要比有<code>key</code>的性能更好</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a><a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6/React/">React</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-React/React-05-组件协同(不)可控组件" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/11/28/React/React-05-%E7%BB%84%E4%BB%B6%E5%8D%8F%E5%90%8C(%E4%B8%8D)%E5%8F%AF%E6%8E%A7%E7%BB%84%E4%BB%B6/" class="article-date">
  	<time datetime="2019-11-28T02:49:27.000Z" itemprop="datePublished">2019-11-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/28/React/React-05-%E7%BB%84%E4%BB%B6%E5%8D%8F%E5%90%8C(%E4%B8%8D)%E5%8F%AF%E6%8E%A7%E7%BB%84%E4%BB%B6/">
        React 组件协议(不)可控组件
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、为什么要进行组件的协同"><a href="#一、为什么要进行组件的协同" class="headerlink" title="一、为什么要进行组件的协同"></a>一、为什么要进行组件的协同</h2><ul>
<li>我们在实际的开发项目的时候，不会只用几个组件，有时候遇到大型的项目，可能会有成千上百的组件，难免会遇到有功能重复的组件。要进行修改，就会修改大部分的文件。所以我们需要进行组件的协同开发。</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/451.png" alt="img"></p>
<h2 id="二、什么是组件的协同使用？"><a href="#二、什么是组件的协同使用？" class="headerlink" title="二、什么是组件的协同使用？"></a>二、什么是组件的协同使用？</h2><ul>
<li>组件的协同本质上是对组件的一种组织、管理的方式。</li>
<li>目的：<ul>
<li>逻辑清晰：这是组件与组件之间的逻辑</li>
<li>代码模块化</li>
<li>封装细节：像面向对象一样将常用的方法以及数据封装起来</li>
<li>提高代码的复用性：因为是组件，相当于一个封装好的东西，用的时候直接调用</li>
</ul>
</li>
</ul>
<h2 id="三、如何实现组件的协同使用"><a href="#三、如何实现组件的协同使用" class="headerlink" title="三、如何实现组件的协同使用"></a>三、如何实现组件的协同使用</h2><ul>
<li>第一种：增加一个父组件，将其他的组件进行嵌套，更多的是实现代码的封装</li>
<li>第二种：通过一些操作从后台获取数据，<code>React</code>中的<code>Mixin</code>，更多的是实现代码的复用</li>
</ul>
<h2 id="四、组件嵌套的含义"><a href="#四、组件嵌套的含义" class="headerlink" title="四、组件嵌套的含义"></a>四、组件嵌套的含义</h2><ul>
<li>组件嵌套的本质是父子关系</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/452.png" alt="img"></p>
<h2 id="五、组件嵌套的优缺点"><a href="#五、组件嵌套的优缺点" class="headerlink" title="五、组件嵌套的优缺点"></a>五、组件嵌套的优缺点</h2><ul>
<li>优点：<ul>
<li>逻辑清晰：父子关系类似于人类中的父子关系</li>
<li>模块化开发：每个模块对应一个功能，不同的模块可以同步开发</li>
<li>封装细节：开发者必须要关注组件的功能，不需要了解细节</li>
</ul>
</li>
<li>缺点：<ul>
<li>编写难度高：父子组件的关系需要经过深思熟虑，贸然编写可能导致关系混乱，代码难以维护</li>
<li>无法掌握所有细节：使用者只知道组件的用法，不知道实现细节，遇到问题难以修复</li>
</ul>
</li>
</ul>
<h2 id="六、Mixin"><a href="#六、Mixin" class="headerlink" title="六、Mixin"></a>六、Mixin</h2><p><strong>Mixin的含义</strong></p>
<ul>
<li><code>Mixin=一组方法</code>。</li>
<li>他的目的是横向抽离出组件的相似代码，把组件的共同作用以及效果的代码提出来</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/453.png" alt="img"></p>
<p><strong>Mixin的优缺点</strong></p>
<ul>
<li>优点<ul>
<li>代码复用：抽离出通用的代码，减少开发成本，提高开发效率</li>
<li>即插即用：可以使用许多现有的<code>Mixin</code>来开发自己的代码</li>
<li>适应性强：改动一次代码，影响多个组件</li>
</ul>
</li>
<li>缺点<ul>
<li>编写难度高：<code>Mixin</code>可能被用在各种环境中，想要兼容多种环境就需要更多的 - 码与逻辑，通用的代价是提高复杂度</li>
<li>降低代码的可读性：组件的优势在于将逻辑与是界面直接结合在一起，<code>Mixin</code>本质上会分散逻辑，理解起来难度大</li>
</ul>
</li>
</ul>
<h2 id="七、不可控组件"><a href="#七、不可控组件" class="headerlink" title="七、不可控组件"></a>七、不可控组件</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/454.png" alt="img"></p>
<ul>
<li>上图：<code>defaultValue</code>的值是固定的，这就是一个不可控组件</li>
<li>如果要获取<code>input</code>的<code>value</code>值，只有使用<code>ref</code>获取节点来获取值</li>
</ul>
<h2 id="八、可控组件"><a href="#八、可控组件" class="headerlink" title="八、可控组件"></a>八、可控组件</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/455.png" alt="img"></p>
<ul>
<li><code>defaultValue</code>的值是根据状态确定了，只需要拿到<code>this.state.value</code>的值就可以了</li>
<li>这里需要注意一下：使用<code>value</code>的值是不可修改的，<code>defaultValue</code>的值是可以修改的</li>
</ul>
<p><strong>可控组件的优点</strong></p>
<ul>
<li>符合<code>React</code>的数据流</li>
<li>数据存储在<code>state</code>中，便于获取</li>
<li>便于处理数据</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-React/React-context" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/11/23/React/React-context/" class="article-date">
  	<time datetime="2019-11-23T10:35:16.000Z" itemprop="datePublished">2019-11-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/23/React/React-context/">
        React context
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul>
<li><code>React</code> 组件之间的通信是基于 <code>props</code> 的单向数据流，即父组件通过 <code>props</code> 向子组件传值，亦或是子组件执行传入的函数来更新父组件的<code>state</code>，这都满足了我们大部分的使用场景</li>
<li>一般地，对于兄弟组件之间的通信，是通过它们共同的祖先组件进行的，即 Lifting State Up，官方文档也有介绍。组件一通过事件将状态变更通知它们共同的祖先组件，祖先组再将状态同步到组件二</li>
<li>但是，如果组件之间嵌套的比较深，即使提升状态到共同父组件，再同步状态到相应的组件还是需要一层一层的传递下去，可能会比较繁琐</li>
<li>在对应的场景中，<code>context</code> 就可以缩短父组件到子组件的属性传递路径</li>
</ul>
<h2 id="例1"><a href="#例1" class="headerlink" title="例1"></a>例1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import Parent from &#x27;./Parent&#x27;</span><br><span class="line">import ChildOne from &#x27;../components/ChildOne&#x27;</span><br><span class="line">import ChildTwo from &#x27;../components/ChildTwo&#x27;</span><br><span class="line"></span><br><span class="line">export default class Container extends React.Component &#123;</span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123; value: &#x27;&#x27; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    changeValue = value =&gt; &#123;</span><br><span class="line">        this.setState(&#123; value &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getChildContext() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            value: this.state.value,</span><br><span class="line">            changeValue: this.changeValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;Parent&gt;</span><br><span class="line">                    &lt;ChildOne /&gt;</span><br><span class="line">                &lt;/Parent&gt;</span><br><span class="line">                &lt;Parent&gt;</span><br><span class="line">                    &lt;ChildTwo /&gt;</span><br><span class="line">                &lt;/Parent&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Container.childContextTypes = &#123;</span><br><span class="line">    value: PropTypes.string,</span><br><span class="line">    changeValue: PropTypes.func</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Parent.jsx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;</span><br><span class="line"></span><br><span class="line">const Parent = (props) =&gt; (</span><br><span class="line">    &lt;div &#123;...props&#125; /&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">export default Parent</span><br></pre></td></tr></table></figure>

<p>ChildOne.jsx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">export default class ChildOne extends React.Component &#123;</span><br><span class="line"></span><br><span class="line">    handleChange = (e) =&gt; &#123;</span><br><span class="line">        const &#123; changeValue &#125; = this.context</span><br><span class="line">        changeValue(e.target.value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                子组件一</span><br><span class="line">                &lt;input onChange=&#123;this.handleChange&#125; /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ChildOne.contextTypes = &#123;</span><br><span class="line">    changeValue: PropTypes.func</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ChildTwo.jsx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export default class ChildTwo extends React.Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                子组件二</span><br><span class="line">                &lt;p&gt;&#123;this.context.value&#125;&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ChildTwo.contextTypes = &#123;</span><br><span class="line">    value: PropTypes.string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在 <code>Container.childContextTypes</code> 中进行接口的声明，通过 <code>getChildContext</code> 返回更新后的<code>state</code>，在 <code>Child.contextTypes</code> 中声明要获取的接口，这样在子组件内部就能通过 <code>this.context</code> 获取到。通过 <code>Context</code> 这样一个中间对象，<code>ChildOne</code> 和 <code>ChildTwo</code> 就可以相互通信了</p>
</blockquote>
<h2 id="例2"><a href="#例2" class="headerlink" title="例2"></a>例2</h2><blockquote>
<p>组件嵌套传递属性，在导航里面引用<code>Page</code>中的变量</p>
</blockquote>
<ul>
<li>使用<code>context</code>来传递</li>
<li>使用props层级传递</li>
</ul>
<blockquote>
<p>使用<code>context</code>组件需要定义<code>propTypes</code>,需要严格校验、声明类型、字段</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">class Page extends React.Component &#123;</span><br><span class="line">    static childContextTypes = &#123;</span><br><span class="line">       user:PropTypes.string</span><br><span class="line">    &#125;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super(props)</span><br><span class="line">        this.state = &#123;user:&#x27;poetries&#x27;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    getChildContext()&#123;</span><br><span class="line">        return this.state</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;p&gt;我是&#123;this.state.user&#125;&lt;/p&gt;</span><br><span class="line">            &lt;Siderbar /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Siderbar extends React.Component &#123;</span><br><span class="line">    static childContextTypes = &#123;</span><br><span class="line">       user:PropTypes.string</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;p&gt;侧边栏&lt;/p&gt;</span><br><span class="line">            &lt;Navbar /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Navbar extends React.Component &#123;</span><br><span class="line">    static childContextTypes = &#123;</span><br><span class="line">       user:PropTypes.string</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;p&gt;我是&#123;this.context.user&#125;的导航栏&lt;/p&gt;</span><br><span class="line">            &lt;Siderbar /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="context在Provider种应用"><a href="#context在Provider种应用" class="headerlink" title="context在Provider种应用"></a>context在Provider种应用</h2><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">provider`组件就是使用`context`，把`store`放到`context`里，所有的子元素可以直接取到`store</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import PropTypes from &#x27;prop-types&#x27;</span><br><span class="line">class Provider extends Component &#123;</span><br><span class="line">    static childContextTypes = &#123;</span><br><span class="line">        store:Protypes.object</span><br><span class="line">    &#125;</span><br><span class="line">    constructor(props,context)&#123;</span><br><span class="line">        super(props,context)</span><br><span class="line">        this.store = props.store</span><br><span class="line">    &#125;</span><br><span class="line">    getChildContext()&#123;</span><br><span class="line">        //把传进来的store放进全局</span><br><span class="line">        return &#123;store:this.store&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return this.props.children</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>connect</code> 负责连接组件，给到<code>redux</code>里的数据放到组件的属性里</p>
</blockquote>
<ul>
<li>负责接收一个组件，把<code>state</code>里的一些数据放进去，返回一个组件</li>
<li>数据变化的时候，能够通知组件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">//高阶组件写法</span><br><span class="line">const connect = (mapStateToProps=state=&gt;state,mapDispatchToProps=&#123;&#125;)=&gt;(wrapperComponent)=&gt;&#123;</span><br><span class="line">    return class ConnectComponent extends React.Component &#123;</span><br><span class="line">        //负责接收组件</span><br><span class="line">        static contextTypes = &#123;</span><br><span class="line">            store:PropTypes.obejct</span><br><span class="line">        &#125;</span><br><span class="line">        constructor(props)&#123;</span><br><span class="line">            super(props, context)&#123;</span><br><span class="line">                this.state = &#123;</span><br><span class="line">                    props:&#123;&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        componentDidMount()&#123;</span><br><span class="line">            const &#123;store&#125; = this.context</span><br><span class="line">            store.subscribe(()=&gt;this.update())</span><br><span class="line">            this.update()</span><br><span class="line">        &#125;</span><br><span class="line">        update()&#123;</span><br><span class="line">            //  获取mapStateToProps、mapDispatchToProps 放入this.props里</span><br><span class="line">            </span><br><span class="line">            const &#123;store&#125;=this.context</span><br><span class="line">            const stateProps = mapStateToProps(store.getState())</span><br><span class="line">            const dispatchProps = bindActionCreators(mapDispatchProps,store.dispatch)</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                props:&#123;</span><br><span class="line">                    ...this.state.props,</span><br><span class="line">                    ...stateProps,</span><br><span class="line">                    ...dispatchProps</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        render()&#123;</span><br><span class="line">            // 把数据放入</span><br><span class="line">            return &lt;wrapperComponent &#123;...this.state.props&#125;/&gt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-React/React-04-事件" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/11/17/React/React-04-%E4%BA%8B%E4%BB%B6/" class="article-date">
  	<time datetime="2019-11-17T08:45:13.000Z" itemprop="datePublished">2019-11-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/17/React/React-04-%E4%BA%8B%E4%BB%B6/">
        React 事件
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、编写事件处理函数"><a href="#一、编写事件处理函数" class="headerlink" title="一、编写事件处理函数"></a>一、编写事件处理函数</h2><p><img src="https://poetries1.gitee.io/img-repo/2019/10/456.png" alt="img"></p>
<ul>
<li>在函数体中进行一些操作，常见的有：更新页面内容，更新组件状态，与后台交互</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/457.png" alt="img"></p>
<p><strong>书写方式</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var Demo = React.createClass(&#123;</span><br><span class="line">		getInitialState:function()&#123;		&#125;,</span><br><span class="line">		handleClick: function(event)&#123;		&#125;,</span><br><span class="line">		handleChange: function()&#123;		&#125;,</span><br><span class="line">		render:function()&#123;		&#125;,</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>上面的代码中有的有参数<code>event</code>，有的没有，这个根据自己的需求</li>
</ul>
<h2 id="二、绑定事件处理函数"><a href="#二、绑定事件处理函数" class="headerlink" title="二、绑定事件处理函数"></a>二、绑定事件处理函数</h2><ul>
<li><code>onClick=&#123;this,handleClick&#125;</code></li>
<li>需要注意的是：不要在事件后面添加上一个<code>（）</code></li>
</ul>
<p><strong>其他的事件</strong></p>
<ul>
<li>触摸事件：<code>onTouchCancel</code>，<code>onTouchEnd</code>，<code>onTouchMove</code>，<code>onTouchStart</code></li>
<li>键盘事件：<code>onKeyDown</code>，<code>onKeyUp</code>， <code>onKeyPress</code>（前两者的组合）</li>
<li>表单时间：<code>onChange</code>，<code>onInput</code>，<code>onSubmit</code></li>
<li>焦点事件：<code>onFocus</code>，<code>onBlur</code></li>
<li>UI元素事件：<code>onScroll</code></li>
<li>滚动事件：<code>onWhell</code>（鼠标滚动）</li>
<li>鼠标事件：<code>onClick</code>，<code>onContextMenu</code>，<code>onDoubleClick</code>……</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">var Demo = React.createClass(&#123;</span><br><span class="line">    handleClick:function(e)&#123;</span><br><span class="line">        console.log(e)</span><br><span class="line">        console.log(e.target)</span><br><span class="line">        console.log(e.nativeEvent)</span><br><span class="line">    &#125;,</span><br><span class="line">    render:function()&#123;</span><br><span class="line">        return &lt;div onClick=&#123;this.handleClick&#125;&gt;Hello World&lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">ReactDOM.render(&lt;Demo/&gt;,document.getElementById(&#x27;app&#x27;))</span><br><span class="line">var Demo = React.createClass(&#123;</span><br><span class="line">    getInitialState:function()&#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            width: 200,</span><br><span class="line">            height: 200,</span><br><span class="line">            backgroundColor: &#x27;#DDDDDD&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    /*handleWheel:function(e)&#123;</span><br><span class="line">        var newColor = (parseInt(this.state.backgroundColor.substr(1),16) + e.deltaY).toString(16)</span><br><span class="line">        newColor = &#x27;#&#x27; + newColor.toUpperCase()</span><br><span class="line">        console.log(newColor)</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            backgroundColor:newColor</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,*/</span><br><span class="line">    randomColor:function()&#123;</span><br><span class="line">        var r = Math.floor(Math.random()*256);</span><br><span class="line">        var g = Math.floor(Math.random()*256);</span><br><span class="line">        var b = Math.floor(Math.random()*256);</span><br><span class="line">        return &#x27;rgb(&#x27;+r+&#x27;,&#x27;+g+&#x27;,&#x27;+b+&#x27;)&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    handleWheel:function()&#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            backgroundColor:this.randomColor()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    render:function()&#123;</span><br><span class="line">        return &lt;div onWheel=&#123;this.handleWheel&#125; style=&#123;this.state&#125;&gt;这是一个案例，鼠标滚动实现背景颜色的变化&lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">ReactDOM.render(&lt;Demo/&gt;,document.getElementById(&#x27;app&#x27;))</span><br></pre></td></tr></table></figure>

<h2 id="三、事件对象"><a href="#三、事件对象" class="headerlink" title="三、事件对象"></a>三、事件对象</h2><p><strong>事件对象的使用</strong></p>
<ul>
<li>通用：所有的事件都有事件属性</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/458.png" alt="img"></p>
<ul>
<li>键盘：键盘事件拥有的事件属性</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/459.png" alt="img"></p>
<ul>
<li>鼠标：鼠标事件拥有的事件属性</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/460.png" alt="img"></p>
<ul>
<li>滚动：滚动事件拥有的事件属性<ul>
<li>为什么会有三个，因为有的设备可以实现三个方向的移动</li>
</ul>
</li>
</ul>
<p><img src="https://poetries1.gitee.io/img-repo/2019/10/461.png" alt="img"></p>
<h2 id="四、事件与状态关联"><a href="#四、事件与状态关联" class="headerlink" title="四、事件与状态关联"></a>四、事件与状态关联</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">inputChange:function(event)&#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">    	inputText:event.target.value</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>总的来说就是使用<code>this.setState</code>来更新状态，而状态的值因为事件的不同会不同</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/React/">React</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/8/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/10/">Next &amp;raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2022 mr.杜
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




  </div>
</body>
</html>